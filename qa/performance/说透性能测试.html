<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>杏壳儿</title>
    <meta name="generator" content="VuePress 1.9.7">
    
    <meta name="description" content="">
    
    <link rel="preload" href="/assets/css/0.styles.5675a7d7.css" as="style"><link rel="preload" href="/assets/js/app.dd60fddf.js" as="script"><link rel="preload" href="/assets/js/2.1d799614.js" as="script"><link rel="preload" href="/assets/js/4.6dd544f6.js" as="script"><link rel="prefetch" href="/assets/js/10.f42a5970.js"><link rel="prefetch" href="/assets/js/100.fd420176.js"><link rel="prefetch" href="/assets/js/101.fd3f9957.js"><link rel="prefetch" href="/assets/js/102.d3c4087c.js"><link rel="prefetch" href="/assets/js/103.5bf5f364.js"><link rel="prefetch" href="/assets/js/104.c19dc6fc.js"><link rel="prefetch" href="/assets/js/105.3644a723.js"><link rel="prefetch" href="/assets/js/106.c99225f8.js"><link rel="prefetch" href="/assets/js/107.97852924.js"><link rel="prefetch" href="/assets/js/108.212c27f0.js"><link rel="prefetch" href="/assets/js/109.d6e4c811.js"><link rel="prefetch" href="/assets/js/11.91f395ed.js"><link rel="prefetch" href="/assets/js/110.96b9b201.js"><link rel="prefetch" href="/assets/js/111.78b25fde.js"><link rel="prefetch" href="/assets/js/112.8c82f9a4.js"><link rel="prefetch" href="/assets/js/113.aae564aa.js"><link rel="prefetch" href="/assets/js/114.313f0d5b.js"><link rel="prefetch" href="/assets/js/115.844f47cf.js"><link rel="prefetch" href="/assets/js/116.4d2691a0.js"><link rel="prefetch" href="/assets/js/117.bd36d4a2.js"><link rel="prefetch" href="/assets/js/118.d205f7e7.js"><link rel="prefetch" href="/assets/js/119.ee336fe8.js"><link rel="prefetch" href="/assets/js/12.5e7abec9.js"><link rel="prefetch" href="/assets/js/120.f5ba9dbe.js"><link rel="prefetch" href="/assets/js/121.05e1c205.js"><link rel="prefetch" href="/assets/js/122.779c5f8c.js"><link rel="prefetch" href="/assets/js/123.64ad1fde.js"><link rel="prefetch" href="/assets/js/124.72120675.js"><link rel="prefetch" href="/assets/js/125.7f1e0958.js"><link rel="prefetch" href="/assets/js/126.dcd28d9f.js"><link rel="prefetch" href="/assets/js/127.428f223e.js"><link rel="prefetch" href="/assets/js/128.0ebf700a.js"><link rel="prefetch" href="/assets/js/129.3d7442ee.js"><link rel="prefetch" href="/assets/js/13.ec7d048b.js"><link rel="prefetch" href="/assets/js/130.b946546b.js"><link rel="prefetch" href="/assets/js/131.0ea40481.js"><link rel="prefetch" href="/assets/js/132.4a4437c1.js"><link rel="prefetch" href="/assets/js/133.7e17bb00.js"><link rel="prefetch" href="/assets/js/134.95928b65.js"><link rel="prefetch" href="/assets/js/135.fb730cc9.js"><link rel="prefetch" href="/assets/js/136.ce2e6b16.js"><link rel="prefetch" href="/assets/js/137.30dda982.js"><link rel="prefetch" href="/assets/js/138.9d9bd5df.js"><link rel="prefetch" href="/assets/js/139.19e62986.js"><link rel="prefetch" href="/assets/js/14.27407a31.js"><link rel="prefetch" href="/assets/js/140.425bbd4e.js"><link rel="prefetch" href="/assets/js/141.13f9ac88.js"><link rel="prefetch" href="/assets/js/142.b12b14dc.js"><link rel="prefetch" href="/assets/js/15.3653047a.js"><link rel="prefetch" href="/assets/js/16.7baae9f5.js"><link rel="prefetch" href="/assets/js/17.dcad52cb.js"><link rel="prefetch" href="/assets/js/18.bb46f976.js"><link rel="prefetch" href="/assets/js/19.0925b886.js"><link rel="prefetch" href="/assets/js/20.e2181917.js"><link rel="prefetch" href="/assets/js/21.2e00fc64.js"><link rel="prefetch" href="/assets/js/22.60af365a.js"><link rel="prefetch" href="/assets/js/23.9a6247e9.js"><link rel="prefetch" href="/assets/js/24.533a55d3.js"><link rel="prefetch" href="/assets/js/25.0d54429f.js"><link rel="prefetch" href="/assets/js/26.f70e7a58.js"><link rel="prefetch" href="/assets/js/27.357c2f0c.js"><link rel="prefetch" href="/assets/js/28.05884156.js"><link rel="prefetch" href="/assets/js/29.b63f5d12.js"><link rel="prefetch" href="/assets/js/3.b3c0c8cc.js"><link rel="prefetch" href="/assets/js/30.c37379b8.js"><link rel="prefetch" href="/assets/js/31.e5583500.js"><link rel="prefetch" href="/assets/js/32.2f8a89ce.js"><link rel="prefetch" href="/assets/js/33.8526b5cc.js"><link rel="prefetch" href="/assets/js/34.8c476ba1.js"><link rel="prefetch" href="/assets/js/35.28a9e848.js"><link rel="prefetch" href="/assets/js/36.22caee50.js"><link rel="prefetch" href="/assets/js/37.f564431c.js"><link rel="prefetch" href="/assets/js/38.60510a45.js"><link rel="prefetch" href="/assets/js/39.b57d73b7.js"><link rel="prefetch" href="/assets/js/40.a0f12257.js"><link rel="prefetch" href="/assets/js/41.ae21b83f.js"><link rel="prefetch" href="/assets/js/42.4a8b0eed.js"><link rel="prefetch" href="/assets/js/43.a4b1dbe5.js"><link rel="prefetch" href="/assets/js/44.7957e7b8.js"><link rel="prefetch" href="/assets/js/45.22f92df5.js"><link rel="prefetch" href="/assets/js/46.a7bd57b2.js"><link rel="prefetch" href="/assets/js/47.1076bbe9.js"><link rel="prefetch" href="/assets/js/48.10c8f82d.js"><link rel="prefetch" href="/assets/js/49.aea6f4f0.js"><link rel="prefetch" href="/assets/js/5.7fae9900.js"><link rel="prefetch" href="/assets/js/50.97341023.js"><link rel="prefetch" href="/assets/js/51.2213cc76.js"><link rel="prefetch" href="/assets/js/52.4b1c29e4.js"><link rel="prefetch" href="/assets/js/53.a6434736.js"><link rel="prefetch" href="/assets/js/54.59470ace.js"><link rel="prefetch" href="/assets/js/55.49cec6b6.js"><link rel="prefetch" href="/assets/js/56.06f2e67d.js"><link rel="prefetch" href="/assets/js/57.2e812620.js"><link rel="prefetch" href="/assets/js/58.e6ce6313.js"><link rel="prefetch" href="/assets/js/59.35026211.js"><link rel="prefetch" href="/assets/js/6.8c7a6ec4.js"><link rel="prefetch" href="/assets/js/60.cc2c97a8.js"><link rel="prefetch" href="/assets/js/61.8d91a90f.js"><link rel="prefetch" href="/assets/js/62.991f9147.js"><link rel="prefetch" href="/assets/js/63.85532e4f.js"><link rel="prefetch" href="/assets/js/64.90068745.js"><link rel="prefetch" href="/assets/js/65.ff870427.js"><link rel="prefetch" href="/assets/js/66.ba94b154.js"><link rel="prefetch" href="/assets/js/67.5158a096.js"><link rel="prefetch" href="/assets/js/68.54fe2ba5.js"><link rel="prefetch" href="/assets/js/69.bcb4c73f.js"><link rel="prefetch" href="/assets/js/7.3c7e6d86.js"><link rel="prefetch" href="/assets/js/70.00d41657.js"><link rel="prefetch" href="/assets/js/71.892ff6f5.js"><link rel="prefetch" href="/assets/js/72.2302172b.js"><link rel="prefetch" href="/assets/js/73.02125fde.js"><link rel="prefetch" href="/assets/js/74.23ba9330.js"><link rel="prefetch" href="/assets/js/75.c6915e81.js"><link rel="prefetch" href="/assets/js/76.f26b5808.js"><link rel="prefetch" href="/assets/js/77.e9b2145e.js"><link rel="prefetch" href="/assets/js/78.41764819.js"><link rel="prefetch" href="/assets/js/79.194bc603.js"><link rel="prefetch" href="/assets/js/8.1788d36a.js"><link rel="prefetch" href="/assets/js/80.4b57cedb.js"><link rel="prefetch" href="/assets/js/81.f9556a24.js"><link rel="prefetch" href="/assets/js/82.f18755ed.js"><link rel="prefetch" href="/assets/js/83.5c9f9489.js"><link rel="prefetch" href="/assets/js/84.5c47e245.js"><link rel="prefetch" href="/assets/js/85.1b40b497.js"><link rel="prefetch" href="/assets/js/86.774be43b.js"><link rel="prefetch" href="/assets/js/87.f2848ddb.js"><link rel="prefetch" href="/assets/js/88.0f0b4fab.js"><link rel="prefetch" href="/assets/js/89.2ae8eea2.js"><link rel="prefetch" href="/assets/js/9.c52fca3a.js"><link rel="prefetch" href="/assets/js/90.3e798661.js"><link rel="prefetch" href="/assets/js/91.329942cb.js"><link rel="prefetch" href="/assets/js/92.f6b412ea.js"><link rel="prefetch" href="/assets/js/93.1bad8fe5.js"><link rel="prefetch" href="/assets/js/94.8ab22d8b.js"><link rel="prefetch" href="/assets/js/95.af7ae9bb.js"><link rel="prefetch" href="/assets/js/96.b84c5880.js"><link rel="prefetch" href="/assets/js/97.8584121b.js"><link rel="prefetch" href="/assets/js/98.3d7a6b2a.js"><link rel="prefetch" href="/assets/js/99.da28339e.js">
    <link rel="stylesheet" href="/assets/css/0.styles.5675a7d7.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/assets/img/开心果.png" alt="杏壳儿" class="logo"> <span class="site-name can-hide">杏壳儿</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="软件测试体系" class="dropdown-title"><span class="title">软件测试体系</span> <span class="arrow down"></span></button> <button type="button" aria-label="软件测试体系" class="mobile-dropdown-title"><span class="title">软件测试体系</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/qa/basics/" class="nav-link">
  测试基础
</a></li><li class="dropdown-item"><!----> <a href="/qa/automatic/" class="nav-link">
  自动测试
</a></li><li class="dropdown-item"><!----> <a href="/qa/performance/" class="nav-link router-link-active">
  性能测试
</a></li><li class="dropdown-item"><!----> <a href="/qa/special/" class="nav-link">
  专项测试
</a></li><li class="dropdown-item"><!----> <a href="/qa/security/" class="nav-link">
  安全测试
</a></li><li class="dropdown-item"><!----> <a href="/qa/tool/" class="nav-link">
  测试工具
</a></li><li class="dropdown-item"><!----> <a href="/qa/framework/" class="nav-link">
  测试框架
</a></li><li class="dropdown-item"><!----> <a href="/qa/view/" class="nav-link">
  测试思考
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="计算机基础" class="dropdown-title"><span class="title">计算机基础</span> <span class="arrow down"></span></button> <button type="button" aria-label="计算机基础" class="mobile-dropdown-title"><span class="title">计算机基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/basic/network/" class="nav-link">
  计算机网络
</a></li><li class="dropdown-item"><!----> <a href="/basic/os/" class="nav-link">
  操作系统
</a></li><li class="dropdown-item"><!----> <a href="/basic/linux/" class="nav-link">
  Linux
</a></li><li class="dropdown-item"><!----> <a href="/basic/algorithms/" class="nav-link">
  数据结构与算法
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Language Menu" class="dropdown-title"><span class="title">前端游乐场</span> <span class="arrow down"></span></button> <button type="button" aria-label="Language Menu" class="mobile-dropdown-title"><span class="title">前端游乐场</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/frontend/vue/" class="nav-link">
  VUE
</a></li><li class="dropdown-item"><!----> <a href="/frontend/css/" class="nav-link">
  CSS
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="后端训练场" class="dropdown-title"><span class="title">后端训练场</span> <span class="arrow down"></span></button> <button type="button" aria-label="后端训练场" class="mobile-dropdown-title"><span class="title">后端训练场</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          编程语言
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/backend/python/" class="nav-link">
  Python
</a></li><li class="dropdown-subitem"><a href="/backend/java/" class="nav-link">
  Java
</a></li></ul></li><li class="dropdown-item"><h4>
          WEB框架
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/backend/django/" class="nav-link">
  Django
</a></li><li class="dropdown-subitem"><a href="/backend/drf/" class="nav-link">
  Django REST Framework
</a></li></ul></li><li class="dropdown-item"><h4>
          中间件
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/backend/celery/" class="nav-link">
  Celery
</a></li></ul></li><li class="dropdown-item"><h4>
          数据库
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/backend/mysql/" class="nav-link">
  Mysql
</a></li><li class="dropdown-subitem"><a href="/backend/redis/" class="nav-link">
  Redis
</a></li><li class="dropdown-subitem"><a href="/backend/mongodb/" class="nav-link">
  Mongodb
</a></li><li class="dropdown-subitem"><a href="/backend/elasticsearch/" class="nav-link">
  Elasticsearch
</a></li></ul></li><li class="dropdown-item"><h4>
          部署
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/backend/uwsgi/" class="nav-link">
  Uwsgi
</a></li><li class="dropdown-subitem"><a href="/backend/gunicorn/" class="nav-link">
  Gunicorn
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="DevOps" class="dropdown-title"><span class="title">DevOps</span> <span class="arrow down"></span></button> <button type="button" aria-label="DevOps" class="mobile-dropdown-title"><span class="title">DevOps</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/devops/docker/" class="nav-link">
  Docker
</a></li><li class="dropdown-item"><!----> <a href="/devops/git/" class="nav-link">
  Git
</a></li><li class="dropdown-item"><!----> <a href="/devops/notes/" class="nav-link">
  DevOps笔记
</a></li><li class="dropdown-item"><!----> <a href="/devops/efficiency/" class="nav-link">
  研发效能
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="软能力" class="dropdown-title"><span class="title">软能力</span> <span class="arrow down"></span></button> <button type="button" aria-label="软能力" class="mobile-dropdown-title"><span class="title">软能力</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/softskills/mind/" class="nav-link">
  思考模型
</a></li><li class="dropdown-item"><!----> <a href="/softskills/communication/" class="nav-link">
  沟通能力
</a></li></ul></div></div><div class="nav-item"><a href="/opensource/" class="nav-link">
  开源前哨
</a></div><div class="nav-item"><a href="/memo/" class="nav-link">
  备忘录
</a></div><div class="nav-item"><a href="/interview/" class="nav-link">
  面试指南
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="软件测试体系" class="dropdown-title"><span class="title">软件测试体系</span> <span class="arrow down"></span></button> <button type="button" aria-label="软件测试体系" class="mobile-dropdown-title"><span class="title">软件测试体系</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/qa/basics/" class="nav-link">
  测试基础
</a></li><li class="dropdown-item"><!----> <a href="/qa/automatic/" class="nav-link">
  自动测试
</a></li><li class="dropdown-item"><!----> <a href="/qa/performance/" class="nav-link router-link-active">
  性能测试
</a></li><li class="dropdown-item"><!----> <a href="/qa/special/" class="nav-link">
  专项测试
</a></li><li class="dropdown-item"><!----> <a href="/qa/security/" class="nav-link">
  安全测试
</a></li><li class="dropdown-item"><!----> <a href="/qa/tool/" class="nav-link">
  测试工具
</a></li><li class="dropdown-item"><!----> <a href="/qa/framework/" class="nav-link">
  测试框架
</a></li><li class="dropdown-item"><!----> <a href="/qa/view/" class="nav-link">
  测试思考
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="计算机基础" class="dropdown-title"><span class="title">计算机基础</span> <span class="arrow down"></span></button> <button type="button" aria-label="计算机基础" class="mobile-dropdown-title"><span class="title">计算机基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/basic/network/" class="nav-link">
  计算机网络
</a></li><li class="dropdown-item"><!----> <a href="/basic/os/" class="nav-link">
  操作系统
</a></li><li class="dropdown-item"><!----> <a href="/basic/linux/" class="nav-link">
  Linux
</a></li><li class="dropdown-item"><!----> <a href="/basic/algorithms/" class="nav-link">
  数据结构与算法
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Language Menu" class="dropdown-title"><span class="title">前端游乐场</span> <span class="arrow down"></span></button> <button type="button" aria-label="Language Menu" class="mobile-dropdown-title"><span class="title">前端游乐场</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/frontend/vue/" class="nav-link">
  VUE
</a></li><li class="dropdown-item"><!----> <a href="/frontend/css/" class="nav-link">
  CSS
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="后端训练场" class="dropdown-title"><span class="title">后端训练场</span> <span class="arrow down"></span></button> <button type="button" aria-label="后端训练场" class="mobile-dropdown-title"><span class="title">后端训练场</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          编程语言
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/backend/python/" class="nav-link">
  Python
</a></li><li class="dropdown-subitem"><a href="/backend/java/" class="nav-link">
  Java
</a></li></ul></li><li class="dropdown-item"><h4>
          WEB框架
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/backend/django/" class="nav-link">
  Django
</a></li><li class="dropdown-subitem"><a href="/backend/drf/" class="nav-link">
  Django REST Framework
</a></li></ul></li><li class="dropdown-item"><h4>
          中间件
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/backend/celery/" class="nav-link">
  Celery
</a></li></ul></li><li class="dropdown-item"><h4>
          数据库
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/backend/mysql/" class="nav-link">
  Mysql
</a></li><li class="dropdown-subitem"><a href="/backend/redis/" class="nav-link">
  Redis
</a></li><li class="dropdown-subitem"><a href="/backend/mongodb/" class="nav-link">
  Mongodb
</a></li><li class="dropdown-subitem"><a href="/backend/elasticsearch/" class="nav-link">
  Elasticsearch
</a></li></ul></li><li class="dropdown-item"><h4>
          部署
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/backend/uwsgi/" class="nav-link">
  Uwsgi
</a></li><li class="dropdown-subitem"><a href="/backend/gunicorn/" class="nav-link">
  Gunicorn
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="DevOps" class="dropdown-title"><span class="title">DevOps</span> <span class="arrow down"></span></button> <button type="button" aria-label="DevOps" class="mobile-dropdown-title"><span class="title">DevOps</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/devops/docker/" class="nav-link">
  Docker
</a></li><li class="dropdown-item"><!----> <a href="/devops/git/" class="nav-link">
  Git
</a></li><li class="dropdown-item"><!----> <a href="/devops/notes/" class="nav-link">
  DevOps笔记
</a></li><li class="dropdown-item"><!----> <a href="/devops/efficiency/" class="nav-link">
  研发效能
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="软能力" class="dropdown-title"><span class="title">软能力</span> <span class="arrow down"></span></button> <button type="button" aria-label="软能力" class="mobile-dropdown-title"><span class="title">软能力</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/softskills/mind/" class="nav-link">
  思考模型
</a></li><li class="dropdown-item"><!----> <a href="/softskills/communication/" class="nav-link">
  沟通能力
</a></li></ul></div></div><div class="nav-item"><a href="/opensource/" class="nav-link">
  开源前哨
</a></div><div class="nav-item"><a href="/memo/" class="nav-link">
  备忘录
</a></div><div class="nav-item"><a href="/interview/" class="nav-link">
  面试指南
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>目录</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/qa/performance/" aria-current="page" class="sidebar-link">构建性能测试体系</a></li><li><a href="/qa/performance/TPS、并发数、线程数.html" class="sidebar-link">关于TPS、并发数、线程数</a></li><li><a href="/qa/performance/Jmeter.html" class="sidebar-link">Jmeter</a></li><li><a href="/qa/performance/Locust.html" class="sidebar-link">Locust</a></li><li><a href="/qa/performance/说透性能测试.html" class="active sidebar-link">说透性能测试</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/qa/performance/说透性能测试.html#为什么每个测试人都要学好性能测试" class="sidebar-link">为什么每个测试人都要学好性能测试</a></li><li class="sidebar-sub-header"><a href="/qa/performance/说透性能测试.html#性能测试全流程需要注意什么" class="sidebar-link">性能测试全流程需要注意什么</a></li><li class="sidebar-sub-header"><a href="/qa/performance/说透性能测试.html#jmeter核心概念" class="sidebar-link">JMeter核心概念</a></li><li class="sidebar-sub-header"><a href="/qa/performance/说透性能测试.html#jmeter参数化策略" class="sidebar-link">JMeter参数化策略</a></li><li class="sidebar-sub-header"><a href="/qa/performance/说透性能测试.html#构建并执行jmeter脚本的正确姿势" class="sidebar-link">构建并执行JMeter脚本的正确姿势</a></li><li class="sidebar-sub-header"><a href="/qa/performance/说透性能测试.html#jmeter二次开发" class="sidebar-link">JMeter二次开发</a></li><li class="sidebar-sub-header"><a href="/qa/performance/说透性能测试.html#基于jmeter-api开发性能测试平台-backlog" class="sidebar-link">基于JMeter API开发性能测试平台（backlog）</a></li><li class="sidebar-sub-header"><a href="/qa/performance/说透性能测试.html#nginx在系统架构中的作用" class="sidebar-link">Nginx在系统架构中的作用</a></li><li class="sidebar-sub-header"><a href="/qa/performance/说透性能测试.html#如何制定性能测试目标" class="sidebar-link">如何制定性能测试目标</a></li><li class="sidebar-sub-header"><a href="/qa/performance/说透性能测试.html#性能测试场景的分类和意义" class="sidebar-link">性能测试场景的分类和意义</a></li><li class="sidebar-sub-header"><a href="/qa/performance/说透性能测试.html#制定一份有效的性能测试方案" class="sidebar-link">制定一份有效的性能测试方案</a></li><li class="sidebar-sub-header"><a href="/qa/performance/说透性能测试.html#命令行监控linux服务器" class="sidebar-link">命令行监控Linux服务器</a></li><li class="sidebar-sub-header"><a href="/qa/performance/说透性能测试.html#分布式服务链路监控以及报警方案" class="sidebar-link">分布式服务链路监控以及报警方案</a></li><li class="sidebar-sub-header"><a href="/qa/performance/说透性能测试.html#把可视化监控也做得酷炫" class="sidebar-link">把可视化监控也做得酷炫</a></li><li class="sidebar-sub-header"><a href="/qa/performance/说透性能测试.html#docker制作、运行以及监控" class="sidebar-link">Docker制作、运行以及监控</a></li><li class="sidebar-sub-header"><a href="/qa/performance/说透性能测试.html#从cpu飙升定位到热点方法" class="sidebar-link">从CPU飙升定位到热点方法</a></li><li class="sidebar-sub-header"><a href="/qa/performance/说透性能测试.html#基于jvm分析内存使用对象" class="sidebar-link">基于JVM分析内存使用对象</a></li><li class="sidebar-sub-header"><a href="/qa/performance/说透性能测试.html#通过arthas定位代码链路问题" class="sidebar-link">通过Arthas定位代码链路问题</a></li><li class="sidebar-sub-header"><a href="/qa/performance/说透性能测试.html#应对redis缓存穿透、击穿和雪崩" class="sidebar-link">应对Redis缓存穿透、击穿和雪崩</a></li><li class="sidebar-sub-header"><a href="/qa/performance/说透性能测试.html#优化mysql性能" class="sidebar-link">优化MySQL性能</a></li><li class="sidebar-sub-header"><a href="/qa/performance/说透性能测试.html#如何根治慢sql" class="sidebar-link">如何根治慢SQL</a></li><li class="sidebar-sub-header"><a href="/qa/performance/说透性能测试.html#线上全链路性能测试实践总结" class="sidebar-link">线上全链路性能测试实践总结</a></li></ul></li><li><a href="/qa/performance/性能指标监控.html" class="sidebar-link">性能指标监控</a></li><li><a href="/qa/performance/NetData.html" class="sidebar-link">NetData性能监控</a></li><li><a href="/qa/performance/Android性能监控.html" class="sidebar-link">Android性能监控</a></li><li><a href="/qa/performance/Ios性能监控.html" class="sidebar-link">IOS性能监控</a></li><li><a href="/qa/performance/IO性能调优.html" class="sidebar-link">IO性能调优</a></li><li><a href="/qa/performance/Prometheus入门到实战.html" class="sidebar-link">Prometheus入门到实战</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><p></p><div class="table-of-contents"><ul><li><a href="#为什么每个测试人都要学好性能测试">为什么每个测试人都要学好性能测试</a></li><li><a href="#性能测试全流程需要注意什么">性能测试全流程需要注意什么</a></li><li><a href="#jmeter核心概念">JMeter核心概念</a></li><li><a href="#jmeter参数化策略">JMeter参数化策略</a></li><li><a href="#构建并执行jmeter脚本的正确姿势">构建并执行JMeter脚本的正确姿势</a><ul><li><a href="#脚本构建">脚本构建</a></li><li><a href="#脚本执行">脚本执行</a></li></ul></li><li><a href="#jmeter二次开发">JMeter二次开发</a><ul><li><a href="#beanshell-java源码解释器">Beanshell（Java源码解释器）</a></li><li><a href="#java-sampler">Java Sampler</a></li><li><a href="#函数助手">函数助手</a></li></ul></li><li><a href="#基于jmeter-api开发性能测试平台-backlog">基于JMeter API开发性能测试平台（backlog）</a></li><li><a href="#nginx在系统架构中的作用">Nginx在系统架构中的作用</a><ul><li><a href="#nginx重要的两个概念">Nginx重要的两个概念</a></li><li><a href="#nginx日志分析">Nginx日志分析</a></li></ul></li><li><a href="#如何制定性能测试目标">如何制定性能测试目标</a><ul><li><a href="#制定性能测试指标">制定性能测试指标</a></li></ul></li><li><a href="#性能测试场景的分类和意义">性能测试场景的分类和意义</a><ul><li><a href="#基准场景">基准场景</a></li><li><a href="#单接口负载场景">单接口负载场景</a></li><li><a href="#混合场景负载测试">混合场景负载测试</a></li><li><a href="#异常性能测试">异常性能测试</a></li><li><a href="#稳定性性能测试">稳定性性能测试</a></li><li><a href="#什么情况下可以停止负载测试">什么情况下可以停止负载测试</a></li></ul></li><li><a href="#制定一份有效的性能测试方案">制定一份有效的性能测试方案</a><ul><li><a href="#性能测试方案要点及解决的问题">性能测试方案要点及解决的问题</a></li><li><a href="#测试方案包含的内容">测试方案包含的内容</a></li></ul></li><li><a href="#命令行监控linux服务器">命令行监控Linux服务器</a><ul><li><a href="#层次清晰">层次清晰</a></li><li><a href="#全面覆盖">全面覆盖</a></li><li><a href="#定向深入">定向深入</a></li></ul></li><li><a href="#分布式服务链路监控以及报警方案">分布式服务链路监控以及报警方案</a><ul><li><a href="#为什么需要链路监控">为什么需要链路监控</a></li><li><a href="#全链路监控组件选择">全链路监控组件选择</a></li><li><a href="#skywalking架构分析">SkyWalking架构分析</a></li><li><a href="#skywalking使用">SkyWalking使用</a></li><li><a href="#告警-钉钉为例">告警（钉钉为例）</a></li></ul></li><li><a href="#把可视化监控也做得酷炫">把可视化监控也做得酷炫</a></li><li><a href="#docker制作、运行以及监控">Docker制作、运行以及监控</a><ul><li><a href="#为什么使用docker">为什么使用Docker</a></li><li><a href="#docker用法">docker用法</a></li></ul></li><li><a href="#从cpu飙升定位到热点方法">从CPU飙升定位到热点方法</a></li><li><a href="#基于jvm分析内存使用对象">基于JVM分析内存使用对象</a><ul><li><a href="#本地方法栈">本地方法栈</a></li><li><a href="#java栈">Java栈</a></li><li><a href="#方法区-jdk-1-8-已经移除">方法区（JDK 1.8+已经移除）</a></li><li><a href="#程序计数器">程序计数器</a></li><li><a href="#堆">堆</a></li><li><a href="#定位内存占用">定位内存占用</a></li></ul></li><li><a href="#通过arthas定位代码链路问题">通过Arthas定位代码链路问题</a><ul><li><a href="#arthas是什么">Arthas是什么</a></li><li><a href="#arthas使用方法">Arthas使用方法</a></li><li><a href="#arthas-实操">Arthas 实操</a></li></ul></li><li><a href="#应对redis缓存穿透、击穿和雪崩">应对Redis缓存穿透、击穿和雪崩</a></li><li><a href="#优化mysql性能">优化MySQL性能</a><ul><li><a href="#一次sql的查询过程是怎样的">一次SQL的查询过程是怎样的</a></li><li><a href="#影响性能的关键点有哪些">影响性能的关键点有哪些</a></li></ul></li><li><a href="#如何根治慢sql">如何根治慢SQL</a></li><li><a href="#线上全链路性能测试实践总结">线上全链路性能测试实践总结</a></li></ul></div><p></p> <h2 id="为什么每个测试人都要学好性能测试"><a href="#为什么每个测试人都要学好性能测试" class="header-anchor">#</a> 为什么每个测试人都要学好性能测试</h2> <ul><li>性能测试并不只是要一个结果，更多的是要从部署结构、代码链路、业务上下游等多角度来综合考量。</li> <li>列举几个常见问题</li></ul> <ol><li>只会使用 JMeter 但执行却不规范。
<ul><li>在性能测试过程中，工具使用不恰当会影响到性能测试的结果。我见过很多因为工具使用不当导致的客户端瓶颈，让处理能力未达到预期的情况。很多测试没能及时发现是工具的原因，导致自己的专业能力备受质疑。</li></ul></li> <li>不会制定有效的性能测试目标。
<ul><li>如果不会制定有效的性能测试目标，那测出来的数据也没有什么参考价值，因为你不知道能不能满足上线需求，也不能准确地评估线上风险，做完了性能测试依然留有一大堆问题。</li></ul></li> <li>不会定位和分析性能测试结果。
<ul><li>测试脚本得到的数据并不能直接用来分析系统瓶颈，你只有通过监控去观察系统存在的异常点，然后根据异常点来重点监控相关组件，由表及里、层层深入才能找到根本原因。</li></ul></li></ol> <ul><li>性能测试真正的价值，并不在于你用工具完成了一份报告，而是通过对过程和结果的分析找到症结，帮助团队有效提升产品性能，比如提升了多少 TPS，降低了多少响应时间，节约了多少硬件成本，等等。</li></ul> <h2 id="性能测试全流程需要注意什么"><a href="#性能测试全流程需要注意什么" class="header-anchor">#</a> 性能测试全流程需要注意什么</h2> <ol><li><p>历史访问数据
历史访问数据，指的是什么类型的用户通过何种终端访问服务的接口次数。作为衡量性能的重要手段，自然是不可或缺的。
绝大多数公司都会封装平台来采集历史访问数据，如果要看原始的访问日志，Nginx 日志也是一种方式（如下所示）</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>120.204.101.238 - - [29/Nov/2020:14:09:22 +0800] &quot;GET /v1/register HTv1TP/1.1&quot; 200 150 &quot;-
120.204.101.238 - - [29/Nov/2020:14:09:22 +0800] &quot;POST /v1/login HTTP/1.1&quot; 200 36 &quot;-
120.204.101.238 - - [29/Nov/2020:14:09:22 +0800] &quot;GET /hello/map HTTP/1.1&quot; 200 202 
...
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></li> <li><p>需求管理</p> <ul><li>对需求接入和充分的分析能帮助你在测试之前获得更多的信息，也能制定出较为完善的性能测试方案</li> <li><strong>需求来源</strong></li> <li>需求来源其实就是你这次性能测试的目的，调研清楚这个问题能帮助你更有针对性地获取数据，从而制定更为准确的性能目标。</li> <li><strong>需求分析</strong></li> <li>需求分析是在原始数据中提炼出有效的性能参考数据，通过这些数据构建性能测试的模型，再通过模型形成测试步骤。</li> <li><strong>分析方案</strong></li> <li>性能测试方案的目的不仅仅在于让自己知道这次性能测试如何执行，也要让你的项目成员知道这次性能方案，它的执行周期、涉及的成员等，然后再一起评审这次方案中有没有不合理的地方。</li></ul></li> <li><p>性能测试环境管理</p> <ul><li>一般情况下我们会独立搭建一套，与业务测试环境相隔离，同时也能够在上线之前尽可能暴露一些代码中的问题。</li> <li>我曾看到过这样一个观点：线下性能环境与生产环境机器配置相差甚大，我们直接在生产上做性能测试就可以了，没有必要在测试环境中做。</li> <li>环境的配置高低是决定性能结果的一个影响因素，但不是全部因素。能够提前测试、提前暴露 bug，修复 bug 的成本也就越低，所以在线下必须有专门的性能环境，它可以帮助你提前发现内存泄漏、死锁等问题。更何况，这些问题的发现和修复与服务器硬件配置并没有直接联系，如果能够在线下提早用更低的成本解决是一种更优的选择。</li> <li>如果没有做线下性能测试的情况下直接在生产上测试，对性能中的异常测试、高可用测试可能无法充分执行；同时，修复性能 bug 也需要功能上的回归，这些都增加了过程管理的复杂度。</li></ul></li> <li><p>监控管理</p> <ul><li>监控是发现性能问题的眼睛，没有监控，性能定位分析也就无从谈起了。监控的核心在于全面和深入。</li> <li><strong>客户端数据监控</strong></li> <li>性能测试中说的客户端一般是指测试机，测试机输出的数据是观察性能好差的关键指标。我推荐 JMeter+InfluxDB+Grafana 的框架，它具备展现直观、数据实时的特点，可以全面地展示监控的数据。</li> <li><strong>硬件资源监控</strong></li> <li>基础硬件资源监控一般包含 CPU、内存、磁盘、网络等，常用的监控方式可以分为命令行监控和可视化监控。
<ul><li><strong>命令行监控</strong></li> <li>通过命令的监控我们能够以最直接的方式获取服务器的实时状态。以 Linux 服务器举例，top、vmstat、iostat、iftop 等都是性能监控常用的命令。</li> <li><strong>可视化监控</strong></li> <li>可视化监控相对于命令行监控提供了更为丰富的图表展示，这样的话看起来更直观易懂，适合监控大屏的展示，能够将监控信息传递给项目组成员，但它需要提取数据之后计算，然后再展示，有一定的延迟，不如命令行监控直接。</li> <li>Zabbix、Prometheus+Grafana 等都是可视化监控常用的手段，它们可以把数据持久化，能够调取过往时间轴的历史数据，一般在回溯、汇报、复盘时使用比较多。</li></ul></li> <li>不管采用何种方式，在进行硬件监控时，都应该涵盖测试过程中所有的服务器，包括压测机、应用服务器、中间件服务器数据库服务器等。</li> <li><strong>链路监控</strong></li> <li>链路监控是对代码本身的追踪，代码问题常常是问题产生的根因，所以关于代码的监控不可忽视。目前常用的代码链路追踪工具有 SkyWalking、PinPoint、Arthas。</li> <li><strong>业务规则监控</strong></li> <li>业务逻辑报错和用户息息相关并且用户是可以直接感受到的，比如商品库存不足、用户余额不足，它们会直接影响用户的体验。线上出现问题并不少见，重要的是如何第一时间得知并且解决这些问题。所以当出现问题即时发送报警邮件或者短信也是十分必要的，对于业务的监控同样不能忽视。</li></ul></li> <li><p>数据模型建设</p> <ul><li>数据模型的意义在于沉淀以往的历史数据，通过不同的维度去发现一些规律，我认为这也是性能测试领域中的一种探索方向。通过数据模型的建设，我们可以尝试在不同纬度建立数据之间的联系，从而发现数据间的规律，对未来的数据进行预测。</li> <li><strong>时间纬度</strong></li> <li>一般的电商每年至少有两次大促，618 和双 11。它们一般会详细记录每年总的成交额、网关访问次数、各个服务访问次数等，通过每年的活动力度、广告投放，以及数据团队来预测下次大促的成交金额和网站访问量等，这些数据也会间接帮助性能测试制定目标。</li> <li><strong>机器纬度</strong></li> <li>机器纬度是一个什么概念呢？你可能会认为在线下两台机器测出来接口的处理能力是 100，线上有 10 台等配置的机器，就不用测试了，处理能力直接按照 5 倍去推算。</li> <li>这其实是默认只要扩充机器系统的处理能力就会倍数增加，事实上是毫无道理的。不过你可以长期记录接口或者服务在性能测试环境的数据和生产环境中，相同场景下的压测数据，再进行长时间地跟踪对比，尝试发现其中是否能够存在一些规律。</li></ul></li> <li><p>技术建设</p> <ul><li><strong>熟练掌握一门编程语言</strong></li> <li>测试很难说一定要掌握哪一种语言，但是熟练地使用一门语言可以帮助你迅速上手其他编程语言。</li> <li><strong>能够读懂服务端基本架构</strong></li> <li>如果你不懂服务端的架构，那基本只能根据你的性能测试工具去编写报告，了解不到更深层次内容。</li> <li><strong>能够根据性能测试需求，提出系统改造建议</strong></li> <li>性能测试与业务测试不太一样：业务测试基本是通过构造测试场景去满足业务规则，而性能测试，尤其是线上全链路性能测试，为了避免造成线上数据污染和影响真实用户访问，往往会改造系统去进行流量隔离和清理。</li></ul></li></ol> <h2 id="jmeter核心概念"><a href="#jmeter核心概念" class="header-anchor">#</a> JMeter核心概念</h2> <ol><li><p>JMeter优势</p> <ul><li><strong>开源免费、安装简易、多系统兼容</strong></li> <li>相对于 Loadrunner，JMeter 没有版权的困扰，脚本可以在 Windows、Linux、Mac 任意系统间切换，非常简单方便。</li> <li><strong>丰富的基础插件</strong></li> <li>相对于 Locust，JMeter 提供了较多的插件，可以减少重复造轮子的工作。Locust 的基础功能需要写代码实现，更适合定制性较强的测试场景，如游戏类测试，在敏捷化的测试团队中需要考虑到这部分的时间成本问题。</li> <li><strong>良好的拓展性</strong></li> <li>虽然 JMeter 已经有了丰富的基础插件，它本身还是提供了入口进行二次开发，以满足团队定制化的需求。同样，你也可以将 JMeter 平台化，通过平台化的操作来管理 JMeter，增强测试团队的协作性。</li></ul></li> <li><p>线程与循环
<img src="data:image/png;base64,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" alt=""> <img src="data:image/png;base64,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" alt="">
从两张图的对比中，我们可以看到图 1 和图 2 的区别在于线程数和循环次数，一个是 1 和 10，一个则是 10 和 1。从结果来看，图 1 和图 2 都是发送了 10 个请求，那它们的核心区别是什么呢？
先来看图 1 的代码演示：</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">for</span><span class="token punctuation">(</span>int j<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>j<span class="token operator">&lt;</span><span class="token number">10</span><span class="token punctuation">;</span>j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>Thread<span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//打印线程名字</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>这段代码我使用线程循环的方式打印运行线程的名字，运行后的内容如下：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>Thread-0
......
Thread-0
Thread-0 //可以看到是基于同一个线程
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>再来看图 2 的代码演示：</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">for</span><span class="token punctuation">(</span>int i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span><span class="token number">10</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Runnable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>Thread<span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token comment">//示意代码</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>这段代码我是使用多线程的方式打印正在运行的线程，运行后效果如下：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>Thread-0
......
Thread-8
Thread-9 //不同的线程
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>不难看出，循环的方式是基于同一个线程反复进行 10 次操作，而多线程则启动了 10 个不一样的线程，虽然都是向服务器发送了 10 次请求，但这两种方式完成的时间和对系统的压力也完全不一样。</p></li> <li><p>Ramp-Up</p> <ul><li>Ramp-Up 其实是一个可选项，如果没有特殊要求，保持默认配置脚本即可。如果填 1，代表在 1 秒内所有设置线程数全部启动。不过这个是理论上的，实际启动时间也依赖于硬件的接受程度。如果硬件跟不上，启动时间自然也会增加。</li> <li>在有的性能测试场景中，如果你不想在性能测试一开始让服务器的压力过大，希望按照一定的速度增加线程到既定数值，你就可以使用这个选项。比如我想用 10 个线程进行测试，启动速度是每秒 2 个线程，就可以在这里填 5，如下所示：
<img src="data:image/png;base64,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" alt=""></li></ul></li> <li><p>组件和元件的关系
要解释组件首先就要说元件。我们看图 4 中的 HTTP 请求，其实这就是一个实际的元件。同样作为元件的还可以是 JDBC 请求、Java 请求等，这一类元件我们统一称为取样器，也就是组件。我用一个示意图来表示组件和元件的关系：
<img src="/assets/img/uTools_1656148280496.446c5589.png" alt=""></p></li> <li><p>组件的作用</p> <ul><li>JMeter 有多种组件，我们重点看下这七类： 配置元件、取样器、定时器、前置处理器、后置处理器、断言、监听器。</li> <li>配置元件：用于初始化变量，以便采样器使用。类似于框架的配置文件，参数化需要的配置都在配置元件中。</li> <li>取样器：承担 JMeter 发送请求的核心功能，支持多种请求类型，如 HTTP、FTP、JDBC 等，也可以使用 Java 类型的请求进行自定义编写。</li> <li>定时器：一般用来指定请求发送的延时策略。在没有定时器的情况下，JMeter 发送请求是不会暂停的。</li> <li>前置处理器：在进行取样器请求之前执行一些操作，比如生成入参数据。</li> <li>后置处理器：在取样器请求完成后执行一些操作，通常用于处理响应数据，从中提取需要的值。</li> <li>断言：主要用于判断取样器请求或对应的响应是否返回了期望的结果。</li> <li>监听器：监听器可以在 JMeter 执行测试的过程中搜集相关的数据，然后将这些数据在 JMeter 界面上以树、图、报告等形式呈现出来。不过图形化的呈现非常消耗客户端性能，在正式性能测试中并不推荐使用。</li></ul></li> <li><p>组件的顺序
<img src="/assets/img/uTools_1656148451370.362e84c8.png" alt="">
搞懂了组件顺序，你在测试前准备脚本生成参数化数据时，就可以在前置处理器中寻找相关元件；在要提取接口返回的数据，就可以在后置处理器中寻找相关插件，而不是在其他地方寻找数据，浪费时间。</p></li> <li><p>元件作用域
JMeter 元件除了从上到下的顺序外，有还具备一定的层次结构。</p></li> <li><p>分布式压测</p> <ul><li>压测就是 JMeter 通过产生大量线程对服务器进行访问产生负载，监听服务器返回结果并进行校验。在大部分情况下，用单台 JMeter 进行性能测试或者自动化测试是可行的，但在多线程运行过程中可能存在性能瓶颈，很多人在排查定位问题时经常会漏掉这一点。</li> <li>通常，单机的 JMeter 最好将线程数控制在 1000 以内；如果超过了 1000 线程，则建议使用 JMeter 分布式压测，这在一定程度上可以解决 JMeter 客户端自身形成的瓶颈问题。</li> <li>在分布式 JMeter 架构下，JMeter 使用的是 Master 和 Slave。</li> <li>Master 负责远程控制 Slave（负载机）。分布式通常有多个 JMeter 节点，其中一个节点承担 Master 的作用。Master 通过发送信号控制节点机的启动和停止，并进行收集节点机的数据等操作。</li> <li>Slave 一般也叫负载机，主要是发起线程来访问 target 服务器。一般在 Slave 节点机上先启动代理 jar 包，控制机远程连接，负载机运行脚本后对 Master 回传数据。流程示意图如下：</li> <li>JMeter 的 Master 和 Slave 配置也比较简单。将 JMeter 的 bin 目录下的 jmeter.properties 文件配置：IP 和 Port 是 Slave 机的 IP 以及默认的 1099 端口。如下所示：</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>remote_hosts=ip:1099,ip:1099
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li>Slave 启动 jar 包之后，默认会启动 1099 端口。Master 配置完成启动后便可以建立和 Slave 连接，从而进行控制和收集等操作。</li> <li>一般来说，JMeter 分布式压测都是作为缓减客户端瓶颈的重要方式。强调“缓减”，因为在性能测试领域中不存在一种技术手段能够保证永远没有问题。随着公司的体量发展，对性能的要求也是水涨船高。JMeter 自带的分布式压测作为一种缓解客户端性能问题的方式，并不是万能法则。</li></ul></li></ol> <h2 id="jmeter参数化策略"><a href="#jmeter参数化策略" class="header-anchor">#</a> JMeter参数化策略</h2> <ol><li>为什么要进行参数化
<ul><li><strong>数据被缓存导致测试结果不准确</strong></li> <li>缓存原本是为了让数据访问的速度接近 CPU 的处理速度而设置的临时存储区域，比如 cache。如今缓存的概念变得更广了，很多空间都可以设置客户端缓存、CDN 缓存等等。</li> <li>当你频繁地请求某一条固定的数据时，这条数据就很容易被缓存，而不是每次都从数据库中去获取，这就可能导致和真实的场景有差别。</li> <li><strong>流程不能正常执行</strong></li> <li>有的情况是，在没有参数化的情况下，会产生大量的业务报错。打个比方，你在测试限购商品抢购，如果用多线程模拟同一个用户操作可能会直接报错，因为在生成订单接口（支付等）都会判断是否是同一个用户。</li></ul></li> <li>JMeter参数化的实现方式
<ul><li>CSV Data Set Config：将参数化的数据放入文件中，参数化读取依赖于文件操作。这样的参数化方式很常用，尤其适用于参数化数据量较多的场景，而且维护比较简单灵活。</li> <li>User Defined Variables：一般来说可以配置脚本中的公共参数，如域名，端口号，不需要随着压测进行动态改变，比较方便环境切换。</li> <li>Function Helper 中的函数：使用函数的方式生成参数，如果你需要随机数、uuid 等都可以使用函数生成。JMeter 还提供了相应的接口给你二次开发，自定义需要的功能。</li> <li><strong>CSV Data Set Config</strong></li> <li>CSV Data Set Config 的可配置选项较多，也是目前性能测试参数化时使用最多的插件。
<img src="/assets/img/uTools_1656149250999.1feab3a1.png" alt=""></li> <li>文件名：顾名思义，这里填写文件的名字即可。保存参数化数据的文件目录，我这边是将 user.csv 和脚本放置在同一路径下。在这里我要推荐一个小技巧，就是“相对路径”。使用绝对路径，在做脚本迁移时大部分情况下都需要修改。如果你是先在 Windows 或 Mac 机器上修改脚本，再将脚本上传到 Linux 服务器上执行测试的，那你就可以用相对路径，这样就不用频繁修改该选项了。</li> <li>文件编码：指定文件的编码格式，设置的格式一般需要和文件编码格式一致，大部分情况下保存编码格式为 UTF-8 即可。</li> <li>变量名称：对应参数文件每列的变量名，类似 Excel 文件的文件头，主要是作为后续引用的标识符，一般使用英文。通过“${变量名称}”就可以引用需要的文件数据</li> <li>忽略首行： 第一行不读取。比如图 2 的第一行我只是标示这一列是什么类型的数据，实际上并不是需要读取的业务数据，此时就可以采用忽略首行。</li> <li>分隔符：用来标示参数文件中的分隔符号，与参数文件中的分隔符保持一致即可。</li> <li>遇到文件结束符再次循环：是否循环读取参数文件内容。因为 CSV Data Set Config 一次读入一行，如果设置的循环次数超过文本的行数，标示为 True 就是继续再从头开始读入。</li> <li>遇到文件结束符停止线程：读取到参数文件末尾时，是否停止读取线程，默认为 False。如果“遇到文件结束符再次循环”已经设置为 True 了，这个选项就没有意义了。</li> <li>线程共享模式：这个适用范围是一个脚本里多线程组的情况。所有线程是默认选项，代表当前测试计划中的所有线程中的所有的线程都有效；当前线程组代表当前线程组中的线程有效；当前线程则表示当前线程有效。一般情况下，我们选择默认选项“所有线程”就好，“当前线程组”和“当前线程”很少会用到。</li></ul></li> <li>特殊的参数化：关联
关联是将上个请求的数据提取需要的部分放到下个请求中，通过关联我们可以获取到满足业务特性的不同数据，因此可以认为是一种特殊的参数化。</li> <li>JMeter 如何实现关联
<ul><li>JMeter实现关联有 3 种方式：
<ul><li>边界提取器，通过左右边界的方式关联需要的数据；</li> <li>Json Extractor提取器，针对返回的 json 数据类型；</li> <li>正则表达式提取器，通过正则表达式去提取数据，实现关联。(最为常用)</li></ul></li> <li>正则表达式提取器中每一项的含义。
<ul><li>引用名称：自己定义的变量名称以及后续请求将要引用到的变量名。在图中我填写的是“token”，则引用方式是“${token}”。</li> <li>正则表达式：提取内容的正则表达式。“( )”括起来的部分就是需要提取的，“.”点号表示匹配任何字符串，“+”表示一次或多次，“？”表示找到第一个匹配项后停止。</li> <li>模板：用“$ $”引用，表示解析到的第几个值给 token，图 4 中的正则表达式如下：$1$ 表示匹配的第一个值.</li> <li>匹配数字：0 代表随机取值，1 代表第一个值。</li> <li>缺省值：正则匹配失败时的取值。比如这里我设置的是 null（token 值取不到时就会用 null 代替）。</li></ul></li></ul></li></ol> <h2 id="构建并执行jmeter脚本的正确姿势"><a href="#构建并执行jmeter脚本的正确姿势" class="header-anchor">#</a> 构建并执行JMeter脚本的正确姿势</h2> <h3 id="脚本构建"><a href="#脚本构建" class="header-anchor">#</a> 脚本构建</h3> <ol><li>常见的误区
一个线程组、一条链路走到底。脚本中的设计思路实际上也是你对性能测试模型的理解，能够反馈出模型中的用户访问比例分布。</li> <li>未提取公共部分，增加脚本管理难度
一般全链路级别的测试脚本里可能会包含上百个接口，对于一些 host 和端口号，并不需要每一个接口都去配置，我们可以使用一个 HTTP 请求默认值去做公共部分</li> <li>查看结果树使用频率高
在脚本调试过程中，我们通常会添加结果树来实时查看返回数据的正确性。这个插件本身是比较消耗性能的，在正式压测中应当禁止使用。一般来说，在脚本调试中通过作用域的思想去配置一个查看结果树就可以了，不要过度使用，不然等到正式压测的时候，一个个地禁用结果树不仅会消耗时间，还容易遗漏。</li> <li>脚本逻辑复杂
在编写脚本的过程中为了区分业务逻辑，会使用很多插件，比如 if 判断、循环， 这些插件虽然可以让你进入不同的业务场景，但会增加脚本的复杂度，影响发起压力的效率。</li></ol> <ul><li>规范的脚本构建，要做到真实和精简。
<ul><li>真实在于你的脚本可以体现出真实的用户访问场景；</li> <li>精简在于少使用周边的插件，比如通过 JMeter 去监控服务器资源，这样的监控不仅简单粗糙，而且较大地影响 JMeter 的压力发起的效率。</li></ul></li></ul> <h3 id="脚本执行"><a href="#脚本执行" class="header-anchor">#</a> 脚本执行</h3> <ol><li>界面化执行性能测试
图形化模式只让你调试，不要进行压测。图形化的压测方式会消耗较多的客户端性能，在压测过程中容易因为客户端问题导致内存溢出。</li> <li>命令行执行方式<div class="language- line-numbers-mode"><pre class="language-text"><code>jmeter -n -t [jmx file] -l [results file] -e -o [Path to web report folder]
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li>n 表示在非 GUI 模式下运行 JMeter；</li> <li>t 表示要运行的 JMeter 测试脚本文件，一般是 jmx 结尾的文件；</li> <li>l 表示记录结果的文件，默认以 jtl 结尾；</li> <li>e 表示测试完成后生成测试报表；</li> <li>o 表示指定的生成结果文件夹位置。</li></ul></li> <li>命令行方式存在2个问题
<ul><li>看不到实时的接口返回报错的具体信息；</li> <li>看不到混合场景下的每个接口的实时处理能力。</li> <li>问题解决：
<ul><li>jmeter.log看到只能显示报错率，但看不到具体的报错内容，那如何去解决呢？一般会使用 beanshell，把判定为报错的内容增加到log里。<div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>String response <span class="token operator">=</span> prev<span class="token punctuation">.</span><span class="token function">getResponseDataAsString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//获取接口响应信息</span>
String code <span class="token operator">=</span> prev<span class="token punctuation">.</span><span class="token function">getResponseCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//获取接口响应状态码</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>code<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">&quot;200&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment">//根据返回状态码判断</span>
	log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;Respnse is &quot;</span> <span class="token operator">+</span> response<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">//打印正确的返回信息，建议调试使用避免无谓的性能消耗</span>
<span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token punctuation">{</span>
	log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;Error Response is&quot;</span><span class="token operator">+</span>response<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">//打印错误的返回信息</span>
	<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><ul><li>客户端的日志只是我们需要关注的点之一，排查错误的根因还需要结合服务端的报错日志，一般来说服务端的报错日志都有相关的平台记录和查询，比较原始的方式也可以根据服务器的路径找相关日志。</li></ul></li> <li>如果想实时且直观地看到每个接口的处理能力，我比较推荐 JMeter+InfluxDB+Grafana 的方式。
<ul><li>jmeter集群--》influxdb存储--》grafana实时数据展示</li> <li><strong>InfluxDB</strong></li> <li>InfluxDB 是 Go 语言编写的时间序列数据库，用于处理海量写入与负载查询。涉及大量时间戳数据的任何用例（包括 DevOps 监控、应用程序指标等）。我认为 InfluxDB 最大的特点在于可以按照时间序列面对海量数据时候的高性能读写能力，非常适合在性能测试场景下用作数据存储。</li> <li>安装<div class="language- line-numbers-mode"><pre class="language-text"><code>#wgethttps://dl.influxdata.com/influxdb/releases/influxdb-1.1.0.x86_64.rpm
#rpm -ivh Influxdb-1.1.0.x86_64.rpm
#systemctl enable Influxdb
#systemctl start Influxdb
#systemctl status Influxdb  （查看 Influxdb 状态）
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></li> <li>基本操作<div class="language- line-numbers-mode"><pre class="language-text"><code>#influx 
linux 命令行模式下进入数据库
#show databases
查看库
create database jmeter；
建库
use jmeter
使用该库
show measurements;
查看库下面的表
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div></li> <li>InfluxDB 成功安装并且建库之后，我们就可以来配置 JMeter 脚本了。配置过程可以分为以下 3 步
<ul><li>添加核心插件，在 listener 组件中选择 Backend Listener</li> <li>Backend Listener implementation 中选择第二项</li> <li>配置 InfluxDB URL，示例“http://127.0.0.1:8086/write?db=jmeter”；IP 为实际 InfluxDB 地址的 IP，DB 的值是 InfluxDB 中创建的库名字</li></ul></li> <li><strong>Grafana</strong></li> <li>Grafana 是一个跨平台的开源的度量分析和可视化工具，纯 JavaScript 开发的前端工具，通过访问库（如 InfluxDB），展示自定义报表、显示图表等。大多时候用在时序数据的监控上。Grafana 功能强大、UI 灵活，并且提供了丰富的插件。</li> <li>安装<div class="language- line-numbers-mode"><pre class="language-text"><code>#wget https://dl.grafana.com/oss/release/grafana-6.4.4-1.x86_64.rpm
#下载 granafa
#yum install  Grafana-6.4.4-1.x86_64.rpm
#安装，遇到需要输入的直接 y 就 ok；
#systemctl start Grafana-server
#systemctl enable Grafana-server
#启动 Grafana
#/etc/Grafana/Grafana.ini
配置文件路径，一般保持默认配置即可。
#systemctl status  firewalld.service
查看防火墙状态，防止出现其他干扰问题，最好关闭
登录访问 Grafana 访问：http://127.0.1.1:3000（ip 自行替换，3000 为默认端口）
默认账号/密码：admin/admin
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div></li> <li>数据源配置
<ul><li>配置安装的 InfluxDB 地址和端口号</li></ul></li> <li>导入 JMeter 模板
<ul><li>为了达到更好的展示效果，Grafana 官网提供了针对性的展示模版。先下载<a href="https://grafana.com/Grafana/dashboards?search=InfluxDB" target="_blank" rel="noopener noreferrer">JMeter模板<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，然后再导入 Grafana。</li> <li>可以以此为基础，进行多接口的数据采集，相应增加脚本里的 Backend Listener 插件，区分不同的 application name 名称，你会看到不同的接口数据都进入 influxdb 数据库中。并且 Grafana 从 Edit 中进入， 你可以根据不同的 application name 修改 SQL 来区分展示。</li></ul></li></ul></li></ul></li></ul></li></ol> <h2 id="jmeter二次开发"><a href="#jmeter二次开发" class="header-anchor">#</a> JMeter二次开发</h2> <h3 id="beanshell-java源码解释器"><a href="#beanshell-java源码解释器" class="header-anchor">#</a> Beanshell（Java源码解释器）</h3> <ol><li>Beanshell作为一款解释器，可以直接运行源代码，不需要像Java运行前得编译</li> <li>Beanshell在Jmeter中的作用
<ul><li>前置处理器：接口请求前逻辑处理，参数化数据</li> <li>后置处理器：数据提取，参数格式设置</li> <li>Sampler：独立请求，支持各类请求编写，数据生成</li></ul></li> <li>常见用法<div class="language-java line-numbers-mode"><pre class="language-java"><code>log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;code is  &quot;</span><span class="token operator">+</span>prev<span class="token punctuation">.</span><span class="token function">getResponseCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
#获取响应的状态码

log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;response is &quot;</span><span class="token operator">+</span>prev<span class="token punctuation">.</span><span class="token function">getResponseDataAsString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
#获取响应信息

log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;content_type  &quot;</span><span class="token operator">+</span>prev<span class="token punctuation">.</span><span class="token function">getContentType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
#获取头文件中<span class="token class-name">ContentType</span>类型

log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;header &quot;</span><span class="token operator">+</span>prev<span class="token punctuation">.</span><span class="token function">getRequestHeaders</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
#获取取样器请求首部字段
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div></li> <li>注意点
<ul><li>不建议过度使用这个插件， 因为JMeter高并发时，会消耗较多的本地资源</li> <li>一般遇到逻辑相对复杂且代码量较大的情况，通常采用自定义插件（jar 形式）</li></ul></li></ol> <h3 id="java-sampler"><a href="#java-sampler" class="header-anchor">#</a> Java Sampler</h3> <ul><li>自行拓展的请求或者不支持的测试协议</li> <li><a href="https://mvnrepository.com/" target="_blank" rel="noopener noreferrer">maven仓库<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <h3 id="函数助手"><a href="#函数助手" class="header-anchor">#</a> 函数助手</h3> <h2 id="基于jmeter-api开发性能测试平台-backlog"><a href="#基于jmeter-api开发性能测试平台-backlog" class="header-anchor">#</a> 基于JMeter API开发性能测试平台（backlog）</h2> <h2 id="nginx在系统架构中的作用"><a href="#nginx在系统架构中的作用" class="header-anchor">#</a> Nginx在系统架构中的作用</h2> <h3 id="nginx重要的两个概念"><a href="#nginx重要的两个概念" class="header-anchor">#</a> Nginx重要的两个概念</h3> <ol><li>代理
<ul><li>正向代理
<ul><li>正向代理的特点是你非常清楚地知道你要去哪儿，访问什么服务器，但服务器并不关心你的出发地是哪里，它只知道你从哪个代理服务器过来。</li></ul></li> <li>反向代理
<ul><li>先来说一下应用场景，比如我们的内部服务器集群，是不可能直接暴露出来让外网访问的，这样安全风险就非常大；再比如现在很多网站为了提高性能都采用了分布式部署，通过多台服务器来缓减服务端的压力，这些都可以通过 Nginx 来完成。</li> <li>那我们的外网用户如何能够访问到内部的应用呢，Nginx 可以暴露端口给外网用户访问，当接收到请求之后分发给内部的服务器，此时的 Nginx 扮演的是反向代理的角色。这样一个过程，客户端是明确的，但对于访问到哪台具体的应用服务器是不明确的。</li></ul></li></ul></li> <li>负载均衡
负载均衡是 Nginx 最重要也是最常见的功能
<ul><li><strong>轮询</strong></li> <li>也就是使用平均分配的方式，将每个请求依次分配到配置的后端服务器上。除非有服务宕机，才会停止分发。</li></ul> <div class="language-shell script line-numbers-mode"><pre class="language-shell"><code>upstream localhost <span class="token punctuation">{</span>
//分发到各应用服务
	  server  <span class="token number">127.0</span>.0.1:7070<span class="token punctuation">;</span>
	  server  <span class="token number">127.0</span>.0.1:7071<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	server<span class="token punctuation">{</span>
//Nginx核心监听端口
		listen <span class="token number">8012</span><span class="token punctuation">;</span>
		server_name localhost<span class="token punctuation">;</span>
		location / <span class="token punctuation">{</span>
				proxy_pass         http://localhost<span class="token punctuation">;</span>
				proxy_set_header   Host             <span class="token variable">$host</span><span class="token punctuation">;</span>
				proxy_set_header   X-Real-IP        <span class="token variable">$remote_addr</span><span class="token punctuation">;</span>
				proxy_set_header   X-Forwarded-For  <span class="token variable">$proxy_add_x_forwarded_for</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><ul><li><strong>权重</strong></li> <li>权重即配置轮询的比重，为什么需要这么配置呢？在真实的互联网场景下，很多服务器上都会配置多个应用，这样会导致每台服务器的资源占用不一致，所以在分布式部署配置下也需要注意这一点。相对空闲的机器可以多配置访问比例；比较繁忙的机器可以少配置一些。</li></ul> <div class="language-shell script line-numbers-mode"><pre class="language-shell"><code>upstream <span class="token builtin class-name">test</span> <span class="token punctuation">{</span>
server ip1:8080 <span class="token assign-left variable">weight</span><span class="token operator">=</span><span class="token number">9</span><span class="token punctuation">;</span>
server ip2:8081 <span class="token assign-left variable">weight</span><span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ul><li><strong>ip_hash</strong></li> <li>但上面两种配置方式在电商场景下有个很常见的问题，比如你登录了一个网站，登录信息已经保存到 a 机器，但当你做后续操作时的请求会到 b 机器，那么就获取不到你原来登录的信息，此时你就需要重新登录了。这样的情况是用户肯定不能接受的，ip_hash 模式就可以很好地解决这个问题，让每次访问能基于同一用户访问固定的服务器。</li></ul> <div class="language-shell script line-numbers-mode"><pre class="language-shell"><code>upstream <span class="token builtin class-name">test</span> <span class="token punctuation">{</span>
	ip_hash<span class="token punctuation">;</span>
	server localhost:8080<span class="token punctuation">;</span>
	server localhost:8081<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></li></ol> <h3 id="nginx日志分析"><a href="#nginx日志分析" class="header-anchor">#</a> Nginx日志分析</h3> <ol><li>awk
<ul><li>awk 可以将文本中的内容按行去读取，然后将读取出来的行按照规定的分隔符去提取你所需要的内容。</li> <li>awk 常用参数是 -F 指定分隔符。</li></ul> <div class="language-shell script line-numbers-mode"><pre class="language-shell"><code>比如以下代码就是以 <span class="token builtin class-name">:</span> 为分隔符，寻找以 root 开头的行数据，打印第 <span class="token number">7</span> 列
<span class="token function">awk</span> -F <span class="token builtin class-name">:</span> <span class="token string">'/^root/{print $7}'</span> /etc/passwd
/bin/bash
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><div class="language-shell script line-numbers-mode"><pre class="language-shell"><code>以下代码表示以 begin 开头、end 结尾，打印第 <span class="token number">1</span> 列数据。
<span class="token function">awk</span> -F <span class="token builtin class-name">:</span> <span class="token string">'BEGIN{print &quot;begin&quot;}{print $1} END{print &quot;end&quot;}'</span> /etc/passwd
begin
root
<span class="token punctuation">..</span>
end
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div></li> <li>Sed
<ul><li>Sed 是一个流编辑器，一次只能处理一行内容，需要注意的是 sed 并不改变文本本身的内容，它只是把结果存放在临时缓冲区中。</li> <li>sed 常用的参数有：
<ul><li>a 表示新增；</li> <li>i 表示插入；</li> <li>c 表示取代；</li> <li>d 表示删除。</li></ul></li></ul> <div class="language-shell script line-numbers-mode"><pre class="language-shell"><code>设置一个文本文件，每行只有一个数字
<span class="token punctuation">[</span>root@JD data<span class="token punctuation">]</span><span class="token comment"># cat sed.txt</span>
<span class="token number">1</span>
<span class="token number">2</span>
<span class="token number">3</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><div class="language-shell script line-numbers-mode"><pre class="language-shell"><code>在第一行下新增 <span class="token number">4</span>
<span class="token punctuation">[</span>root@JD data<span class="token punctuation">]</span><span class="token comment"># sed '1a 4' sed.txt</span>
<span class="token number">1</span>
<span class="token number">4</span>
<span class="token number">2</span>
<span class="token number">3</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div>看下原来的文本，你会发现没有任何改动</li> <li>Sort
<ul><li>Sort 的默认方式就是把第一列根据 ASCII 值排序输出。常用参数有：
<ul><li>n，依照数值的大小排序；</li> <li>r，以相反的顺序来排序；</li> <li>k，选择以某个区间进行排序。</li></ul></li></ul> <div class="language-shell script line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@JD data<span class="token punctuation">]</span><span class="token comment"># sort -r sed.txt</span>
<span class="token number">3</span>
<span class="token number">2</span>
<span class="token number">1</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></li> <li>uniq
<ul><li>uniq 用于检查或者统计文本出现的重复行，常用参数是 -c，它用于连续重复行次数的统计。</li></ul> <div class="language-shell script line-numbers-mode"><pre class="language-shell"><code>构造一个 uniq.txt
<span class="token punctuation">[</span>root@JD data<span class="token punctuation">]</span><span class="token comment"># cat uniq.txt</span>
hello
hello
quanquan
quanquan
quanquan
nihao
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><div class="language- line-numbers-mode"><pre class="language-text"><code>然后对 uniq.txt 进行重复数据统计，并根据重复次数由大到小排序
[root@JD data]# uniq -c uniq.txt |sort -r
 3 quanquan
 2 hello
 1 nihao
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></li></ol> <p>学完了这些基础命令，我带你来看 Nginx 日志分析，如果你不清楚你的 Nginx 日志地址，查看nginx.conf 文件的配置即可</p> <div class="language-ini line-numbers-mode"><pre class="language-ini"><code>120.204.101.238 - - [29/Nov/2020:14:19:39 +0800] &quot;GET /hello/map HTTP/1.1&quot; 200 202 
47.92.11.105 - - [29/Nov/2020:14:19:39 +0800] &quot;GET /hello/map HTTP/1.1&quot; 200 202 
185.39.101.238 - - [29/Nov/2020:14:19:39 +0800] &quot;GET /hello/list HTTP/1.1&quot; 200 150 &quot;-
101.132.114.23 - - [29/Nov/2020:14:19:39 +0800] &quot;GET /hello/list HTTP/1.1&quot; 200 150 &quot;-
120.204.101.238 - - [29/Nov/2020:14:19:39 +0800] &quot;POST /v1/login HTTP/1.1&quot; 200 36 &quot;-
...
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><div class="language-shell script line-numbers-mode"><pre class="language-shell"><code>打印第 <span class="token number">7</span> 列
<span class="token function">awk</span> <span class="token string">'{print $7}'</span>  access.log
/hello/list
/v1/login
/hello/list
/hello/map
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><div class="language-shell script line-numbers-mode"><pre class="language-shell"><code>统计访问接口的比例分布
<span class="token function">cat</span> access.log <span class="token operator">|</span><span class="token function">awk</span> <span class="token string">'{print $7}'</span><span class="token operator">|</span><span class="token function">sort</span><span class="token operator">|</span><span class="token function">uniq</span> -c<span class="token operator">|</span><span class="token function">sort</span> -n -k -r
先 <span class="token function">sort</span> 排序，这样可以将相同的接口访问路径合并一起；
再使用 <span class="token function">uniq</span> -c 统计连续访问的次数；
最后根据访问次数排序，便可以得到结果。
  <span class="token number">87280</span> /hello/list
  <span class="token number">18892</span> /hello/map
  <span class="token number">12846</span> /v1/login
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h2 id="如何制定性能测试目标"><a href="#如何制定性能测试目标" class="header-anchor">#</a> 如何制定性能测试目标</h2> <p>制定目标可以确定既定的测试范围内需要达到的性能预期结果。制定目标后，你才会对本次性能测试的核心目标有清晰的认知，并指导你进行后续的测试活动，包括测试所需要的资源以及测试的停止条件等。</p> <ol><li>TPS
<ul><li>在实际生产中，无论是网关还是服务通常都是记录一定时间内的访问请求次数，所以在业内，性能测试往往以 TPS（Transactions Per Second）作为最重要的度量指标，因为它具备可度量和通用性的特质。
<ul><li>可度量指TPS是真实客观且明确的衡量指标；</li> <li>通用性指无论在运维角度还是测试角度，TPS 都可以达成一致的定义。</li></ul></li></ul></li> <li>响应时间
<ul><li>响应时间和用户体验密切相关，我们往往把一次请求从客户端发出到返回客户端的时间作为响应时间。在实际工作中，我们会以 TPS 的量级来限制响应时间必须在多久之内。以下图，从最左侧的客户端到最右侧的数据持久化再返回到客户端，这样一个来回的过程就是一次完整的请求响应时间。
<img src="/assets/img/uTools_1656212778361.603f9849.png" alt="">
上图描述的是在正常情况下的响应流程，但当你有了一定的性能测试实践之后，你会发现这样的过程并不是绝对的。比如有的业务第一次在数据库请求到数据后，应用层本地缓存会将数据存储在应用服务器上，也就是接下来在缓存有效时间内不会再去数据库取数据，而是在应用层得到数据后就会直接返回，所以响应时间会比第一次低不少，这也是随着性能测试的进行响应时间变低的原因之一</li></ul></li> <li>报错率
<ul><li>报错率的计算方式是在统计时间范围内不符合返回期望的请求数除以总共的请求数。在测试中，这一指标不符合期望的话一般体现在对结果的校验上，一般会分为三个层面进行校验：
<ul><li>状态码的校验，这在性能工具中不需要特别设置，如 4XX、5XX 这样的状态码会直接报错；</li> <li>业务层面的校验，为了保证业务的基本准确性，会通过返回的数据包进行校验；</li> <li>数据库校验， 相对于业务测试，性能测试的每一次请求不会都做数据库校验，这样会影响性能测试结果，我一般会在一轮性能测试之后去统计落库数据的数量和状态是否正常。</li></ul></li></ul></li></ol> <h3 id="制定性能测试指标"><a href="#制定性能测试指标" class="header-anchor">#</a> 制定性能测试指标</h3> <ol><li>以衡量系统的处理能力为核心目标
<ul><li>这一般是性能测试的主要目标，用来评估当前系统的处理能力和容量方面的规划，评估这个目标最重要的是对数据的客观分析。</li> <li>对于每一个接口都会有访问计数，这是目前业内比较常见的，也是衡量接口访问能力最准确的指标之一。一般大公司会自己开发相应的监控工具，发展中的公司也会使用一些开源或者商业工具进行监控。通过时间维度和服务维度来统计。</li> <li><strong>时间维度</strong> <ul><li>首先确定哪些天数的访问量是比较高的，先以天作为维度统计</li> <li>选取了天数之后，再以小时为维度，确定哪些时间节点的访问量是比较高的。</li></ul></li> <li><strong>服务维度</strong>
网关一般是请求进入应用层的第一个入口，也是统计网站入口访问量的方式之一。当我们的请求通过网关之后会下发到各个业务应用服务，按照确定的时间节点去统计各个服务的访问量数据。完成服务级的访问数据统计之后，继续按照时间维度统计服务下的接口访问数据。</li></ul></li> <li>系统的健壮性
如内存泄漏、并发死锁、超卖问题，这些也需要在性能测试方向上进行。</li> <li>系统的稳定性
<ul><li>一个是正确率，这不一定要在高并发下完成，但我们要保证业务长时间运行的正确率能够达到 99.9999% 以上；</li> <li>另一个是处理能力，可以选取性能测试场景中的混合场景来执行，这里我们需要观察两点：
<ul><li>整体处理能力是否稳定，会不会存在处理能力的下滑；</li> <li>接口之间的比例是否稳定，随着时间的进行接口之间的访问比例会不会偏离。</li></ul></li></ul></li> <li>专项能力是否达标
以上列举的几乎都是以业务接口为测试目标，其实在实际的压测活动中，也存在中间件甚至硬件的性能测试，比如 Nginx、Kafka、防火墙等。这些往往不会作为最终的性能测试目标，但会在全链路排障和专项测试中有所涉及。这部分的性能测试基本上是用来判断当前的环境配置的节点数，以及配置所能达到的最大处理能力，为全链路性能测试提供数据支撑。</li></ol> <h2 id="性能测试场景的分类和意义"><a href="#性能测试场景的分类和意义" class="header-anchor">#</a> 性能测试场景的分类和意义</h2> <h3 id="基准场景"><a href="#基准场景" class="header-anchor">#</a> 基准场景</h3> <p>基准场景是指单线程或者少量线程（一般在 5 个线程以下）对单接口进行测试，然后将测试结果作为基准数据，在系统调优或者评估的过程中，通过运行相同的业务接口比较测试结果，为系统的优化以及后续测试流程提供决策数据。</p> <ul><li>作用
<ul><li>验证测试脚本及测试参数的正确性，同时也可以验证脚本数据是否能够支持重复性测试等；</li> <li>通过少量线程访问系统获取结果数据，作为对比参考基准；</li> <li>根据测试结果，初步判断可能成为系统瓶颈的场景，并决定是否进行后续的测试；</li> <li>基准场景的结果被一部分公司作为上线的基线指标，不达到要求是不允许上线的，这样的场景也经常被固化成自动化的脚本定时触发和巡检。</li></ul></li></ul> <h3 id="单接口负载场景"><a href="#单接口负载场景" class="header-anchor">#</a> 单接口负载场景</h3> <p>单接口负载场景就是通过模拟多线程对单接口进行负载测试。具体做法是选定线程数后持续循环运行一定时间，比如分别运行 100 线程、200 线程、300线程等，一般相同线程数运行 10～15 min，然后获取事务响应时间、TPS、报错率，监测测试系统的各服务器资源使用情况（CPU、内存、磁盘、网络等），把具体数据记录之后再开始跑下一个线程数。每一组线程数级别会有对应的 TPS，直到你找到 TPS 的拐点。如下图所示，横坐标是线程数，纵坐标是 TPS，线程数增加到 400 时出现了拐点。
<img src="/assets/img/uTools_1656217644330.fa0b005b.png" alt=""></p> <ul><li>注意的点有两个
<ul><li>使用工具做性能测试时，动辄就是上千的线程数，更加倾向于从一个相对比较低的线程数梯度增加，这样才能够比较清晰地找到 TPS 的拐点。</li> <li>建议为每个虚拟用户级别做单独的场景，网上绝大部分的教程，在一个场景中做了很多梯度，其实很不利于分析和诊断。因为并不是每一个量级的性能表现都是类似的，而且一个场景多梯度出来的报表也可能没你想象中的清晰明了。在 JMeter 的聚合报告中还会将结果数据平均化，这样的方式并不能准确地记录每个线程梯度对应的 TPS。而在一个场景里先固定虚拟用户可以将自己的精力聚焦在诊断上。</li></ul></li></ul> <h3 id="混合场景负载测试"><a href="#混合场景负载测试" class="header-anchor">#</a> 混合场景负载测试</h3> <ul><li>混合场景是性能测试中最重要的场景之一，这个场景是为了最大程度模拟用户真实的操作。</li> <li>使用JMeter去控制场景比例
<ul><li>JMeter 提供了一个能较好地解决这个问题的插件，叫作吞吐量控制器，它在逻辑控制器组件中</li> <li>默认的情况下使用的是百分比模式，也就是 Percent Excutions。吞吐量一栏对应的是 TPS 占比
以上是所说的基石场景，包括基准测试、负载测试、混合场景测试等，这三个场景是有依次执行的顺序关系的，按照顺序执行更容易发现问题且减少不必要的工作，比如你连基准测试都不通过，就没有必要进行负载测试了。</li></ul></li></ul> <h3 id="异常性能测试"><a href="#异常性能测试" class="header-anchor">#</a> 异常性能测试</h3> <ul><li>性能测试也是存在异常测试的，顾名思义就是在系统异常的情况下看系统的处理能力或者是通过处理后的恢复能力是如何的。</li> <li>比如在架构的高可用方面，遇到服务的上下线、数据库的主从切换等这些情况的时延是多少、处理能力能不能达到预期标准。另外在目前的电商应用架构中，大促遇到紧急情况经常需要限流和熔断，可能你经常听到这两个词，但不是特别清楚两者的区别。</li> <li>限流就是控制单位时间内的请求量，比如说早晚高峰坐地铁，很多入口都会放隔离带，降低乘客流动速度，这就是一种限流方式。</li> <li>熔断就比较直接了，当判断到调用的依赖服务报错到达一定数量后，直接返回一个既定的数据，将不再访问该服务。就像家中的保险丝一样，到达一定条件后，会自行断电，以保障电路安全。所以我们也会测试触发限流和熔断所设置的阈值，并观察在触发后的系统表现是如何的。</li></ul> <h3 id="稳定性性能测试"><a href="#稳定性性能测试" class="header-anchor">#</a> 稳定性性能测试</h3> <ul><li>性能测试中的稳定性测试是通过给系统加载一定压力的情况下，运行较长一段时间，验证系统是否稳定。通常是采用典型混合场景，应用系统运行 72 小时，查看系统运行指数是否平稳。</li> <li>稳定性测试的注意点</li> <li>稳定性测试在性能测试中是一个相对严苛的场景，因为在 72 小时中可能发生的事情太多了，不仅仅是业务承载的问题，还包括你准备的数据、客户端稳定性，甚至硬件设备断网断电等。任何一项意外的发生，都会造成场景的失败。稳定性测试的监控级别也应当更高，一旦有问题，立即钉钉或者电话通知，所以稳定性测试之前需要有充足的预案和监控报警。</li></ul> <h3 id="什么情况下可以停止负载测试"><a href="#什么情况下可以停止负载测试" class="header-anchor">#</a> 什么情况下可以停止负载测试</h3> <ul><li>在梯度增加线程数时，TPS 一般会随之发生变化，当你能够根据 TPS 的变化找到相应的峰值且这个值也是符合预期时，便可以停止负载测试了。</li> <li>很多时候当你还没有到拐点时，接口就可能在报错了，那遇到这样的情况是继续测试还是停止测试呢？这其实是一个约定的问题，即测试的结束条件是什么？
<ul><li>理想的情况下自然是达到目标就停止了。</li> <li>那不理想呢？根据经验，会在测试之前组内协商出场景异常情况下的停止条件，比如 CPU 达到 70%，响应时间超过 500 ms，接口正确率低于 99% 等，当触发这些条件时，我将不会继续加线程进行测试了。</li></ul></li></ul> <h2 id="制定一份有效的性能测试方案"><a href="#制定一份有效的性能测试方案" class="header-anchor">#</a> 制定一份有效的性能测试方案</h2> <p>性能测试方案：指导性能测试的方案，含测试目的，测试方法，测试场景，环境配置，测试排期，测试资源，风险分析等</p> <h3 id="性能测试方案要点及解决的问题"><a href="#性能测试方案要点及解决的问题" class="header-anchor">#</a> 性能测试方案要点及解决的问题</h3> <ol><li>为测试活动做计划，每项测试活动的对象、范围、方法、进度、预期结果更透明化</li> <li>制定有效测试模型，能排查性能问题，更符合真实场景</li> <li>确定测试所需人力、时间、资源，保证可获得性，有效性</li> <li>预估和消除性能测试活动存在的风险，降低由不可能消除的风险带来的损失</li></ol> <h3 id="测试方案包含的内容"><a href="#测试方案包含的内容" class="header-anchor">#</a> 测试方案包含的内容</h3> <ol><li>测试目的
<ul><li>测试指标？测试稳定性？</li></ul></li> <li>测试场景</li> <li>业务架构（画一个部署图）
<ul><li>被测服务涉及哪些组件</li> <li>组件部署在哪些服务器</li> <li>服务器的配置</li></ul></li> <li>测试数据
<ul><li>数据量分析（线上实际的数据量，如果有生产数据，可以脱敏后备份使用，没有需要自己构造）</li> <li>压测增量数据分析（一轮性能测试，增加的数据最终会落库，会经过中间件如redis、mq等，涉及到的链路数据量激增，需根据增加情况制定兜底方案）</li> <li>参数化数据分析</li> <li>冷热数据分析（冷数据指没有经常访问的数据，通常存放数据库，读写效率相对低；热数据指经常被访问的数据，一般放缓存。测试过程中频繁访问冷数据会转变成热数据，如参数化数据较少，TPS会越来越高）</li></ul></li> <li>业务规则
<ul><li>对业务了解有助提高编写脚本效率，有助构造真实场景</li></ul></li> <li>监控内容
<ul><li>硬件监控，CPU、磁盘、内存、网络等</li> <li>系统监控，实时连接数、连接状态、Redis缓存命中率（Redis_exporter或者Grafana插件Redis-datasource）、JVM监控、Mysql（满日志、读写速度）、中间件MQ（生产速度、消费速度、堆积量）</li> <li>监控设置阈值报警</li> <li><a href="https://prometheus.io/docs/instrumenting/exporters/" target="_blank" rel="noopener noreferrer">各种监控exporter<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li> <li>性能测试排期
<ul><li>性能测试需要大量的数据和专门的环境，需要工作内容和资源支持</li> <li>明确开展的阶段和日期，主要负责人和协助人员</li></ul></li></ol> <h2 id="命令行监控linux服务器"><a href="#命令行监控linux服务器" class="header-anchor">#</a> 命令行监控Linux服务器</h2> <h3 id="层次清晰"><a href="#层次清晰" class="header-anchor">#</a> 层次清晰</h3> <ol><li>硬件层
一般包含了 CPU 的使用率、内存使用率、磁盘和网络读写速度等，通过这些指标能够反馈出系统运行的基本情况，以及不同的 TPS 量级会消耗多少硬件资源。</li> <li>系统层
系统层监控包括连接请求数、拒绝数、丢包率、请求超时等，相对于基础的硬件监控而言，这些指标更能够反映出目前系统存在的瓶颈，从而为根因问题的定位提供有力的线索。</li> <li>链路层
链路层是直接面向架构和代码的，它的监控能够帮助你更加准确地看到代码执行了哪些函数，涉及哪些服务，并且能够较为清晰地看到函数之间的调用耗时，还可以帮助你定位代码存在的问题。</li> <li>业务层
业务层监控本意是帮助你判断用户输入是否合规，代码逻辑是否健壮。对于性能测试而言，业务层的监控可以帮助你发现脚本参数问题以及高并发下业务逻辑运行是否正常等，比如随着测试的进行，可能会存在商品库存不足的情况。如果有业务层面的监控，当库存低于某阈值时，可以进行一定的提示以规避此类问题。</li></ol> <h3 id="全面覆盖"><a href="#全面覆盖" class="header-anchor">#</a> 全面覆盖</h3> <p>除了应用层的监控，你还需要考虑底层链路的监控，比如防火墙、F5 负载均衡等</p> <h3 id="定向深入"><a href="#定向深入" class="header-anchor">#</a> 定向深入</h3> <p>首先通过基本的监控可以获得一些异常点，比如 CPU 高了、磁盘在等待，这些说白了是表象问题。对于监控，是否有定位根因问题的手段，CPU 高了，需不需要进行线程分析，需要哪些权限和定位工具，这些在监控部署时都需要考虑到。</p> <ol><li>CPU
<ul><li>top 是我们查看各个进程的资源占用状况最常用的命令。</li></ul> <div class="language-shell script line-numbers-mode"><pre class="language-shell"><code><span class="token function">top</span> - <span class="token number">18</span>:17:47 up <span class="token number">158</span> days,  <span class="token number">9</span>:32,  <span class="token number">2</span> users,
load average: <span class="token number">0.07</span>, <span class="token number">0.15</span>, <span class="token number">0.21</span>
Tasks: <span class="token number">154</span> total,   <span class="token number">1</span> running, <span class="token number">152</span> sleeping,   <span class="token number">0</span> stopped,   <span class="token number">1</span> zombie
%Cpu<span class="token punctuation">(</span>s<span class="token punctuation">)</span>:  <span class="token number">3.9</span> us,  <span class="token number">1.3</span> sy,  <span class="token number">0.0</span> ni, <span class="token number">94.6</span> id,  <span class="token number">0.2</span> wa,  <span class="token number">0.0</span> hi,  <span class="token number">0.0</span> si,  <span class="token number">0.0</span> st
KiB Mem <span class="token builtin class-name">:</span>  <span class="token number">8010676</span> total,   <span class="token number">337308</span> free,  <span class="token number">6036100</span> used,  <span class="token number">1637268</span> buff/cache
KiB Swap:        <span class="token number">0</span> total,        <span class="token number">0</span> free,        <span class="token number">0</span> used.  <span class="token number">1223072</span> avail Mem
以下省略
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><ul><li><strong>load average</strong></li></ul> <div class="language-shell script line-numbers-mode"><pre class="language-shell"><code>load average: <span class="token number">0.07</span>, <span class="token number">0.15</span>, <span class="token number">0.21</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li>三个数字都是代表进程队列的长度，从左到右分别表示一分钟、 五分钟和十五分钟的数据，数字越小压力值就越低，数字越大则压力越高</li> <li>以单核处理器为例
<ul><li>0 表示没有任何车辆需要通过；</li> <li>从 0 到 1 可以认为很流畅，车辆不需要任何等待就可以通过；</li> <li>1 表示正好在这个通道可接受范围之内；</li> <li>超过 1 就已经有车辆在后面排队了。</li></ul></li> <li>所以理想情况下，希望平均负载值在 1 以下。如果是 1 就代表目前没有可用资源了。在实际情况中，很多运维同学会把理想负载设置在 0.7 以下，这也是业内的一个“经验值”。</li> <li>多核 CPU 的话，负载数值 / CPU 核数在 0.00~1.00 之间表示正常，理想值也是在 0.7 以内。</li> <li><strong>CPU 状态</strong></li></ul> <div class="language-shell script line-numbers-mode"><pre class="language-shell"><code> %Cpu<span class="token punctuation">(</span>s<span class="token punctuation">)</span>:  <span class="token number">3.9</span> us,  <span class="token number">1.3</span> sy,  <span class="token number">0.0</span> ni, <span class="token number">94.6</span> id,  <span class="token number">0.2</span> wa,  <span class="token number">0.0</span> hi,  <span class="token number">0.0</span> si,  <span class="token number">0.0</span> st
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li>us(user) 列显示了用户进程所花费 CPU 时间的百分比。这个数值越高，说明用户进程消耗的 CPU 时间越多，可以用来分析代码中的 CPU 消耗热点。</li> <li>sy(system) 列表示系统进程消耗的 CPU 时间百分比。</li> <li>ni(?) 列表示改变优先级的进程占用 CPU 的百分比。</li> <li>id(idle) 列表示 CPU 处于空闲状态的时间百分比。</li> <li>wa(?) 列显示了 I/O 等待所占用的 CPU 时间的百分比，这里 wa 的参考值为 0.5，如果长期高于这个参考值，需要注意是否存在磁盘瓶颈。</li> <li>hi(hardware interrupt) 列表示硬件中断占用 CPU 时间百分比。</li> <li>si(software interrupt) 列表示软件中断占用 CPU 时间百分比。</li> <li>st(?) 列表示当系统运行在虚拟机中时，当前虚拟机在等待 CPU 为它服务的时间。</li> <li>在已经输入 top 的情况下再输入数字 1，可以查看 CPU 的核数和每个核的运行状态</li></ul> <div class="language-shell script line-numbers-mode"><pre class="language-shell"><code>%Cpu0 <span class="token builtin class-name">:</span> <span class="token number">3.0</span> us, <span class="token number">1.7</span> sy, <span class="token number">0.0</span> ni, <span class="token number">95.3</span> id, <span class="token number">0.0</span> wa, <span class="token number">0.0</span> hi, <span class="token number">0.0</span> si, <span class="token number">0.0</span> st
%Cpu1 <span class="token builtin class-name">:</span> <span class="token number">2.4</span> us, <span class="token number">1.0</span> sy, <span class="token number">0.0</span> ni, <span class="token number">96.6</span> id, <span class="token number">0.0</span> wa, <span class="token number">0.0</span> hi, <span class="token number">0.0</span> si, <span class="token number">0.0</span> st
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ul><li>看 CPU 的使用率时，只看 us 这个数值，是不准确的。除了用户进程，还有其他系统进程会占用 CPU，所以实际 CPU 的使用率可以用 100 减去空闲值（id）去计算。</li></ul></li> <li>内存
<strong>free</strong><div class="language-shell script line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@JD ~<span class="token punctuation">]</span><span class="token comment"># free -m</span>
         total    used    <span class="token function">free</span>   shared  buff/cache  available
Mem:      <span class="token number">7822</span>    <span class="token number">5917</span>     <span class="token number">302</span>     <span class="token number">373</span>     <span class="token number">1602</span>        <span class="token number">1195</span>
Swap:       <span class="token number">0</span>       <span class="token number">0</span>       <span class="token number">0</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ul><li>total、used、free 它们分别是总的物理内存大小、已经被使用的物理内存和空闲的物理内存值是多少。</li> <li>为什么 free 值很低却未必代表内存达到瓶颈呢？</li> <li>这和 Linux 内核机制有关系，简单来说，内存空间会开辟 buffer 和 cache 缓冲区，对于物理内存来说，这都属于被使用过的内存。而应用需要内存时，如果没有可用的 free 内存，内核就会从缓冲区回收内存以满足要求，当 free 值很低的时候，如上代码中的 available 就能体现出缓冲区可用内存的大小，这个指标可以比较真实地反映出内存是否达到使用上限。</li></ul></li> <li>磁盘
<strong>iostat</strong><div class="language-shell script line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@JD ~<span class="token punctuation">]</span><span class="token comment"># iostat -x</span>
Linux <span class="token number">3.10</span>.0-514.el7.x86_64 <span class="token punctuation">(</span>JD<span class="token punctuation">)</span>    01/18/2021   _x86_64_    <span class="token punctuation">(</span><span class="token number">2</span> CPU<span class="token punctuation">)</span>
avg-cpu: %user %nice %system %iowait %steal %idle
		 <span class="token number">5.24</span>  <span class="token number">0.00</span>  <span class="token number">1.57</span>    <span class="token number">0.07</span>    <span class="token number">0.00</span>   <span class="token number">93.12</span>
Device:   rrqm/s wrqm/s  r/s   w/s   rkB/s  wkB/s  avgrq-sz avgqu-sz await  r_await w_await svctm %util
vda       <span class="token number">0.00</span>   <span class="token number">0.29</span>    <span class="token number">0.57</span>  <span class="token number">5.30</span>  <span class="token number">20.50</span>  <span class="token number">630.14</span> <span class="token number">221.82</span>   <span class="token number">0.07</span>     <span class="token number">11.53</span>  <span class="token number">59.83</span>   <span class="token number">6.36</span>    <span class="token number">1.18</span>  <span class="token number">0.69</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><ul><li>idle 代表磁盘空闲百分比；</li> <li>util 接近 100%，表示磁盘产生的 I/O 请求太多，I/O 系统已经满负荷在工作，该磁盘可能存在瓶颈；</li> <li>svctm 代表平均每次设备 I/O 操作的服务时间 (毫秒)。</li> <li>组合看这些指标，如果 idle 长期在 50% 以下，util 值在 50% 以上以及 svctm 高于 10ms，说明磁盘可能存在一定的问题。接着我会定位到具体是哪个进程造成的磁盘瓶颈
<strong>iotop</strong></li> <li>iotop 这个命令并不是 linux 原生，需安装。</li> <li>输入iotop，就能清楚地看到哪些进程在消耗磁盘资源。</li></ul> <div class="language-shell script line-numbers-mode"><pre class="language-shell"><code><span class="token number">6448</span>  be/4 root        <span class="token number">0.00</span> B/s    <span class="token number">0.00</span> B/s  <span class="token number">0.00</span> %  <span class="token number">0.00</span> % ifrit-agent
<span class="token number">14647</span> be/4 root        <span class="token number">0.00</span> B/s    <span class="token number">7.70</span> K/s  <span class="token number">0.00</span> %  <span class="token number">0.00</span> % java -Dserver.port<span class="token operator">=</span><span class="token number">9080</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li> <li>网络
<strong>netstat</strong> <ul><li>netstat 能提供 TCP 和 UDP 的连接状态等统计信息，可以简单判断网络是否存在堵塞。</li></ul> <div class="language-shell script line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@JD ~<span class="token punctuation">]</span><span class="token comment"># netstat</span>
Active Internet connections <span class="token punctuation">(</span>w/o servers<span class="token punctuation">)</span>
Proto Recv-Q Send-Q Local Address           Foreign Address         State
tcp        <span class="token number">0</span>      <span class="token number">1</span> JD:49190                <span class="token number">169.254</span>.169.250:http    FIN_WAIT1
tcp        <span class="token number">0</span>      <span class="token number">0</span> JD:39444                <span class="token number">169.254</span>.169.254:http    TIME_WAIT
tcp        <span class="token number">0</span>      <span class="token number">0</span> JD:us-srv               worker-18.:sentinel-ent ESTABLISHED
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><ul><li>Proto：协议名（可以 TCP 协议或者 UDP 协议）。</li> <li>recv-Q：网络接收队列还有多少请求在排队。</li> <li>send-Q：网络发送队列有多少请求在排队。</li> <li>recv-Q 和 send-Q 如果长期不为 0，很可能存在网络拥堵，这个是判断网络瓶颈的重要依据。</li> <li>Foreign Address：与本机端口通信的外部 socket。</li> <li>State：TCP 的连接状态。</li></ul></li></ol> <h2 id="分布式服务链路监控以及报警方案"><a href="#分布式服务链路监控以及报警方案" class="header-anchor">#</a> 分布式服务链路监控以及报警方案</h2> <h3 id="为什么需要链路监控"><a href="#为什么需要链路监控" class="header-anchor">#</a> 为什么需要链路监控</h3> <p>业务体系越来越复杂，加上服务间的相互依赖关系，微服务其中一个节点出现了问题，很可能牵一发而动全身，导致严重的后果，而且具体哪个服务出现了问题，需要层层排查，比较低效。分布式链路监控可以知道跨服务间调用耗时、执行方法等，方便排查</p> <h3 id="全链路监控组件选择"><a href="#全链路监控组件选择" class="header-anchor">#</a> 全链路监控组件选择</h3> <ol><li>探针性能消耗（影响足够小、数据分析快、性能占用少）</li> <li>代码非侵入性，可减少开发成本</li> <li>监控分析维度多</li> <li>市面上常用工具：CAT、SkyWalking、PinPoint
<ul><li>CAT：美团和携程开源，代码埋点入侵，应用日志分析、监控、展示</li> <li>SkyWalking：国人开发，无侵入性，展示简洁清晰</li> <li>PinPoint：韩国开发，更详尽的链路监控信息，数据采集性能消耗相对SkyWalking大</li></ul></li></ol> <h3 id="skywalking架构分析"><a href="#skywalking架构分析" class="header-anchor">#</a> SkyWalking架构分析</h3> <ol><li>Tracing 和 Metric ： 在应用上采集 Tracing（调用链数据）和 Metric（指标）信息通过 HTTP 或者 gRPC 方式发送数据到 Analysis Platform。</li> <li>Analysis Platform：数据的分析和计算，将传输的 Tracing 和 Metric 数据进行整合分析，通过 Analysis Core 模块把数据写入相关的数据库中。</li> <li>Storage：SkyWalking 的存储，支持以 ElasticSearch、MySQL、TiDB 等数据库进行数据存储，其中 ElasticSearch、MySQL 用的居多。</li> <li>SkyWalking UI：Web 可视化平台，用来展示落地的数据以及图表，比如链路调用、服务结构等</li></ol> <h3 id="skywalking使用"><a href="#skywalking使用" class="header-anchor">#</a> SkyWalking使用</h3> <ol><li>下载<div class="language-shell script line-numbers-mode"><pre class="language-shell"><code><span class="token function">wget</span> https://github.com/apache/SkyWalking/archive/v8.0.1.tar.gz
<span class="token function">tar</span> -zxvf v8.0.1.tar.gz
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li> <li>配置
<ul><li>配置文件 config/application.yml</li></ul> <div class="language-shell script line-numbers-mode"><pre class="language-shell"><code>mysql:
    properties:
      jdbcUrl: <span class="token variable">${SW_JDBC_URL<span class="token operator">:</span>&quot;jdbc<span class="token operator">:</span>mysql<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>127.0.0.1<span class="token operator">:</span>3306<span class="token operator">/</span>swtest&quot;}</span>
      dataSource.user: <span class="token variable">${SW_DATA_SOURCE_USER<span class="token operator">:</span>root}</span>
      dataSource.password: <span class="token variable">${SW_DATA_SOURCE_PASSWORD<span class="token operator">:</span>123456}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><ul><li>完成配置后重启</li></ul> <div class="language-shell script line-numbers-mode"><pre class="language-shell"><code>$ bin/oapService.sh
SkyWalking OAP started successfully<span class="token operator">!</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ul><li>SkyWalking UI配置，修改webapp/webapp.yml，因为默认8080是很多应用的默认端口，建议修改</li></ul> <div class="language-shell script line-numbers-mode"><pre class="language-shell"><code>server:
  port: <span class="token number">18080</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ul><li>启动 SkyWalking UI</li></ul> <div class="language-shell script line-numbers-mode"><pre class="language-shell"><code>$ bin/webappService.sh
SkyWalking Web Application started successfully<span class="token operator">!</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li> <li>启动监控，假如已启动多个微服务<div class="language-shell script line-numbers-mode"><pre class="language-shell"><code><span class="token function">nohup</span> java -server -Xms256m -Xmx256m -Dspring.profiles.active<span class="token operator">=</span>dev -Dspring.cloud.nacos.discovery.server-addr<span class="token operator">=</span><span class="token number">127.0</span>.0.1:8848 -javaagent:/root/apm/apache-SkyWalking-apm-bin/agent/SkyWalking-agent.jar<span class="token operator">=</span>agent.service_name<span class="token operator">=</span>cctuser -Dspring.cloud.nacos.config.server-addr<span class="token operator">=</span><span class="token number">127.0</span>.0.1:8848 -jar blade-user.jar  <span class="token operator">&gt;</span> log.file <span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span><span class="token file-descriptor important">&amp;1</span> <span class="token operator">&amp;</span>

-javaagent 后的启动参数是 SkyWalking 的 agent 配置路径
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></li></ol> <h3 id="告警-钉钉为例"><a href="#告警-钉钉为例" class="header-anchor">#</a> 告警（钉钉为例）</h3> <ol><li>配置机器人</li> <li>SkyWalking和钉钉报警结合
<ul><li>实现一个接口作为桥梁</li></ul> <div class="language-java line-numbers-mode"><pre class="language-java"><code>引入jar包
<span class="token generics"><span class="token punctuation">&lt;</span>dependency<span class="token punctuation">&gt;</span></span> 
    <span class="token generics"><span class="token punctuation">&lt;</span>groupId<span class="token punctuation">&gt;</span></span>com<span class="token punctuation">.</span>aliyun<span class="token operator">&lt;</span><span class="token operator">/</span>groupId<span class="token operator">&gt;</span> 
    <span class="token generics"><span class="token punctuation">&lt;</span>artifactId<span class="token punctuation">&gt;</span></span>alibaba<span class="token operator">-</span>dingtalk<span class="token operator">-</span>service<span class="token operator">-</span>sdk<span class="token operator">&lt;</span><span class="token operator">/</span>artifactId<span class="token operator">&gt;</span> 
<span class="token operator">&lt;</span><span class="token operator">/</span>dependency<span class="token operator">&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><div class="language-java line-numbers-mode"><pre class="language-java"><code>定义接口
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;/dingdingAlarm&quot;</span><span class="token punctuation">,</span> method <span class="token operator">=</span> <span class="token class-name">RequestMethod</span><span class="token punctuation">.</span>POST<span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">alarm</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestBody</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">AlarmDto</span><span class="token punctuation">&gt;</span></span> alarmList<span class="token punctuation">)</span><span class="token punctuation">{</span>
    alarmList<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>alarm<span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
        <span class="token class-name">DingTalkUtils</span><span class="token punctuation">.</span><span class="token function">sendMsg</span><span class="token punctuation">(</span>alarm<span class="token punctuation">.</span><span class="token function">getAlarmMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><ul><li>SkyWalking工程config/alarm-settings.yml配置</li></ul> <div class="language-shell script line-numbers-mode"><pre class="language-shell"><code> webhooks:-http://ip:port/dingdingAlarm
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li></ol> <h2 id="把可视化监控也做得酷炫"><a href="#把可视化监控也做得酷炫" class="header-anchor">#</a> 把可视化监控也做得酷炫</h2> <p>硬件资源监控node_exporter（CPU、负载、磁盘空间、磁盘等待、网络传输等详尽数据的采集）</p> <ol><li>Prometheus：数据存储(时间序列数据库)，接受exporter采集的数据，并按照一定规则进行计算整合，通过alertManager设置报警规则；提供本地存储和分布式存储，支持多种数据大盘，性能优异<div class="language-shell script line-numbers-mode"><pre class="language-shell"><code><span class="token function">wget</span> -c https://github.com/prometheus/prometheus/releases/download/v2.15.1/prometheus-2.15.1.linux-amd64.tar.gz
<span class="token function">tar</span> zxvf prometheus-2.15.1.linux-amd64.tar.gz
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>进入解压文件夹，查看主要的配置文件 prometheus.yml
四个核心配置如下：
global：全局配置，比如每次数据收集的间隔、规则地扫描数据的间隔
alerting：设置告警的插件，在这里会设定 alertmanager 这个插件
rule_files：具体的报警规则设置，比如基于什么指标进行报警，类似于触发器
scrape_configs：采集数据的对象，job_name、target 以及 job_name 是配置主机的名称，target 是你安装的 Exporter 地址</p></div> <div class="language-shell script line-numbers-mode"><pre class="language-shell"><code>- job_name: <span class="token string">'cctester'</span>
    static_configs:
    - targets: <span class="token punctuation">[</span><span class="token string">'127.0.0.1:9100'</span><span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><div class="language-shell script line-numbers-mode"><pre class="language-shell"><code><span class="token function">nohup</span> ./prometheus <span class="token operator">&amp;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div>访问 http://ip:9090/targets</li> <li>Exporter：采集服务器的监控数据，也可理解为agent（硬件、中间件、数据库均有相关的exporter）<div class="language-shell script line-numbers-mode"><pre class="language-shell"><code><span class="token function">wget</span> -c https://github.com/prometheus/node_exporter/releases/download/v0.18.1/node_exporter-0.18.1.linux-amd64.tar.gz
<span class="token function">tar</span> zxvf node_exporter-0.18.1.linux-amd64.tar.gz
<span class="token function">nohup</span> ./node_exporter <span class="token operator">&amp;</span>

 ip:9100打开页面
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></li> <li>Grafana：数据渲染展示
<ul><li>安装完成 Grafana 之后，添加 Prometheus 数据源</li> <li><a href="https://grafana.com/dashboards/8919" target="_blank" rel="noopener noreferrer">展示模板<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li></ol> <h2 id="docker制作、运行以及监控"><a href="#docker制作、运行以及监控" class="header-anchor">#</a> Docker制作、运行以及监控</h2> <h3 id="为什么使用docker"><a href="#为什么使用docker" class="header-anchor">#</a> 为什么使用Docker</h3> <p>docker设计思想：隔离，操作系统上可以有很多docker独立子环境，有独立的系统和应用</p> <h3 id="docker用法"><a href="#docker用法" class="header-anchor">#</a> docker用法</h3> <ol><li>安装<div class="language-shell script line-numbers-mode"><pre class="language-shell"><code>yum <span class="token function">install</span> -y <span class="token function">docker</span>  //安装Docker
<span class="token function">service</span> <span class="token function">docker</span> status //查看Docker运行状态
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li> <li>基本操作（基本命令略）<div class="language-shell script line-numbers-mode"><pre class="language-shell"><code>最近创建的容器
<span class="token function">docker</span> <span class="token function">ps</span> -n <span class="token number">1</span>

状态监控
<span class="token function">docker</span> stats
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></li> <li>基本概念
<ul><li>Dockerfile 用来构建镜像的文本文件，相当于制作镜像的材料和步骤</li> <li>IMAGE 根据材料做成的成品</li> <li>CONTAINER 基于镜像运行的软件</li> <li>【Dockerfile】 --build--&gt; 【IMAGE】 --run--&gt; 【CONTAINER】</li></ul></li> <li>实例：制作jmeter镜像
<ul><li>新建文件夹demo，存放原材料</li></ul> <div class="language-shell script line-numbers-mode"><pre class="language-shell"><code>apache-jmeter-5.2.1.tgz  Dockerfile  jdk-8u101-linux-x64.tar.gz
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li>编写Dockerfile</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>FROM java:8 # 基础java版本
MAINTAINER liuly2 	# 作者
ENV http_proxy &quot;&quot;
ENV https_proxy &quot;&quot;
RUN mkdir /test &amp;&amp; chmod -R 777 /test # 创建/test目录，用于存放jmx脚本、jtl结果文件、html测试报告文件
ENV JMETER_VERSION=5.2.1
ENV JMETER_HOME=/usr/local/apache-jmeter-${JMETER_VERSION}
ENV JMETER_PATH=${JMETER_HOME}/bin:${PATH}
ENV PATH=${JMETER_HOME}/bin:${PATH} # 设置JMeter环境变量
ADD apache-jmeter-${JMETER_VERSION}.tgz /usr/local # 添加JMeter
RUN ln -snf /usr/share/zoneinfo/Asia/Shanghai /etc/localtime &amp;&amp; echo &quot;Asia/Shanghai&quot; &gt; /etc/timezone
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><ul><li>制作JMeter镜像时，请不要忽略后面的一个点，在demo文件夹下执行</li></ul> <div class="language-shell script line-numbers-mode"><pre class="language-shell"><code> <span class="token function">docker</span> build -t jmeter <span class="token builtin class-name">.</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li>为了方便替换压测脚本或者参数化文件，在demo文件夹下创建一个file文件夹来存放这些文件</li></ul> <div class="language-shell script line-numbers-mode"><pre class="language-shell"><code><span class="token function">docker</span> run -d -it --name jmeter5.2.1 -v <span class="token environment constant">$PWD</span>/file:/test jmeter
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li></ol> <h2 id="从cpu飙升定位到热点方法"><a href="#从cpu飙升定位到热点方法" class="header-anchor">#</a> 从CPU飙升定位到热点方法</h2> <ol><li>掌握JVM结构和运行机制
<ul><li>idea里面编写的java代码xxx.java</li> <li>编译成xxx.class二进制(字节码)文件（通常在工程target文件夹）</li> <li>通过类加载器将二进制文件加载至JVM中（堆）</li></ul></li> <li>线程的6种状态
<ul><li>new：线程被创建，但并未启动，还没调用start方法</li> <li>runnable：线程处于运行状态</li> <li>blocked：阻塞线程无法获取到同步方法、代码块相关的锁</li> <li>waiting：一个线程等待另一个线程（无限等待）</li> <li>time_waiting：一个线程在一个特定的时间内等待另一个线程（计时等待）</li> <li>terminated：线程终止</li></ul></li> <li>线程占用CPU
<ul><li>waiting、time_waiting、blocked状态的线程不消耗CPU</li> <li>runnable状态的线程分情况：1、运算型的，并且未被挂起，消耗CPU；2、网络IO操作，等待数据时不消耗CPU</li></ul></li> <li>工具
<ul><li><a href="https://github.com/oldratlee/useful-scripts/blob/dev-2.x/docs/java.md#-show-busy-java-threads" target="_blank" rel="noopener noreferrer">show-busy-java-threads<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li></ol> <h2 id="基于jvm分析内存使用对象"><a href="#基于jvm分析内存使用对象" class="header-anchor">#</a> 基于JVM分析内存使用对象</h2> <p>JVM内存只是服务器内存的一部分，内存分析，不仅是统计使用、空闲这些数值，需要了解内存结构、内存分配、内存回收
<img src="/assets/img/uTools_1665671026049.914d3e9d.png" alt=""></p> <h3 id="本地方法栈"><a href="#本地方法栈" class="header-anchor">#</a> 本地方法栈</h3> <p>本地方法栈保存的是 native 方法的信息，native 方法就是 Java 调用非 Java 代码的接口，为什么会有这样的设置呢？简单来说，sun 的解释器是由 C 语言实现的，而 jre 又是基于 Java 语言，所以需要 native 方法来进行跨语言的调用。</p> <h3 id="java栈"><a href="#java栈" class="header-anchor">#</a> Java栈</h3> <p>存放着基本数据类型和对象的引用</p> <h3 id="方法区-jdk-1-8-已经移除"><a href="#方法区-jdk-1-8-已经移除" class="header-anchor">#</a> 方法区（JDK 1.8+已经移除）</h3> <p>也叫作永久区，用来存储类信息（属性、方法等）</p> <h3 id="程序计数器"><a href="#程序计数器" class="header-anchor">#</a> 程序计数器</h3> <p>线程的信号指示器，保存线程当前程序的执行位置，以保证多线程的切换</p> <h3 id="堆"><a href="#堆" class="header-anchor">#</a> 堆</h3> <p>堆区域是JVM调优最重要的区域，堆中存放的数据很多是对象实例，堆空间占据JVM中最大的存储区域。堆空间并非取之不尽，有用的对象应当保存，无用的对象应当回收，为了更好地实现这一机制，JVM将堆空间分成了新生代和老生代
<img src="/assets/img/uTools_1665672328641.a2a5035e.png" alt=""></p> <ol><li>可以看出Minor GC发生在新生代，Full GC发生在老年代。新生代分为三个区，一个Eden区和两个Survivor区。</li> <li>Eden 区的作用，大部分新生成的对象都是在 Eden 区，Eden 区满了之后便没有内存给新对象使用，Eden 区便会 Minor GC 回收无用内存，剩下的存活对象便会转移到 Survivor 区</li> <li>两个Survivor区的作用：两者其实是对称分布的，一个是 From 区，一个是 To 区。从 Eden 区存活下来的对象首先会被复制到 From 区，当 From 区满时，此时还存活的对象会被转移到 To 区，经历了多次的 Minor GC 后，还存活的对象就会被复制到老年代，老年代的 GC 一般叫作 FullGC 或者 MajorGC。</li> <li>新生代垃圾回收和老年代垃圾回收的区别
<ul><li>新生代频繁、快速</li> <li>老年代一般会伴随一次MinorGC，速度要比MinorGC慢</li></ul></li></ol> <h3 id="定位内存占用"><a href="#定位内存占用" class="header-anchor">#</a> 定位内存占用</h3> <ol><li>观察GC频次(JDK自带工具jstat)</li></ol> <div class="language-shell script line-numbers-mode"><pre class="language-shell"><code>jstat -gc <span class="token number">26607</span> <span class="token number">1000</span> <span class="token number">3</span>

<span class="token number">26607</span> 代表查看的PID的Java进程号
<span class="token number">1000</span> 代表每隔1000ms也就是1s显示一次
<span class="token number">3</span> 代表一共显示三次
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><div class="language-shell script line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@JD ~<span class="token punctuation">]</span><span class="token comment"># jstat -gc 26607 1000 3</span>
 S0C    S1C    S0U    S1U      EC       EU        OC         OU       MC     MU    CCSC   CCSU   YGC     YGCT    FGC    FGCT     GCT
<span class="token number">512.0</span>  <span class="token number">512.0</span>  <span class="token number">320.0</span>   <span class="token number">0.0</span>   <span class="token number">86016.0</span>  <span class="token number">27828.5</span>   <span class="token number">175104.0</span>   <span class="token number">157974.6</span>  <span class="token number">122840.0</span> <span class="token number">116934.9</span> <span class="token number">16128.0</span> <span class="token number">15060.4</span>   <span class="token number">5328</span>   <span class="token number">37.311</span>   <span class="token number">4</span>      <span class="token number">1.042</span>   <span class="token number">38.353</span>
<span class="token number">512.0</span>  <span class="token number">512.0</span>  <span class="token number">320.0</span>   <span class="token number">0.0</span>   <span class="token number">86016.0</span>  <span class="token number">27981.9</span>   <span class="token number">175104.0</span>   <span class="token number">157974.6</span>  <span class="token number">122840.0</span> <span class="token number">116934.9</span> <span class="token number">16128.0</span> <span class="token number">15060.4</span>   <span class="token number">5328</span>   <span class="token number">37.311</span>   <span class="token number">4</span>      <span class="token number">1.042</span>   <span class="token number">38.353</span>
<span class="token number">512.0</span>  <span class="token number">512.0</span>  <span class="token number">320.0</span>   <span class="token number">0.0</span>   <span class="token number">86016.0</span>  <span class="token number">28885.4</span>   <span class="token number">175104.0</span>   <span class="token number">157974.6</span>  <span class="token number">122840.0</span> <span class="token number">116934.9</span> <span class="token number">16128.0</span> <span class="token number">15060.4</span>   <span class="token number">5328</span>   <span class="token number">37.311</span>   <span class="token number">4</span>      <span class="token number">1.042</span>   <span class="token number">38.353</span>

一般C结尾的代表总的容量大小或者计数的次数，U结尾代表已使用的容量大小
S0代表第一个Survivor区，S1C和S1U则表示第二个Survivor区也就是To区的总容量和使用容量

EC / EU：Eden 区的总容量/已使用空间的大小
OC / OU：老年代总容量/老年代已使用空间大小
MC / MU：方法区总容量/方法区已使用容量大小
CCSC / CCSU：压缩类总容量/压缩类空间使用大小
YGC / YGCT：年轻代垃圾回收的次数/年轻代垃圾回收消耗时间
FGC / FGCT： 老年代垃圾回收次数/老年代垃圾回收消耗时间
GCT：垃圾回收消耗总时间
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>让内存区域分代，主要就是优化垃圾回收的性能，如果不分代那么所有的对象可能都在同一个大的区间里，GC 依次判断则效率必然是很低
2. 定位占用内存对象（jmap）</p> <div class="language-shell script line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@JD ~<span class="token punctuation">]</span><span class="token comment"># jmap -histo 18658|head -n 20</span>
 num     <span class="token comment">#instances         #bytes  class name</span>
----------------------------------------------
   <span class="token number">1</span>:        <span class="token number">157619</span>       <span class="token number">18840672</span>  <span class="token punctuation">[</span>C
   <span class="token number">2</span>:          <span class="token number">8326</span>        <span class="token number">8324360</span>  <span class="token punctuation">[</span>B
   <span class="token number">3</span>:        <span class="token number">146319</span>        <span class="token number">3511656</span>  java.lang.String
   <span class="token number">4</span>:          <span class="token number">9224</span>        <span class="token number">2825584</span>  <span class="token punctuation">[</span>I
   <span class="token number">5</span>:         <span class="token number">65733</span>        <span class="token number">2103456</span>  com.example.demo.entity.User
   <span class="token number">6</span>:         <span class="token number">62508</span>        <span class="token number">2000256</span>  java.util.HashMap<span class="token variable">$Node</span>
   <span class="token number">7</span>:         <span class="token number">21868</span>        <span class="token number">1618832</span>  <span class="token punctuation">[</span>Ljava.lang.Object<span class="token punctuation">;</span>
   
num 是编号
instances 是生成的实例个数
bytes 是实例占用的大小
classs name 对象的类名

其中 <span class="token punctuation">[</span>C、<span class="token punctuation">[</span>S、<span class="token punctuation">[</span>I、<span class="token punctuation">[</span>B 对应的类型如下
<span class="token punctuation">[</span>C is a char<span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token punctuation">[</span>S is a short<span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token punctuation">[</span>I is a int<span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token punctuation">[</span>B is a byte<span class="token punctuation">[</span><span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><ol start="3"><li>可视化的JVM监控工具(jvisual)</li></ol> <ul><li>监控内存泄漏、跟踪垃圾回收、执行时内存分析、CPU 线程分析等</li> <li>jvisual使用，在启动被测的jar服务里进行如下配置，启动暴露1099端口，且连接时不需要认证</li></ul> <div class="language-shell script line-numbers-mode"><pre class="language-shell"><code><span class="token function">nohup</span> java -Djava.rmi.server.hostname<span class="token operator">=</span>实际ip -Dcom.sun.management.jmxremote -Dcom.sun.management.jmxremote.port<span class="token operator">=</span><span class="token number">1099</span> -Dcom.sun.management.jmxremote.authenticate<span class="token operator">=</span>false -Dcom.sun.management.jmxremote.ssl<span class="token operator">=</span>false -jar demo-0.0.1-SNAPSHOT.jar <span class="token operator">&amp;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li>jdk路径bin目录下找到jvisualvm，打开，再配置相应的jmx连接</li></ul> <h2 id="通过arthas定位代码链路问题"><a href="#通过arthas定位代码链路问题" class="header-anchor">#</a> 通过Arthas定位代码链路问题</h2> <p>场景：TPS很低，各资源占用也很低，很难通过资源异常定位问题，可通过代码级别定位工具Arthas</p> <h3 id="arthas是什么"><a href="#arthas是什么" class="header-anchor">#</a> Arthas是什么</h3> <p>阿里开源的Java诊断工具，能查看应用线程状态，JVM信息，在线对业务问题诊断，如方法调用入参、执行过程、抛出的异常、方法执行耗时等，效率极高</p> <h3 id="arthas使用方法"><a href="#arthas使用方法" class="header-anchor">#</a> Arthas使用方法</h3> <ol><li>下载<div class="language-shell script line-numbers-mode"><pre class="language-shell"><code><span class="token function">wget</span> https://alibaba.github.io/arthas/arthas-boot.jar
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li>启动<div class="language-shell script line-numbers-mode"><pre class="language-shell"><code>java -jar arthas-boot.jar
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li>会给出选择Java应用后台进程的选项，序号就代表Arthas自动识别所在服务器的java进程，输入序号回车，看到Arthas连接成功后，就可以使用了</li> <li>关于帮助<div class="language-shell script line-numbers-mode"><pre class="language-shell"><code>java -jar arthas-boot.jar -h
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li></ol> <h3 id="arthas-实操"><a href="#arthas-实操" class="header-anchor">#</a> Arthas 实操</h3> <ol><li>利用 Arthas 线程相关命令定位死锁<div class="language-java line-numbers-mode"><pre class="language-java"><code>    <span class="token comment">//线程Lock1代码示意</span>
    <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">synchronized</span><span class="token punctuation">(</span><span class="token string">&quot;obj1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//获取obj1后先等一会儿，让Lock2有足够的时间锁住obj2</span>
            <span class="token keyword">synchronized</span><span class="token punctuation">(</span><span class="token string">&quot;obj2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Lock1 lock obj2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//线程Lock2代码示意</span>
    <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">synchronized</span><span class="token punctuation">(</span><span class="token string">&quot;obj2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//获取obj2后先等一会儿，让Lock1有足够的时间锁住obj1</span>
            <span class="token keyword">synchronized</span><span class="token punctuation">(</span><span class="token string">&quot;obj1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Lock2 lock obj1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div>在服务器执行上述代码，用Arthas的jvm命令可以查看到DEADLOCK-COUNT为2，说明程序发生了死锁；输入thread -b命令查看当前阻塞其他线程的线程，根据提示找到死锁位置，然后优化</li> <li>使用trace命令查看耗时<div class="language-shell script line-numbers-mode"><pre class="language-shell"><code>trace 包名.类名 方法名
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li>使用watch命令观察被测方法的参数和返回值
<ul><li>线上问题处理常见方式：1、在dev、test环境使用线上数据复现；2、从线上日志查（都不是很方便）</li> <li>使用watch</li></ul> <div class="language-shell script line-numbers-mode"><pre class="language-shell"><code><span class="token function">watch</span> 包名.类名 方法名 <span class="token string">&quot;{params[0],params[1],returnObj}&quot;</span>

方法名后面指定了需要控制台输出的内容，params<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> 代表第一个参数，如果参数有多个，params加下标即可，returnObj代表返回值
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></li> <li>使用tt命令定位异常调用
<ul><li>函数调用n次中有几次是异常情况，用watch没有那么方便</li> <li>使用tt</li></ul> <div class="language-shell script line-numbers-mode"><pre class="language-shell"><code>tt -t 包名.类名 方法名

结果中IS-RET项如果为false，即为错误的调用
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></li> <li>web方式操作Arthas
<ul><li>Arthas提供了客户端访问程序Arthas Tunnel Server</li> <li><a href="https://github.com/alibaba/arthas/releases" target="_blank" rel="noopener noreferrer">下载jar包<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li>把Arthas Tunnel Server部署到能和线上服务器通信的目标服务器</li> <li>确保线上服务器启动了Arthas</li></ul> <div class="language-shell script line-numbers-mode"><pre class="language-shell"><code>java -jar arthas-boot.jar --tunnel-server <span class="token string">'ws://目标服务器ip:目标服务器port/ws'</span> --target-ip

target-ip是指被测程序所在服务器的 IP
目标服务器即Arthas Tunnel Server启动的服务器，端口号默认是 <span class="token number">8080</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ul><li>在浏览器中输入 http://目标服务器ip:目标服务器port，就可以访问 WebConsole</li> <li>输入ip、port 和 agentid就可以连上被测程序，执行相关Arthas命令</li></ul> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>Arthas Tunnel Server 的操作原理</p> <p>所有节点的 Arthas 服务启动都会向注册中心（Arthas Tunnel Server）注册，注册中心维护了一个节点列表，当客户端发起访问某个节点，Arthas Tunnel Server 便会从维护的节点列表找到与请求的 ip 和端口号对应的节点进行访问，然后把访问结果返回给客户端</p></div></li></ol> <h2 id="应对redis缓存穿透、击穿和雪崩"><a href="#应对redis缓存穿透、击穿和雪崩" class="header-anchor">#</a> 应对Redis缓存穿透、击穿和雪崩</h2> <p>由于数据库的数据是存在硬盘上，硬盘的 I/O 读写瓶颈会直接影响并发量。磁盘 I/O 读写时瓶颈，采用速度更快的内存来存储常用但数据量不算大的数据。
<img src="/assets/img/uTools_1656245657230.ea1ce5cf.png" alt=""></p> <ul><li>最常使用的基于内存的数据库就是 Redis 和 MemCached</li> <li>Redis 和 Memcached 对比
<ol><li>存储方式
<ul><li>MemCached 目前只支持单一的数据结构 Key-Value 形式；</li> <li>Redis 支持多种数据结构，有字符串、列表、集合、散列表、有序集合等。</li></ul></li> <li>持久化
<ul><li>持久化就是把数据从内存永久存储到磁盘里，可以防止断电等异常情况下数据丢失等问题。目前 Redis 支持持久化，而 MemCached 不支持。遇到灾难，MemCached 无法恢复数据，Redis 可以恢复数据，保证了数据的安全性。</li> <li>从以上特点可以看出 Redis 在数据多样性和安全性上远高于 MemCached。MemCachded 使用频率越来越低，绝大多数的业务场景使用 Redis 居多。</li></ul></li></ol></li> <li>Redis特性
<ul><li>主从复制功能
<ul><li>虽然数据在内存中读写速度比较快，但是在高并发情况下也会产生读写压力特别大的情况，Redis 针对这一情况提供了主从复制功能。</li> <li>主从复制的好处有如下两点：</li> <li>提供了 Redis 扩展性，当一台 Redis 不够用时，可以增加多台 Redis 作为从服务器向外提供服务；</li> <li>提供了数据备份和冗余服务器，当 Redis 主服务器意外宕机，从服务器可以顶替主服务器向外提供服务，增加了系统的高可用性。</li></ul></li> <li>脚本操作
<ul><li>Redis 提供了 lua 脚本操作，你可以将 Redis 存取操作写到 lua 脚本里，然后通过 Redis 提供的 API 来执行 lua 脚本，这样就可以实现 Redis 相关操作。</li> <li>我们同样可以用 Redis 提供的 API 直接实现 Redis 相关操作，那么为什么有时候又要绕一圈去操作 lua 脚本呢？因为 lua 脚本能够保证操作的原子性，即所有的操作当作一个操作，要么全部失败要么全部成功。而直接使用 API 不一定能保证一连串操作的原子性，所以当需要保证原子性的时候需要使用 lua 脚本。</li></ul></li> <li>发布与订阅
<ul><li>该特性可以将 Redis 作为消息中间件，在服务端产生消息，然后在客户端消费消息队列里的消息，但是作为消息队列不是 Redis 的强项，所以不推荐使用。比如 Redis 作为消息队列消息并非完全可靠，会产生消息丢失的问题，并且也不支持消息分组。在性能上，如果入队和出队操作频繁，那 Redis 性能比起 RabbitMq 等常用消息队列来说还是有差距的。</li></ul></li></ul></li> <li>Redis缺点
<ul><li>缓存穿透
<ul><li>缓存穿透的情况是 Redis 和 MySQL 数据库都没有这条数据，但是用户不断并发发起请求，请求压力会同时落到数据库和缓存上，这样的情况相对于设计初衷来说，对系统的压力就会大很多了，而且这也是黑客发起攻击的手段之一，找寻你的系统是否存在漏洞。</li> <li>那在项目中如果遇到缓存穿透我们该如何解决呢？</li> <li>遇到缓存穿透，我们可以在请求访问缓存和数据库都没查到数据时，给一个默认值或者 Null 值，即 Key-Null。然后该缓存值的有效时间可以设置得短点，比如 30s。在业务代码中判断如果是 Null 值就取消查询数据库，或者间隔 30s 之后重试，这样的方式可以大幅度减轻数据库的查询压力。</li></ul></li> <li>缓存击穿
<ul><li>单个数据在缓存中不存在，而在数据库中存在。一般这种情况都是缓存失效导致的，在缓存失效的时间段有大量并发用户访问，首先访问缓存，因为 Key 已经过期了，所以查不到数据，然后所有查询压力都会落到数据库上，造成数据库的压力过大。并且还有可能因为并发问题导致重复更新缓存而过多占用缓存资源。</li> <li>在项目中如果遇到缓存击穿问题，该如何解决呢？
<ul><li>对于一些经常被访问的热点数据，可以根据业务特性主动检查使其 Redis 数据永不过期，当然这样的设置并不代表说这条数据一直不更新而处在 Redis 中，而是根据数据字段中的失效时间和系统时间的对比主动检查更新数据，使 Redis 数据不会过期；</li> <li>通过后台定时刷新，根据缓存失效时间节点去批量刷新缓存数据，这个适合 Key 失效时间相对固定的场景。</li></ul></li></ul></li> <li>缓存雪崩
<ul><li>大量数据在同一时间失效，会造成数据库查询压力过大导致宕机。缓存雪崩与缓存击穿的区别在于缓存击穿是单个数据失效，缓存雪崩是多个数据同一时间失效。</li> <li>在项目中如果遇到缓存雪崩的问题，我们该如何解决呢？以下 3 种方法可以帮我们解决。
<ul><li>如果程序设置的缓存过期时间统一为一个固定的值，比如 5s、10s、15s 等等，那么很有可能出现大量数据在同一时间失效。这个时候我们可以设置不同的过期时间，比如统一时间加上一个随机时间，这样可以让缓存的时间尽量均匀分布一点。</li> <li>不设置过期时间，让程序的定时任务自动定时更新或者清除缓存</li> <li>使用集群化的方式，保证高可用。</li></ul></li></ul></li></ul></li></ul> <h2 id="优化mysql性能"><a href="#优化mysql性能" class="header-anchor">#</a> 优化MySQL性能</h2> <h3 id="一次sql的查询过程是怎样的"><a href="#一次sql的查询过程是怎样的" class="header-anchor">#</a> 一次SQL的查询过程是怎样的</h3> <ol><li>客户端发送一个查询 SQL 给数据库服务器。</li> <li>服务器先检查查询<strong>缓存</strong>，如果命中，也就是查询缓存中有这条记录，那么便直接返回缓存中的结果。如果没有命中，则进入下一阶段（解析器）。</li> <li>服务器由<strong>解析器</strong>检查 SQL 语法是否正确，然后由<strong>预处理器</strong>检查 SQL 中的表和字段是否存在，最后由<strong>查询器</strong>生成执行计划，也就是 SQL 的执行方式或者步骤。</li> <li>MySQL 根据<strong>优化器</strong>生成的执行计划，调用存储引擎的 API 来执行查询。</li> <li>将结果返回给客户端。
<img src="/assets/img/uTools_1656248060315.69966112.png" alt=""></li></ol> <h3 id="影响性能的关键点有哪些"><a href="#影响性能的关键点有哪些" class="header-anchor">#</a> 影响性能的关键点有哪些</h3> <p>比如硬件层面、系统层面等等。但在性能领域中，一个不能忽略的问题是你需要考虑影响的面有多少，以及如何优化才是最具有性价比的，如图：
<img src="/assets/img/uTools_1656248218789.5b6ee653.png" alt=""></p> <ul><li>从上往下看：
<ul><li>SQL 语句和索引相关问题是最常见的，带来的价值也是最明显的；</li> <li>系统配置库表结构带来的价值次之；</li> <li>而硬件层次的优化优先级是不高的。</li></ul></li></ul> <ol><li>硬件配置
对于数据库处理复杂 SQL 而言，尽量选择高频 CPU，而且数据库一般都会开辟缓存池来存放数据，所以在服务器选型的时候内存大小也需要考虑。一般来说数据库服务器的硬件配置的重要性高于应用服务器配置</li> <li>系统配置选项
<ul><li><strong>max_connections</strong>，MySQL 可以接收到的最大连接数<div class="language-sql line-numbers-mode"><pre class="language-sql"><code> mysql<span class="token operator">&gt;</span> <span class="token keyword">show</span> variables <span class="token operator">like</span> <span class="token string">'%max_connections%'</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">-----------------+-------+</span>
<span class="token operator">|</span> Variable_name   <span class="token operator">|</span> <span class="token keyword">Value</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-----------------+-------+</span>
<span class="token operator">|</span> max_connections <span class="token operator">|</span> <span class="token number">151</span>   <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-----------------+-------+</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><ul><li>MySQL的实际连接数</li></ul> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code> mysql<span class="token operator">&gt;</span> <span class="token keyword">show</span> <span class="token keyword">status</span> <span class="token operator">like</span> <span class="token string">'Threads%'</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">-------------------+-------+</span>
<span class="token operator">|</span> Variable_name     <span class="token operator">|</span> <span class="token keyword">Value</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-------------------+-------+</span>
<span class="token operator">|</span> Threads_cached    <span class="token operator">|</span> <span class="token number">7</span>     <span class="token operator">|</span>
<span class="token operator">|</span> Threads_connected <span class="token operator">|</span> <span class="token number">64</span>    <span class="token operator">|</span>
<span class="token operator">|</span> Threads_created   <span class="token operator">|</span> <span class="token number">1705</span>  <span class="token operator">|</span>
<span class="token operator">|</span> Threads_running   <span class="token operator">|</span> <span class="token number">1</span>     <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-------------------+-------+</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div>其中 Threads_connected 是你实际的连接数。如果 max_connections 的值设置较小，在高并发的情况下易出现 “too many connections” 这样的报错，我们可以通过如下命令调节配置从而减少此问题的发生，你可以根据所在公司的实际情况进行配置。<div class="language-sql line-numbers-mode"><pre class="language-sql"><code> mysql<span class="token operator">&gt;</span> <span class="token keyword">set</span> <span class="token keyword">global</span> max_connections<span class="token operator">=</span><span class="token number">500</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><strong>innodb_buffer_pool_size</strong>，InnoDB 存储引擎下 MySQL 的内存缓冲区大小
<ul><li>首先 InnoDB 存储引擎是 MySQL 的默认存储引擎，使用也很广泛。缓冲池是什么呢？其实就和缓存类似，通过上一讲学习你可以知道，从磁盘读取数据效率是很低的，为了避免这个问题，MySQL 开辟了基于内存的缓冲池，核心做法就是把经常请求的热数据放入池中，如果请求交互的数据都在缓冲池中则会很高效，所以一般数据库缓冲池设置得会比较大，占到操作系统内存值的 70%～80%。</li> <li>如何评估缓冲池大小是否合理？</li> <li>我们可以通过计算缓存命中率来判断，公式为：(1-innodb_buffer_pool_reads/innodb_buffer_pool_read_request) * 100</li> <li>一般来说，当缓存命中率低于 90% 就说明需要加大缓冲池了</li></ul> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code>  <span class="token keyword">show</span> <span class="token keyword">status</span> <span class="token operator">like</span>  <span class="token string">'Innodb_buffer_pool_read_%'</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">---------------------------------------+----------+</span>
<span class="token operator">|</span> Variable_name                         <span class="token operator">|</span> <span class="token keyword">Value</span>    <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">---------------------------------------+----------+</span>
<span class="token operator">|</span> Innodb_buffer_pool_read_ahead_rnd     <span class="token operator">|</span> <span class="token number">0</span>        <span class="token operator">|</span>
<span class="token operator">|</span> Innodb_buffer_pool_read_ahead         <span class="token operator">|</span> <span class="token number">51</span>       <span class="token operator">|</span>
<span class="token operator">|</span> Innodb_buffer_pool_read_ahead_evicted <span class="token operator">|</span> <span class="token number">0</span>        <span class="token operator">|</span>
<span class="token operator">|</span> Innodb_buffer_pool_read_requests      <span class="token operator">|</span> <span class="token number">25688179</span> <span class="token operator">|</span>
<span class="token operator">|</span> Innodb_buffer_pool_reads              <span class="token operator">|</span> <span class="token number">2171</span>     <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">---------------------------------------+----------+</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div></li> <li><strong>SQL优化</strong> <ul><li><strong>什么是慢SQL</strong></li> <li>从默认定义上来讲，执行超过 10s 的 SQL 都被定义为慢 SQL</li> <li>查看慢查询配置的时间：</li></ul> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code>mysql<span class="token operator">&gt;</span> <span class="token keyword">show</span> variables <span class="token operator">like</span> <span class="token string">'long_query_time'</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">-----------------+-----------+</span>
<span class="token operator">|</span> Variable_name   <span class="token operator">|</span> <span class="token keyword">Value</span>     <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-----------------+-----------+</span>
<span class="token operator">|</span> long_query_time <span class="token operator">|</span> <span class="token number">10.000000</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-----------------+-----------+</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><ul><li>如果需要修改该配置为 1s，可以在 my.cnf 中添加，这样的方式需要重启 MySQL 服务</li></ul> <div class="language-ini line-numbers-mode"><pre class="language-ini"><code><span class="token key attr-name">long_query_time</span><span class="token punctuation">=</span><span class="token value attr-value">1</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li><strong>获取慢SQL</strong></li> <li>方式一：在my.cnf中配置</li></ul> <div class="language-ini line-numbers-mode"><pre class="language-ini"><code><span class="token key attr-name">slow_query_log</span><span class="token punctuation">=</span><span class="token value attr-value">1</span>
<span class="token key attr-name">slow_query_log_file</span><span class="token punctuation">=</span><span class="token value attr-value">/data/mysql-slow.log</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ul><li>方式二：使用show full processlist这个命令实时获取交互的SQL，通过观察state状态以及SQL出现的频率也能判断出来是不是慢SQL。</li> <li><strong>分析慢SQL</strong></li> <li>关于慢 SQL，绝大多数原因都是 SQL 本身的问题，比如写的业务 SQL 不合理，返回了大量数据；表设计不合理需要多表的连接查询；索引的问题等。</li> <li>众多SQL问题中索引相关的问题也是最突出：</li> <li><strong>索引缺失</strong></li> <li>索引是一种单独地、物理地对数据库表中一列或者多列进行排序的数据库结构。索引的作用相当于图书的目录，可以根据目录的页码快速找到所需要的内容。当数据库存在大量数据做查询操作，你就需要 check 是否存在索引，如果没有索引，会非常影响查询速度。</li> <li>在 InnoDB 中，我们可以简单地把索引分成两种：聚簇索引（主键）和普通索引。按照我的理解来看，聚簇索引是叶子节点保存了数据，而普通索引的叶子节点保存的是数据地址。</li> <li>通常推荐在区分度较高的字段上创建索引，这样效果比较好，比如，一个会员系统中，给用户名建索引，查询时候可以快速定位到要找的数据，而给性别字段建索引则没有意义。</li> <li><strong>索引失效</strong></li> <li>添加索引只是其中的一个必要步骤，并不是添加完成后就万事大吉了。在一些情况下索引其实是不生效的，比如索引列中存在 Null 值、重复数据较多的列、前导模糊查询不能利用索引（like '%XX' 或者 like '%XX%'）等。在一般情况下你可以使用执行计划查看索引是否真正生效</li> <li><strong>联合索引不满足最左前缀原则</strong></li> <li>联合索引指一个索引会同时对应多个列，比如 c1、c2、c3 为三个字段，则可以通过 index_name(c1,c2,c3) 的方式建立联合索引，等于为 c1、(c1,c2)、(c1,c2,c3) 都建立了索引。因为每增加一个索引，也会增加写操作的磁盘开销，所以说联合索引是一种性价比比较高的建立索引的方式。</li> <li>最左前缀原则指在 c1、c2、c3 上建立了联合索引，索引中的数据也是按 c1、c2、c3 进行排序，最左前缀顾名思义就是最左边的优先。</li></ul> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> <span class="token keyword">table</span> <span class="token keyword">WHERE</span> c1<span class="token operator">=</span><span class="token string">&quot;1&quot;</span> <span class="token operator">AND</span> c2<span class="token operator">=</span><span class="token string">&quot;2&quot;</span> <span class="token operator">AND</span> c3<span class="token operator">=</span><span class="token string">&quot;3&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div>如果打破最左前缀规则联合索引是不生效的<div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> <span class="token keyword">table</span> <span class="token keyword">WHERE</span> c1<span class="token operator">=</span><span class="token string">&quot;1&quot;</span> <span class="token operator">AND</span> c3<span class="token operator">=</span><span class="token string">&quot;3&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li>通过执行计划判断SQL有没有走索引或者索引有没有生效</li> <li>执行计划通常是开发者拿到慢 SQL 之后，优化 SQL 语句的第一步。MySQL 在解析 SQL 语句时，会生成多套执行方案，然后内部会进行一个成本的计算，通过优化器选择一个最优的方案执行，然后根据这个方案会生成一个执行计划。开发者通过查看 SQL 语句的执行计划，可以直观地了解到 MySQL 是如何解析执行这条 SQL 语句的，然后再针对性地进行优化。</li> <li>查看 SQL语句的执行计划：
添加desc</li></ul> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">desc</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token keyword">user</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div>添加 explain<div class="language-sql line-numbers-mode"><pre class="language-sql"><code>mysql<span class="token operator">&gt;</span> <span class="token keyword">explain</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token keyword">user</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">----+-------------+-------+------------+------+---------------+------+---------+------+------+----------+-------+</span>
<span class="token operator">|</span> id <span class="token operator">|</span> select_type <span class="token operator">|</span> <span class="token keyword">table</span> <span class="token operator">|</span> partitions <span class="token operator">|</span> <span class="token keyword">type</span> <span class="token operator">|</span> possible_keys <span class="token operator">|</span> <span class="token keyword">key</span>  <span class="token operator">|</span> key_len <span class="token operator">|</span> ref  <span class="token operator">|</span> <span class="token keyword">rows</span> <span class="token operator">|</span> filtered <span class="token operator">|</span> Extra <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----+-------------+-------+------------+------+---------------+------+---------+------+------+----------+-------+</span>
<span class="token operator">|</span> <span class="token number">1</span>  <span class="token operator">|</span> <span class="token keyword">SIMPLE</span>      <span class="token operator">|</span> <span class="token keyword">user</span>  <span class="token operator">|</span> <span class="token boolean">NULL</span>       <span class="token operator">|</span> <span class="token keyword">ALL</span>  <span class="token operator">|</span> <span class="token boolean">NULL</span>          <span class="token operator">|</span> <span class="token boolean">NULL</span> <span class="token operator">|</span> <span class="token boolean">NULL</span>    <span class="token operator">|</span> <span class="token boolean">NULL</span> <span class="token operator">|</span> <span class="token number">9984</span> <span class="token operator">|</span>  <span class="token number">100.00</span>  <span class="token operator">|</span> <span class="token boolean">NULL</span>  <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----+-------------+-------+------------+------+---------------+------+---------+------+------+----------+-------+</span>
<span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span><span class="token punctuation">,</span> <span class="token number">1</span> warning <span class="token punctuation">(</span><span class="token number">0.01</span> sec<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><ol><li>table 显示的是这一行的数据是关于哪张表的，上述内容中显示的表名就是 user。</li> <li>type 这是重要的列，显示连接使用了何种类型，类型还是蛮多的，我选择最不理想的 ALL 类型和你解释一下，这个连接类型对于查询的表进行全表数据扫描，这种情况比较糟糕，应该尽量避免，上面的示例就进行了全表扫描。</li> <li>key 表示实际使用的索引。如果为 Null，则没有使用索引，这种情况也是尤其需要注意的。</li> <li>rows 表明 SQL 返回请求数据的行数，这一行非常重要，返回的内容中 SQL 遍历了 9984 行，其实也证明了这条 SQL 遍历了一张表。</li> <li>关于 extra，我列举两个你需要注意的状态，因为这样的状态是会对性能产生不良的影响，意味着查询需要优化了。
<ul><li>Using filesort：表示SQL需要进行额外的步骤来发现如何对返回的行排序。它会根据连接类型、存储排序键值和匹配条件的全部行进行排序。</li> <li>Using temporary：表示MySQL需要创建一个临时表来存储结果，非常消耗性能。</li></ul></li></ol></li></ul></li></ol> <h2 id="如何根治慢sql"><a href="#如何根治慢sql" class="header-anchor">#</a> 如何根治慢SQL</h2> <ol><li>如何获取这些有问题的 SQL，一般有两种方式可以获取
<ul><li>从慢日志文件中获取，上一讲也描述过配置方法；</li> <li>通过 show full processlist 实时获取交互的 SQL。</li></ul> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code>mysql<span class="token operator">&gt;</span>showfullprocesslist<span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">-------+--------+---------+----+-------+----+-----+----+</span>
<span class="token operator">|</span>Id     <span class="token operator">|</span><span class="token keyword">User</span>    <span class="token operator">|</span>Host     <span class="token operator">|</span>db  <span class="token operator">|</span>Command<span class="token operator">|</span><span class="token keyword">Time</span><span class="token operator">|</span>State<span class="token operator">|</span>Info<span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-------+--------+---------+----+-------+----+-----+----+</span>
<span class="token operator">|</span><span class="token number">121553</span> <span class="token operator">|</span>root    <span class="token operator">|</span>localhost<span class="token operator">|</span>mall<span class="token operator">|</span>Sleep  <span class="token operator">|</span><span class="token number">48</span>  <span class="token operator">|</span>     <span class="token operator">|</span><span class="token boolean">NULL</span><span class="token operator">|</span>
<span class="token operator">|</span><span class="token number">139421</span> <span class="token operator">|</span>netdata <span class="token operator">|</span>localhost<span class="token operator">|</span><span class="token boolean">NULL</span><span class="token operator">|</span>Sleep  <span class="token operator">|</span><span class="token number">1</span>   <span class="token operator">|</span>     <span class="token operator">|</span><span class="token boolean">NULL</span><span class="token operator">|</span>
<span class="token operator">|</span><span class="token number">140236</span> <span class="token operator">|</span>root    <span class="token operator">|</span>localhost<span class="token operator">|</span>haha<span class="token operator">|</span>Sleep  <span class="token operator">|</span><span class="token number">1778</span><span class="token operator">|</span>     <span class="token operator">|</span><span class="token boolean">NULL</span><span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-------+--------+---------+----+-------+----+-----+----+</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><ul><li>ID：作为一个标识 ID，如果你打算 kill 一个 SQL，可以根据 ID 来进行。</li> <li>User：当前正在执行 SQL 的用户，只显示你登录账号权限范围内能够看到的用户。</li> <li>Host：显示这个语句是从哪个 ID 和端口上发出的。</li> <li>db：当前线程使用的库名。</li> <li>Command：连接执行的命令状态，一般是 Sleep、Query、Connect 等。</li> <li>Time：状态持续的时间（单位是秒）。</li> <li>State：显示当前 SQL 语句的状态，这是一个非常重要的判断标识，比如多次刷新命令时，发现 SQL 常处于 Sending data，那么这条 SQL 大概率是存在问题的。</li> <li>Info：显示正在执行的 SQL 语句，这也是你能直接拿到慢 SQL 的方式。</li></ul></li> <li>索引对性能的影响<div class="language-sql line-numbers-mode"><pre class="language-sql"><code>mysql<span class="token operator">&gt;</span><span class="token keyword">desc</span> <span class="token keyword">user</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">-----------+------------+----+---+-------+-----+</span>
<span class="token operator">|</span>Field      <span class="token operator">|</span><span class="token keyword">Type</span>        <span class="token operator">|</span><span class="token boolean">Null</span><span class="token operator">|</span><span class="token keyword">Key</span><span class="token operator">|</span><span class="token keyword">Default</span><span class="token operator">|</span>Extra<span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-----------+------------+----+---+-------+-----+</span>
<span class="token operator">|</span>id         <span class="token operator">|</span><span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span>     <span class="token operator">|</span><span class="token keyword">NO</span>  <span class="token operator">|</span>   <span class="token operator">|</span><span class="token boolean">NULL</span>   <span class="token operator">|</span>     <span class="token operator">|</span>
<span class="token operator">|</span>Name       <span class="token operator">|</span><span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">18</span><span class="token punctuation">)</span> <span class="token operator">|</span>YES <span class="token operator">|</span>   <span class="token operator">|</span><span class="token boolean">NULL</span>   <span class="token operator">|</span>     <span class="token operator">|</span>
<span class="token operator">|</span>password   <span class="token operator">|</span><span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token operator">|</span>YES <span class="token operator">|</span>   <span class="token operator">|</span><span class="token boolean">NULL</span>   <span class="token operator">|</span>     <span class="token operator">|</span>
<span class="token operator">|</span>description<span class="token operator">|</span><span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token operator">|</span>YES <span class="token operator">|</span>   <span class="token operator">|</span><span class="token boolean">NULL</span>   <span class="token operator">|</span>     <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-----------+------------+----+---+-------+-----+</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><ul><li>此时并没有添加索引，接着使用10个线程测试一条SQL，其中SQL内容是通过ID号来查看数据，记录性能数据。</li> <li>然后，在ID列添加索引后继续基于同一条 SQL ，进行10线程压测，记录性能数据。</li> <li>从测试结果来看，添加逐渐索引后，同等压力下TPS明显上升。</li> <li>接着再查看CPU资源，在未添加索引的情况下，CPU使用飙高，在添加索引后基于同一场景测试，发现服务端资源使用率较低，而且TPS上升明显。</li></ul></li> <li>通过执行计划来看索引的使用技巧
<ul><li>索引覆盖
<ul><li>走索引查询数据时，如果该索引已经包含需要的数据，则称之为索引覆盖。若索引中不能拿到想要的数据，则需要通过主键拿一整行数据，这个过程叫回表，需要一次 IO 操作，所以我们写 SQL 时尽量使用索引覆盖，降低 IO 开销。</li></ul> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code>mysql<span class="token operator">&gt;</span><span class="token keyword">show</span> <span class="token keyword">create</span> <span class="token keyword">table</span> stu \G<span class="token punctuation">;</span>
<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token number">1.</span><span class="token keyword">row</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span>
<span class="token keyword">Table</span>:stu
CreateTable:CREATETABLE<span class="token identifier"><span class="token punctuation">`</span>stu<span class="token punctuation">`</span></span><span class="token punctuation">(</span>
<span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span><span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span>NOTNULL<span class="token punctuation">,</span>
<span class="token identifier"><span class="token punctuation">`</span>name<span class="token punctuation">`</span></span><span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span>DEFAULTNULL<span class="token punctuation">,</span>
<span class="token identifier"><span class="token punctuation">`</span>mobile<span class="token punctuation">`</span></span><span class="token keyword">bigint</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span>DEFAULTNULL<span class="token punctuation">,</span>
<span class="token identifier"><span class="token punctuation">`</span>score<span class="token punctuation">`</span></span><span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span>DEFAULTNULL<span class="token punctuation">,</span>
<span class="token identifier"><span class="token punctuation">`</span>subject<span class="token punctuation">`</span></span><span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span>DEFAULTNULL<span class="token punctuation">,</span>
PRIMARYKEY<span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token keyword">KEY</span><span class="token identifier"><span class="token punctuation">`</span>idx_name<span class="token punctuation">`</span></span><span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>name<span class="token punctuation">`</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token keyword">KEY</span><span class="token identifier"><span class="token punctuation">`</span>idx_subject<span class="token punctuation">`</span></span><span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>subject<span class="token punctuation">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token keyword">ENGINE</span><span class="token operator">=</span>InnoDBDEFAULTCHARSET<span class="token operator">=</span>utf8mb4
<span class="token number">1</span>rowinset<span class="token punctuation">(</span><span class="token number">0.21</span>sec<span class="token punctuation">)</span>
<span class="token comment">//上述这是表结构</span>
mysql<span class="token operator">&gt;</span><span class="token keyword">desc</span> <span class="token keyword">select</span> name <span class="token keyword">from</span> stu <span class="token keyword">where</span> name<span class="token operator">=</span><span class="token string">&quot;lily&quot;</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">--+-----------+--------+----------+----+-------------+--------+-------+-----+----+--------+----------+</span>
<span class="token operator">|</span>id<span class="token operator">|</span>select_type<span class="token operator">|</span><span class="token keyword">table</span>   <span class="token operator">|</span>partitions<span class="token operator">|</span><span class="token keyword">type</span><span class="token operator">|</span>possible_keys<span class="token operator">|</span><span class="token keyword">key</span>     <span class="token operator">|</span>key_len<span class="token operator">|</span>ref  <span class="token operator">|</span><span class="token keyword">rows</span><span class="token operator">|</span>filtered<span class="token operator">|</span>Extra     <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">--+-----------+--------+----------+----+-------------+--------+-------+-----+----+--------+----------+</span>
<span class="token operator">|</span><span class="token number">1</span> <span class="token operator">|</span><span class="token keyword">SIMPLE</span>     <span class="token operator">|</span>stu     <span class="token operator">|</span><span class="token boolean">NULL</span>      <span class="token operator">|</span>ref <span class="token operator">|</span>idx_name     <span class="token operator">|</span>idx_name<span class="token operator">|</span><span class="token number">47</span>     <span class="token operator">|</span>const<span class="token operator">|</span><span class="token number">1</span>   <span class="token operator">|</span><span class="token number">100.00</span>  <span class="token operator">|</span>Usingindex<span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">--+-----------+--------+----------+----+-------------+--------+-------+-----+----+--------+----------+</span>
<span class="token number">1</span>rowinset<span class="token punctuation">,</span><span class="token number">1</span>warning<span class="token punctuation">(</span><span class="token number">0.01</span>sec<span class="token punctuation">)</span>
<span class="token comment">//上述是第一段执行计划</span>

mysql<span class="token operator">&gt;</span><span class="token keyword">desc</span> <span class="token keyword">select</span> name<span class="token punctuation">,</span>score <span class="token keyword">from</span> stu <span class="token keyword">where</span> name<span class="token operator">=</span><span class="token string">&quot;lily&quot;</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">--+-----------+--------+----------+----+-------------+--------+-------+-----+----+--------+-----+</span>
<span class="token operator">|</span>id<span class="token operator">|</span>select_type<span class="token operator">|</span><span class="token keyword">table</span>   <span class="token operator">|</span>partitions<span class="token operator">|</span><span class="token keyword">type</span><span class="token operator">|</span>possible_keys<span class="token operator">|</span><span class="token keyword">key</span>     <span class="token operator">|</span>key_len<span class="token operator">|</span>ref  <span class="token operator">|</span><span class="token keyword">rows</span><span class="token operator">|</span>filtered<span class="token operator">|</span>Extra<span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">--+-----------+--------+----------+----+-------------+--------+-------+-----+----+--------+-----+</span>
<span class="token operator">|</span><span class="token number">1</span> <span class="token operator">|</span><span class="token keyword">SIMPLE</span>     <span class="token operator">|</span>stu     <span class="token operator">|</span><span class="token boolean">NULL</span>      <span class="token operator">|</span>ref <span class="token operator">|</span>idx_name     <span class="token operator">|</span>idx_name<span class="token operator">|</span><span class="token number">47</span>     <span class="token operator">|</span>const<span class="token operator">|</span><span class="token number">1</span>   <span class="token operator">|</span><span class="token number">100.00</span>  <span class="token operator">|</span><span class="token boolean">NULL</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">--+-----------+--------+----------+----+-------------+--------+-------+-----+----+--------+-----+</span>
<span class="token number">1</span>rowinset<span class="token punctuation">,</span><span class="token number">1</span>warning<span class="token punctuation">(</span><span class="token number">0.00</span>sec<span class="token punctuation">)</span>
<span class="token comment">//上述是第二段执行计划</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br></div></div>首先看下 stu 表的结构，再观察下面两个 SQL 的执行计划对比，第一个 SQL 走 name 字段，只拿 name 字段内容，第一段执行计划显示了 Using index，说明索引覆盖了；而第二个 SQL 需要额外取 mobile 字段，所以需要回表，你也可以发现第二段执行计划 Extra 列返回的 NULL，所以没有用到索引覆盖</li> <li>联合索引
<ul><li>联合索引就是多个字段组成联合索引，同样还是这样的一个示例 SQL，索引规则同样是 index_name(c1,c2,c3)，下面这样的示例一定是符合最左前缀规则的：</li></ul> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> <span class="token keyword">table</span> <span class="token keyword">WHERE</span> c1<span class="token operator">=</span><span class="token string">&quot;1&quot;</span> <span class="token operator">AND</span> c2<span class="token operator">=</span><span class="token string">&quot;2&quot;</span> <span class="token operator">AND</span> c3<span class="token operator">=</span><span class="token string">&quot;3&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div>改变下 SQL 的查询顺序，如下所示<div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> <span class="token keyword">table</span> <span class="token keyword">WHERE</span> c2<span class="token operator">=</span><span class="token string">&quot;2&quot;</span> <span class="token operator">AND</span> c3<span class="token operator">=</span><span class="token string">&quot;3&quot;</span> ANDc1<span class="token operator">=</span><span class="token string">&quot;1&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div>不管你是使用 (c1,c2,c3) 或者是 (c2,c3,c1)，都是使用了联合索引，虽然表面上 (c2,c3,c1) 不符合最左前缀规则，但是 MySQL 本身是有查询优化器，它会确定这条 SQL 根据联合索引的字段顺序，最后再确定执行计划。所以说在查询字段满足条件的情况下字段顺序查询优化器是可以帮助你“纠正”的，在你项目实操过程中，对最左前缀的理解不要只局限于字面，如果你不确定可以通过执行计划来判断。<div class="language-sql line-numbers-mode"><pre class="language-sql"><code>mysql<span class="token operator">&gt;</span><span class="token keyword">desc</span> <span class="token keyword">select</span> name<span class="token punctuation">,</span>subject<span class="token punctuation">,</span>score <span class="token keyword">from</span> stu <span class="token keyword">where</span> subject<span class="token operator">=</span><span class="token string">'english'</span> <span class="token keyword">order</span> <span class="token keyword">by</span> score<span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">--+-----------+-----+----------+------+-------------+------+-------+------+------+--------+------------------------+</span>
<span class="token operator">|</span>id<span class="token operator">|</span>select_type<span class="token operator">|</span><span class="token keyword">table</span><span class="token operator">|</span>partitions<span class="token operator">|</span><span class="token keyword">type</span>  <span class="token operator">|</span>possible_keys<span class="token operator">|</span><span class="token keyword">key</span>   <span class="token operator">|</span>key_len<span class="token operator">|</span>ref   <span class="token operator">|</span><span class="token keyword">rows</span>  <span class="token operator">|</span>filtered<span class="token operator">|</span>Extra                   <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">--+-----------+-----+----------+------+-------------+------+-------+------+------+--------+------------------------+</span>
<span class="token operator">|</span><span class="token number">1</span> <span class="token operator">|</span><span class="token keyword">SIMPLE</span>     <span class="token operator">|</span>stu  <span class="token operator">|</span><span class="token boolean">NULL</span>      <span class="token operator">|</span><span class="token keyword">ALL</span>   <span class="token operator">|</span>idx_subject  <span class="token operator">|</span><span class="token boolean">NULL</span>  <span class="token operator">|</span><span class="token boolean">NULL</span>   <span class="token operator">|</span><span class="token boolean">NULL</span>  <span class="token operator">|</span><span class="token number">6</span>     <span class="token operator">|</span><span class="token number">50.00</span>   <span class="token operator">|</span>Usingwhere<span class="token punctuation">;</span>Usingfilesort<span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">--+-----------+-----+----------+------+-------------+------+-------+------+------+--------+------------------------+</span>
<span class="token number">1</span>rowinset<span class="token punctuation">,</span><span class="token number">1</span>warning<span class="token punctuation">(</span><span class="token number">0.02</span>sec<span class="token punctuation">)</span>
<span class="token comment">//以上是第一段执行计划</span>

mysql<span class="token operator">&gt;</span><span class="token keyword">alter</span> <span class="token keyword">table</span> stu <span class="token keyword">add</span> <span class="token keyword">index</span> idx_subject_score_name<span class="token punctuation">(</span>subject<span class="token punctuation">,</span>score<span class="token punctuation">,</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
QueryOK<span class="token punctuation">,</span><span class="token number">0</span>rowsaffected<span class="token punctuation">(</span><span class="token number">0.15</span>sec<span class="token punctuation">)</span>
<span class="token comment">//以上添加联合索引</span>

mysql<span class="token operator">&gt;</span><span class="token keyword">desc</span> <span class="token keyword">select</span> name<span class="token punctuation">,</span>subject<span class="token punctuation">,</span>score <span class="token keyword">from</span> stu <span class="token keyword">where</span> subject<span class="token operator">=</span><span class="token string">'english'</span> <span class="token keyword">order</span> <span class="token keyword">by</span> score<span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">--+-----------+-----+----------+----+----------------------------------+----------------------+-------+-----+----+--------+---------------------+</span>
<span class="token operator">|</span>id<span class="token operator">|</span>select_type<span class="token operator">|</span><span class="token keyword">table</span><span class="token operator">|</span>partitions<span class="token operator">|</span><span class="token keyword">type</span><span class="token operator">|</span>possible_keys                     <span class="token operator">|</span><span class="token keyword">key</span>                   <span class="token operator">|</span>key_len<span class="token operator">|</span>ref  <span class="token operator">|</span><span class="token keyword">rows</span><span class="token operator">|</span>filtered<span class="token operator">|</span>Extra                <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">--+-----------+-----+----------+----+----------------------------------+----------------------+-------+-----+----+--------+---------------------+</span>
<span class="token operator">|</span><span class="token number">1</span> <span class="token operator">|</span><span class="token keyword">SIMPLE</span>     <span class="token operator">|</span>stu  <span class="token operator">|</span><span class="token boolean">NULL</span>      <span class="token operator">|</span>ref <span class="token operator">|</span>idx_subject<span class="token punctuation">,</span>idx_subject_score_name<span class="token operator">|</span>idx_subject_score_name<span class="token operator">|</span><span class="token number">83</span>     <span class="token operator">|</span>const<span class="token operator">|</span><span class="token number">3</span>   <span class="token operator">|</span><span class="token number">100.00</span>  <span class="token operator">|</span>Usingwhere<span class="token punctuation">;</span>Usingindex<span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">--+-----------+-----+----------+----+----------------------------------+----------------------+-------+-----+----+--------+---------------------+</span>
<span class="token comment">//以上是第二段执行计划</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div></li> <li>索引失效的场景
<ul><li><strong>隐式类型转换</strong></li></ul> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token punctuation">(</span>root<span class="token variable">@localhost</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>t<span class="token punctuation">]</span><span class="token operator">&gt;</span> <span class="token keyword">show</span> <span class="token keyword">create</span> <span class="token keyword">table</span> t\G
<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span> <span class="token number">1.</span> <span class="token keyword">row</span> <span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span>
       <span class="token keyword">Table</span>: t
<span class="token keyword">Create</span> <span class="token keyword">Table</span>: <span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token identifier"><span class="token punctuation">`</span>t<span class="token punctuation">`</span></span> <span class="token punctuation">(</span>
  <span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>name<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>score<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token keyword">KEY</span> <span class="token identifier"><span class="token punctuation">`</span>idx_name<span class="token punctuation">`</span></span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>name<span class="token punctuation">`</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token keyword">KEY</span> <span class="token identifier"><span class="token punctuation">`</span>idx_score<span class="token punctuation">`</span></span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>score<span class="token punctuation">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">InnoDB</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span><span class="token operator">=</span>utf8mb4
<span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>
<span class="token comment">//以上是建表语句</span>

<span class="token punctuation">(</span>root<span class="token variable">@localhost</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>t<span class="token punctuation">]</span><span class="token operator">&gt;</span> <span class="token keyword">desc</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> t <span class="token keyword">where</span> socre <span class="token operator">=</span> <span class="token string">'99'</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">----+-------------+-------+------------+------+---------------+------------+---------+-------+------+----------+-------+</span>
<span class="token operator">|</span> id <span class="token operator">|</span> select_type <span class="token operator">|</span> <span class="token keyword">table</span> <span class="token operator">|</span> partitions <span class="token operator">|</span> <span class="token keyword">type</span> <span class="token operator">|</span> possible_keys <span class="token operator">|</span> <span class="token keyword">key</span>        <span class="token operator">|</span> key_len <span class="token operator">|</span> ref   <span class="token operator">|</span> <span class="token keyword">rows</span> <span class="token operator">|</span> filtered <span class="token operator">|</span> Extra <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----+-------------+-------+------------+------+---------------+------------+---------+-------+------+----------+-------+</span>
<span class="token operator">|</span>  <span class="token number">1</span> <span class="token operator">|</span> <span class="token keyword">SIMPLE</span>      <span class="token operator">|</span> t     <span class="token operator">|</span> <span class="token boolean">NULL</span>       <span class="token operator">|</span> ref  <span class="token operator">|</span> idx_score    <span class="token operator">|</span> idx_score   <span class="token operator">|</span> <span class="token number">47</span>      <span class="token operator">|</span> const <span class="token operator">|</span>    <span class="token number">2</span> <span class="token operator">|</span>   <span class="token number">100.00</span> <span class="token operator">|</span> <span class="token boolean">NULL</span>  <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----+-------------+-------+------------+------+---------------+------------+---------+-------+------+----------+-------+</span>
<span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span><span class="token punctuation">,</span> <span class="token number">1</span> warning <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

<span class="token punctuation">(</span>root<span class="token variable">@localhost</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>t<span class="token punctuation">]</span><span class="token operator">&gt;</span> <span class="token keyword">desc</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> t <span class="token keyword">where</span> socre <span class="token operator">=</span> <span class="token number">99</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">----+-------------+-------+------------+------+---------------+------+---------+------+------+----------+-------------+</span>
<span class="token operator">|</span> id <span class="token operator">|</span> select_type <span class="token operator">|</span> <span class="token keyword">table</span> <span class="token operator">|</span> partitions <span class="token operator">|</span> <span class="token keyword">type</span> <span class="token operator">|</span> possible_keys <span class="token operator">|</span> <span class="token keyword">key</span>  <span class="token operator">|</span> key_len <span class="token operator">|</span> ref  <span class="token operator">|</span> <span class="token keyword">rows</span> <span class="token operator">|</span> filtered <span class="token operator">|</span> Extra       <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----+-------------+-------+------------+------+---------------+------+---------+------+------+----------+-------------+</span>
<span class="token operator">|</span>  <span class="token number">1</span> <span class="token operator">|</span> <span class="token keyword">SIMPLE</span>      <span class="token operator">|</span> t     <span class="token operator">|</span> <span class="token boolean">NULL</span>       <span class="token operator">|</span> <span class="token keyword">ALL</span>  <span class="token operator">|</span> idx_score     <span class="token operator">|</span> <span class="token boolean">NULL</span> <span class="token operator">|</span> <span class="token boolean">NULL</span>    <span class="token operator">|</span> <span class="token boolean">NULL</span> <span class="token operator">|</span>    <span class="token number">4</span> <span class="token operator">|</span>    <span class="token number">25.00</span> <span class="token operator">|</span> <span class="token keyword">Using</span> <span class="token keyword">where</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----+-------------+-------+------------+------+---------------+------+---------+------+------+----------+-------------+</span>
<span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span><span class="token punctuation">,</span> <span class="token number">3</span> <span class="token keyword">warnings</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div><ul><li><strong>模糊匹配开头</strong>，由于 MySQL 最左匹配原则，所以查询条件模糊开头无法命中索引</li></ul> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token punctuation">(</span>root<span class="token variable">@localhost</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>t<span class="token punctuation">]</span><span class="token operator">&gt;</span> <span class="token keyword">desc</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> t <span class="token keyword">where</span> score  <span class="token operator">like</span> <span class="token string">'%9'</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">----+-------------+-------+------------+------+---------------+------+---------+------+------+----------+-------------+</span>
<span class="token operator">|</span> id <span class="token operator">|</span> select_type <span class="token operator">|</span> <span class="token keyword">table</span> <span class="token operator">|</span> partitions <span class="token operator">|</span> <span class="token keyword">type</span> <span class="token operator">|</span> possible_keys <span class="token operator">|</span> <span class="token keyword">key</span>  <span class="token operator">|</span> key_len <span class="token operator">|</span> ref  <span class="token operator">|</span> <span class="token keyword">rows</span> <span class="token operator">|</span> filtered <span class="token operator">|</span> Extra       <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----+-------------+-------+------------+------+---------------+------+---------+------+------+----------+-------------+</span>
<span class="token operator">|</span>  <span class="token number">1</span> <span class="token operator">|</span> <span class="token keyword">SIMPLE</span>      <span class="token operator">|</span> t     <span class="token operator">|</span> <span class="token boolean">NULL</span>       <span class="token operator">|</span> <span class="token keyword">ALL</span>  <span class="token operator">|</span> <span class="token boolean">NULL</span>          <span class="token operator">|</span> <span class="token boolean">NULL</span> <span class="token operator">|</span> <span class="token boolean">NULL</span>    <span class="token operator">|</span> <span class="token boolean">NULL</span> <span class="token operator">|</span>    <span class="token number">4</span> <span class="token operator">|</span>    <span class="token number">25.00</span> <span class="token operator">|</span> <span class="token keyword">Using</span> <span class="token keyword">where</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----+-------------+-------+------------+------+---------------+------+---------+------+------+----------+-------------+</span>
<span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span><span class="token punctuation">,</span> <span class="token number">1</span> warning <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><ul><li>or不同条件，从上面建表结构中我们可以看到 name 字段和 score 字段都有索引，但直接写 or 查询两个字段无法使用索引，这种场景，我们可以将 or 改写成 union 即可</li></ul> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token punctuation">(</span>root<span class="token variable">@localhost</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>t<span class="token punctuation">]</span><span class="token operator">&gt;</span> <span class="token keyword">desc</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> t <span class="token keyword">where</span> name <span class="token operator">=</span> <span class="token string">'allen'</span> <span class="token operator">*</span><span class="token operator">*</span><span class="token operator">or</span><span class="token operator">*</span><span class="token operator">*</span> score <span class="token operator">=</span> <span class="token string">'456'</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">----+-------------+-------+------------+------+---------------------+------+---------+------+------+----------+-------------+</span>
<span class="token operator">|</span> id <span class="token operator">|</span> select_type <span class="token operator">|</span> <span class="token keyword">table</span> <span class="token operator">|</span> partitions <span class="token operator">|</span> <span class="token keyword">type</span> <span class="token operator">|</span> possible_keys       <span class="token operator">|</span> <span class="token keyword">key</span>  <span class="token operator">|</span> key_len <span class="token operator">|</span> ref  <span class="token operator">|</span> <span class="token keyword">rows</span> <span class="token operator">|</span> filtered <span class="token operator">|</span> Extra       <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----+-------------+-------+------------+------+---------------------+------+---------+------+------+----------+-------------+</span>
<span class="token operator">|</span>  <span class="token number">1</span> <span class="token operator">|</span> <span class="token keyword">SIMPLE</span>      <span class="token operator">|</span> t     <span class="token operator">|</span> <span class="token boolean">NULL</span>       <span class="token operator">|</span> <span class="token keyword">ALL</span>  <span class="token operator">|</span> idx_name<span class="token punctuation">,</span>idx_score  <span class="token operator">|</span> <span class="token boolean">NULL</span> <span class="token operator">|</span> <span class="token boolean">NULL</span>    <span class="token operator">|</span> <span class="token boolean">NULL</span> <span class="token operator">|</span>    <span class="token number">4</span> <span class="token operator">|</span>    <span class="token number">43.75</span> <span class="token operator">|</span> <span class="token keyword">Using</span> <span class="token keyword">where</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----+-------------+-------+------------+------+---------------------+------+---------+------+------+----------+-------------+</span>
<span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span><span class="token punctuation">,</span> <span class="token number">1</span> warning <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>
<span class="token comment">//第一段执行计划</span>

<span class="token punctuation">(</span>root<span class="token variable">@localhost</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>t<span class="token punctuation">]</span><span class="token operator">&gt;</span> <span class="token keyword">desc</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> t <span class="token keyword">where</span> name <span class="token operator">=</span> <span class="token string">'allen'</span> <span class="token operator">*</span><span class="token operator">*</span><span class="token keyword">union</span><span class="token operator">*</span><span class="token operator">*</span> <span class="token keyword">all</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> t <span class="token keyword">where</span> score <span class="token operator">=</span> <span class="token string">'456'</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">----+-------------+-------+------------+------+---------------+------------+---------+-------+------+----------+-------+</span>
<span class="token operator">|</span> id <span class="token operator">|</span> select_type <span class="token operator">|</span> <span class="token keyword">table</span> <span class="token operator">|</span> partitions <span class="token operator">|</span> <span class="token keyword">type</span> <span class="token operator">|</span> possible_keys <span class="token operator">|</span> <span class="token keyword">key</span>        <span class="token operator">|</span> key_len <span class="token operator">|</span> ref   <span class="token operator">|</span> <span class="token keyword">rows</span> <span class="token operator">|</span> filtered <span class="token operator">|</span> Extra <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----+-------------+-------+------------+------+---------------+------------+---------+-------+------+----------+-------+</span>
<span class="token operator">|</span>  <span class="token number">1</span> <span class="token operator">|</span> <span class="token keyword">PRIMARY</span>     <span class="token operator">|</span> t     <span class="token operator">|</span> <span class="token boolean">NULL</span>       <span class="token operator">|</span> ref  <span class="token operator">|</span> idx_name      <span class="token operator">|</span> idx_name   <span class="token operator">|</span> <span class="token number">47</span>      <span class="token operator">|</span> const <span class="token operator">|</span>    <span class="token number">1</span> <span class="token operator">|</span>   <span class="token number">100.00</span> <span class="token operator">|</span> <span class="token boolean">NULL</span>  <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">2</span> <span class="token operator">|</span> <span class="token keyword">UNION</span>       <span class="token operator">|</span> t     <span class="token operator">|</span> <span class="token boolean">NULL</span>       <span class="token operator">|</span> ref  <span class="token operator">|</span> idx_score     <span class="token operator">|</span> idx_score  <span class="token operator">|</span> <span class="token number">47</span>      <span class="token operator">|</span> const <span class="token operator">|</span>    <span class="token number">1</span> <span class="token operator">|</span>   <span class="token number">100.00</span> <span class="token operator">|</span> <span class="token boolean">NULL</span>  <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----+-------------+-------+------------+------+---------------+------------+---------+-------+------+----------+-------+</span>
<span class="token number">2</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span><span class="token punctuation">,</span> <span class="token number">1</span> warning <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>
<span class="token comment">//第二段执行计划</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div></li></ul></li></ol> <h2 id="线上全链路性能测试实践总结"><a href="#线上全链路性能测试实践总结" class="header-anchor">#</a> 线上全链路性能测试实践总结</h2></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/qa/performance/Locust.html" class="prev">
        Locust
      </a></span> <span class="next"><a href="/qa/performance/性能指标监控.html">
        性能指标监控
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.dd60fddf.js" defer></script><script src="/assets/js/2.1d799614.js" defer></script><script src="/assets/js/4.6dd544f6.js" defer></script>
  </body>
</html>
