(window.webpackJsonp=window.webpackJsonp||[]).push([[124],{659:function(t,l,a){"use strict";a.r(l);var s=a(35),r=Object(s.a)({},(function(){var t=this,l=t.$createElement,a=t._self._c||l;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("p"),a("div",{staticClass:"table-of-contents"},[a("ul",[a("li",[a("a",{attrs:{href:"#原理"}},[t._v("原理")])]),a("li",[a("a",{attrs:{href:"#ssrf攻击-黑客能做什么"}},[t._v("SSRF攻击，黑客能做什么")])]),a("li",[a("a",{attrs:{href:"#ssrf防护"}},[t._v("SSRF防护")])]),a("li",[a("a",{attrs:{href:"#工具推荐"}},[t._v("工具推荐")])]),a("li",[a("a",{attrs:{href:"#靶场推荐"}},[t._v("靶场推荐")])])])]),a("p"),t._v(" "),a("h2",{attrs:{id:"原理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#原理"}},[t._v("#")]),t._v(" 原理")]),t._v(" "),a("ul",[a("li",[t._v("我们知道，服务端有代理请求的功能：用户在浏览器中输入一个url(比如图片资源)，服务端会向这个url发起请求，通过访问其他服务器资源来完成正常的页面展示。这个时候，只要黑客在输入中提交一个内网url，就能让服务器发起一个黑客定义的内网请求，从而获取内网数据。")]),t._v(" "),a("li",[t._v("服务端作为内网设备，通常具有很高的权限，所以，这个伪造请求往往因为绕过大部分的认证和授权机制，而产生很严重的后果。")])]),t._v(" "),a("h2",{attrs:{id:"ssrf攻击-黑客能做什么"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ssrf攻击-黑客能做什么"}},[t._v("#")]),t._v(" SSRF攻击，黑客能做什么")]),t._v(" "),a("ol",[a("li",[a("p",[t._v("内网探测")]),t._v(" "),a("ul",[a("li",[t._v("内外网一般是隔离的，黑客在外网，是无法知道内网有哪些服务器，以及提供的服务。")]),t._v(" "),a("li",[t._v("以百度搜图为例，通过拼接地址，如果是正常的图片地址，百度能请求到数据并返回。")])]),t._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("https://image.baidu.com/search/detail?objurl=https://gimg2.baidu.com/image_search/src=http://p1.meituan.net/shaitu/3a50b3987880270eb76a8beb492d8d0f1577873.jpg\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br")])]),a("ul",[a("li",[t._v("假设服务端逻辑是这样：在请求过程中，百度会判断拼接objurl返回数据的ContentType是否为image/jpeg，可能的返回结果有如下：\n"),a("ul",[a("li",[t._v("“是”，展示图片")]),t._v(" "),a("li",[t._v("“不是”，则返回格式错误")]),t._v(" "),a("li",[t._v("无响应，则返回找不到图片")])])]),t._v(" "),a("li",[t._v("构造恶意请求")])]),t._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("https://image.baidu.com/search/detail?objurl=127.0.0.1:3306\n- 如果返回格式错误，则表示服务可用\n- 如果返回找不到图片，则表示服务不可用\n- 根据此返回信息，黑客就能知道服务端本地是否开启了Mysql服务\n- 重复此步骤，尝试不同的ip和端口号，一点一点探测内网结构\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br")])])]),t._v(" "),a("li",[a("p",[t._v("文件读取")]),t._v(" "),a("ul",[a("li",[t._v("在uri中，开头的http://和https://表示需要什么协议去进行请求")]),t._v(" "),a("li",[t._v("除此之外，还有很多协议，比如file://就是直接读取本地文件，如file:///etc/passwd，从而知道本地有哪些用户")]),t._v(" "),a("li",[t._v("经过不断尝试，黑客就能把服务器中的文件都给获取出来，比如密钥、源码等敏感信息")])])])]),t._v(" "),a("h2",{attrs:{id:"ssrf防护"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ssrf防护"}},[t._v("#")]),t._v(" SSRF防护")]),t._v(" "),a("ol",[a("li",[a("p",[t._v("白名单限制")]),t._v(" "),a("ul",[a("li",[t._v("最简单、最高效的方式")]),t._v(" "),a("li",[t._v("即对用户提交上来的url进行限制。比如，只允许是同一个域名下的url")])])]),t._v(" "),a("li",[a("p",[t._v("协议和资源类型限制")]),t._v(" "),a("ul",[a("li",[t._v("对于使用协议，比如只允许http、https协议")]),t._v(" "),a("li",[t._v("对于返回的内容，比如只允许图片格式的内容")])])]),t._v(" "),a("li",[a("p",[t._v("请求端限制")]),t._v(" "),a("ul",[a("li",[t._v("为其他业务提供服务的接口尽量使用post（违背Restful？？，通常针对上行操作），避免get使用。因为，在ssrf中，发起一个post请求难度远大于get请求，毕竟发起post请求，需要在发起http请求的时候进行配置。")]),t._v(" "),a("li",[t._v("为其他业务提供服务的接口，最好每次进行验证。")])])])]),t._v(" "),a("h2",{attrs:{id:"工具推荐"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#工具推荐"}},[t._v("#")]),t._v(" 工具推荐")]),t._v(" "),a("ol",[a("li",[t._v("Burp Collaborator\n"),a("ul",[a("li",[t._v("BurpSuite 默认提供 Collaborator Server 用于实现 DNS 解析，在一些无回显的安全测试中，会将解析日志返回给 BurpSuite")]),t._v(" "),a("li",[t._v("以靶场题目为例\n"),a("ul",[a("li",[t._v("打开 Burp Collaborator Client")]),t._v(" "),a("li",[t._v("点击“Copy to clipboard”获取生成的域名")]),t._v(" "),a("li",[t._v("访问后回到 Burp Collaborator client，点击“Poll now”就可以看到 DNS 请求记录，这说明存在SSRF漏洞。")]),t._v(" "),a("li",[t._v("这个检测方法比较通用简单，且无须自己搭建 DNS 服务器，非常方便，强烈推荐！！！")])])])])]),t._v(" "),a("li",[t._v("SSRFmap\n"),a("ul",[a("li",[t._v("官网地址：https://github.com/swisskyrepo/SSRFmap")]),t._v(" "),a("li",[t._v("利用它可检测与利用 SSRF 漏洞")]),t._v(" "),a("li",[t._v("它也整合了一些常用漏洞可以结合 SSRF 去利用，比如 fastjson、mysql、github 的一些历史漏洞")]),t._v(" "),a("li",[t._v("还有端口扫描、读取文件等利用功能，都是实用的漏洞利用能力")]),t._v(" "),a("li",[t._v("使用上会比 Burp Collaborator 便捷，但检测能力上其实没有 Burp Collaborator 那样准确，SSRFmap 有时会利用失败")]),t._v(" "),a("li",[t._v("推荐使用 Burp Collaborator 用来检测 SSRF 是否存在，再使用 SSRFmap 做一些漏洞利用，比如读取敏感文件等操作")])])])]),t._v(" "),a("h2",{attrs:{id:"靶场推荐"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#靶场推荐"}},[t._v("#")]),t._v(" 靶场推荐")]),t._v(" "),a("ol",[a("li",[t._v("Pikachu\n"),a("ul",[a("li",[t._v("皮卡丘漏洞练习平台")])])])])])}),[],!1,null,null,null);l.default=r.exports}}]);