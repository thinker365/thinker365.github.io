<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>杏壳儿</title>
    <meta name="generator" content="VuePress 1.9.7">
    
    <meta name="description" content="">
    
    <link rel="preload" href="/assets/css/0.styles.5675a7d7.css" as="style"><link rel="preload" href="/assets/js/app.dd60fddf.js" as="script"><link rel="preload" href="/assets/js/2.1d799614.js" as="script"><link rel="preload" href="/assets/js/79.194bc603.js" as="script"><link rel="prefetch" href="/assets/js/10.f42a5970.js"><link rel="prefetch" href="/assets/js/100.fd420176.js"><link rel="prefetch" href="/assets/js/101.fd3f9957.js"><link rel="prefetch" href="/assets/js/102.d3c4087c.js"><link rel="prefetch" href="/assets/js/103.5bf5f364.js"><link rel="prefetch" href="/assets/js/104.c19dc6fc.js"><link rel="prefetch" href="/assets/js/105.3644a723.js"><link rel="prefetch" href="/assets/js/106.c99225f8.js"><link rel="prefetch" href="/assets/js/107.97852924.js"><link rel="prefetch" href="/assets/js/108.212c27f0.js"><link rel="prefetch" href="/assets/js/109.d6e4c811.js"><link rel="prefetch" href="/assets/js/11.91f395ed.js"><link rel="prefetch" href="/assets/js/110.96b9b201.js"><link rel="prefetch" href="/assets/js/111.78b25fde.js"><link rel="prefetch" href="/assets/js/112.8c82f9a4.js"><link rel="prefetch" href="/assets/js/113.aae564aa.js"><link rel="prefetch" href="/assets/js/114.313f0d5b.js"><link rel="prefetch" href="/assets/js/115.844f47cf.js"><link rel="prefetch" href="/assets/js/116.4d2691a0.js"><link rel="prefetch" href="/assets/js/117.bd36d4a2.js"><link rel="prefetch" href="/assets/js/118.d205f7e7.js"><link rel="prefetch" href="/assets/js/119.ee336fe8.js"><link rel="prefetch" href="/assets/js/12.5e7abec9.js"><link rel="prefetch" href="/assets/js/120.f5ba9dbe.js"><link rel="prefetch" href="/assets/js/121.05e1c205.js"><link rel="prefetch" href="/assets/js/122.779c5f8c.js"><link rel="prefetch" href="/assets/js/123.64ad1fde.js"><link rel="prefetch" href="/assets/js/124.72120675.js"><link rel="prefetch" href="/assets/js/125.7f1e0958.js"><link rel="prefetch" href="/assets/js/126.dcd28d9f.js"><link rel="prefetch" href="/assets/js/127.428f223e.js"><link rel="prefetch" href="/assets/js/128.0ebf700a.js"><link rel="prefetch" href="/assets/js/129.3d7442ee.js"><link rel="prefetch" href="/assets/js/13.ec7d048b.js"><link rel="prefetch" href="/assets/js/130.b946546b.js"><link rel="prefetch" href="/assets/js/131.0ea40481.js"><link rel="prefetch" href="/assets/js/132.4a4437c1.js"><link rel="prefetch" href="/assets/js/133.7e17bb00.js"><link rel="prefetch" href="/assets/js/134.95928b65.js"><link rel="prefetch" href="/assets/js/135.fb730cc9.js"><link rel="prefetch" href="/assets/js/136.ce2e6b16.js"><link rel="prefetch" href="/assets/js/137.30dda982.js"><link rel="prefetch" href="/assets/js/138.9d9bd5df.js"><link rel="prefetch" href="/assets/js/139.19e62986.js"><link rel="prefetch" href="/assets/js/14.27407a31.js"><link rel="prefetch" href="/assets/js/140.425bbd4e.js"><link rel="prefetch" href="/assets/js/141.13f9ac88.js"><link rel="prefetch" href="/assets/js/142.b12b14dc.js"><link rel="prefetch" href="/assets/js/15.3653047a.js"><link rel="prefetch" href="/assets/js/16.7baae9f5.js"><link rel="prefetch" href="/assets/js/17.dcad52cb.js"><link rel="prefetch" href="/assets/js/18.bb46f976.js"><link rel="prefetch" href="/assets/js/19.0925b886.js"><link rel="prefetch" href="/assets/js/20.e2181917.js"><link rel="prefetch" href="/assets/js/21.2e00fc64.js"><link rel="prefetch" href="/assets/js/22.60af365a.js"><link rel="prefetch" href="/assets/js/23.9a6247e9.js"><link rel="prefetch" href="/assets/js/24.533a55d3.js"><link rel="prefetch" href="/assets/js/25.0d54429f.js"><link rel="prefetch" href="/assets/js/26.f70e7a58.js"><link rel="prefetch" href="/assets/js/27.357c2f0c.js"><link rel="prefetch" href="/assets/js/28.05884156.js"><link rel="prefetch" href="/assets/js/29.b63f5d12.js"><link rel="prefetch" href="/assets/js/3.b3c0c8cc.js"><link rel="prefetch" href="/assets/js/30.c37379b8.js"><link rel="prefetch" href="/assets/js/31.e5583500.js"><link rel="prefetch" href="/assets/js/32.2f8a89ce.js"><link rel="prefetch" href="/assets/js/33.8526b5cc.js"><link rel="prefetch" href="/assets/js/34.8c476ba1.js"><link rel="prefetch" href="/assets/js/35.28a9e848.js"><link rel="prefetch" href="/assets/js/36.22caee50.js"><link rel="prefetch" href="/assets/js/37.f564431c.js"><link rel="prefetch" href="/assets/js/38.60510a45.js"><link rel="prefetch" href="/assets/js/39.b57d73b7.js"><link rel="prefetch" href="/assets/js/4.6dd544f6.js"><link rel="prefetch" href="/assets/js/40.a0f12257.js"><link rel="prefetch" href="/assets/js/41.ae21b83f.js"><link rel="prefetch" href="/assets/js/42.4a8b0eed.js"><link rel="prefetch" href="/assets/js/43.a4b1dbe5.js"><link rel="prefetch" href="/assets/js/44.7957e7b8.js"><link rel="prefetch" href="/assets/js/45.22f92df5.js"><link rel="prefetch" href="/assets/js/46.a7bd57b2.js"><link rel="prefetch" href="/assets/js/47.1076bbe9.js"><link rel="prefetch" href="/assets/js/48.10c8f82d.js"><link rel="prefetch" href="/assets/js/49.aea6f4f0.js"><link rel="prefetch" href="/assets/js/5.7fae9900.js"><link rel="prefetch" href="/assets/js/50.97341023.js"><link rel="prefetch" href="/assets/js/51.2213cc76.js"><link rel="prefetch" href="/assets/js/52.4b1c29e4.js"><link rel="prefetch" href="/assets/js/53.a6434736.js"><link rel="prefetch" href="/assets/js/54.59470ace.js"><link rel="prefetch" href="/assets/js/55.49cec6b6.js"><link rel="prefetch" href="/assets/js/56.06f2e67d.js"><link rel="prefetch" href="/assets/js/57.2e812620.js"><link rel="prefetch" href="/assets/js/58.e6ce6313.js"><link rel="prefetch" href="/assets/js/59.35026211.js"><link rel="prefetch" href="/assets/js/6.8c7a6ec4.js"><link rel="prefetch" href="/assets/js/60.cc2c97a8.js"><link rel="prefetch" href="/assets/js/61.8d91a90f.js"><link rel="prefetch" href="/assets/js/62.991f9147.js"><link rel="prefetch" href="/assets/js/63.85532e4f.js"><link rel="prefetch" href="/assets/js/64.90068745.js"><link rel="prefetch" href="/assets/js/65.ff870427.js"><link rel="prefetch" href="/assets/js/66.ba94b154.js"><link rel="prefetch" href="/assets/js/67.5158a096.js"><link rel="prefetch" href="/assets/js/68.54fe2ba5.js"><link rel="prefetch" href="/assets/js/69.bcb4c73f.js"><link rel="prefetch" href="/assets/js/7.3c7e6d86.js"><link rel="prefetch" href="/assets/js/70.00d41657.js"><link rel="prefetch" href="/assets/js/71.892ff6f5.js"><link rel="prefetch" href="/assets/js/72.2302172b.js"><link rel="prefetch" href="/assets/js/73.02125fde.js"><link rel="prefetch" href="/assets/js/74.23ba9330.js"><link rel="prefetch" href="/assets/js/75.c6915e81.js"><link rel="prefetch" href="/assets/js/76.f26b5808.js"><link rel="prefetch" href="/assets/js/77.e9b2145e.js"><link rel="prefetch" href="/assets/js/78.41764819.js"><link rel="prefetch" href="/assets/js/8.1788d36a.js"><link rel="prefetch" href="/assets/js/80.4b57cedb.js"><link rel="prefetch" href="/assets/js/81.f9556a24.js"><link rel="prefetch" href="/assets/js/82.f18755ed.js"><link rel="prefetch" href="/assets/js/83.5c9f9489.js"><link rel="prefetch" href="/assets/js/84.5c47e245.js"><link rel="prefetch" href="/assets/js/85.1b40b497.js"><link rel="prefetch" href="/assets/js/86.774be43b.js"><link rel="prefetch" href="/assets/js/87.f2848ddb.js"><link rel="prefetch" href="/assets/js/88.0f0b4fab.js"><link rel="prefetch" href="/assets/js/89.2ae8eea2.js"><link rel="prefetch" href="/assets/js/9.c52fca3a.js"><link rel="prefetch" href="/assets/js/90.3e798661.js"><link rel="prefetch" href="/assets/js/91.329942cb.js"><link rel="prefetch" href="/assets/js/92.f6b412ea.js"><link rel="prefetch" href="/assets/js/93.1bad8fe5.js"><link rel="prefetch" href="/assets/js/94.8ab22d8b.js"><link rel="prefetch" href="/assets/js/95.af7ae9bb.js"><link rel="prefetch" href="/assets/js/96.b84c5880.js"><link rel="prefetch" href="/assets/js/97.8584121b.js"><link rel="prefetch" href="/assets/js/98.3d7a6b2a.js"><link rel="prefetch" href="/assets/js/99.da28339e.js">
    <link rel="stylesheet" href="/assets/css/0.styles.5675a7d7.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/assets/img/开心果.png" alt="杏壳儿" class="logo"> <span class="site-name can-hide">杏壳儿</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="软件测试体系" class="dropdown-title"><span class="title">软件测试体系</span> <span class="arrow down"></span></button> <button type="button" aria-label="软件测试体系" class="mobile-dropdown-title"><span class="title">软件测试体系</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/qa/basics/" class="nav-link">
  测试基础
</a></li><li class="dropdown-item"><!----> <a href="/qa/automatic/" class="nav-link">
  自动测试
</a></li><li class="dropdown-item"><!----> <a href="/qa/performance/" class="nav-link">
  性能测试
</a></li><li class="dropdown-item"><!----> <a href="/qa/special/" class="nav-link">
  专项测试
</a></li><li class="dropdown-item"><!----> <a href="/qa/security/" class="nav-link">
  安全测试
</a></li><li class="dropdown-item"><!----> <a href="/qa/tool/" class="nav-link">
  测试工具
</a></li><li class="dropdown-item"><!----> <a href="/qa/framework/" class="nav-link">
  测试框架
</a></li><li class="dropdown-item"><!----> <a href="/qa/view/" class="nav-link">
  测试思考
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="计算机基础" class="dropdown-title"><span class="title">计算机基础</span> <span class="arrow down"></span></button> <button type="button" aria-label="计算机基础" class="mobile-dropdown-title"><span class="title">计算机基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/basic/network/" class="nav-link">
  计算机网络
</a></li><li class="dropdown-item"><!----> <a href="/basic/os/" class="nav-link">
  操作系统
</a></li><li class="dropdown-item"><!----> <a href="/basic/linux/" class="nav-link">
  Linux
</a></li><li class="dropdown-item"><!----> <a href="/basic/algorithms/" class="nav-link">
  数据结构与算法
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Language Menu" class="dropdown-title"><span class="title">前端游乐场</span> <span class="arrow down"></span></button> <button type="button" aria-label="Language Menu" class="mobile-dropdown-title"><span class="title">前端游乐场</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/frontend/vue/" class="nav-link">
  VUE
</a></li><li class="dropdown-item"><!----> <a href="/frontend/css/" class="nav-link">
  CSS
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="后端训练场" class="dropdown-title"><span class="title">后端训练场</span> <span class="arrow down"></span></button> <button type="button" aria-label="后端训练场" class="mobile-dropdown-title"><span class="title">后端训练场</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          编程语言
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/backend/python/" class="nav-link">
  Python
</a></li><li class="dropdown-subitem"><a href="/backend/java/" class="nav-link">
  Java
</a></li></ul></li><li class="dropdown-item"><h4>
          WEB框架
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/backend/django/" class="nav-link">
  Django
</a></li><li class="dropdown-subitem"><a href="/backend/drf/" class="nav-link">
  Django REST Framework
</a></li></ul></li><li class="dropdown-item"><h4>
          中间件
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/backend/celery/" class="nav-link">
  Celery
</a></li></ul></li><li class="dropdown-item"><h4>
          数据库
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/backend/mysql/" class="nav-link">
  Mysql
</a></li><li class="dropdown-subitem"><a href="/backend/redis/" class="nav-link">
  Redis
</a></li><li class="dropdown-subitem"><a href="/backend/mongodb/" class="nav-link">
  Mongodb
</a></li><li class="dropdown-subitem"><a href="/backend/elasticsearch/" class="nav-link">
  Elasticsearch
</a></li></ul></li><li class="dropdown-item"><h4>
          部署
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/backend/uwsgi/" class="nav-link">
  Uwsgi
</a></li><li class="dropdown-subitem"><a href="/backend/gunicorn/" class="nav-link">
  Gunicorn
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="DevOps" class="dropdown-title"><span class="title">DevOps</span> <span class="arrow down"></span></button> <button type="button" aria-label="DevOps" class="mobile-dropdown-title"><span class="title">DevOps</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/devops/docker/" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  Docker
</a></li><li class="dropdown-item"><!----> <a href="/devops/git/" class="nav-link">
  Git
</a></li><li class="dropdown-item"><!----> <a href="/devops/notes/" class="nav-link">
  DevOps笔记
</a></li><li class="dropdown-item"><!----> <a href="/devops/efficiency/" class="nav-link">
  研发效能
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="软能力" class="dropdown-title"><span class="title">软能力</span> <span class="arrow down"></span></button> <button type="button" aria-label="软能力" class="mobile-dropdown-title"><span class="title">软能力</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/softskills/mind/" class="nav-link">
  思考模型
</a></li><li class="dropdown-item"><!----> <a href="/softskills/communication/" class="nav-link">
  沟通能力
</a></li></ul></div></div><div class="nav-item"><a href="/opensource/" class="nav-link">
  开源前哨
</a></div><div class="nav-item"><a href="/memo/" class="nav-link">
  备忘录
</a></div><div class="nav-item"><a href="/interview/" class="nav-link">
  面试指南
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="软件测试体系" class="dropdown-title"><span class="title">软件测试体系</span> <span class="arrow down"></span></button> <button type="button" aria-label="软件测试体系" class="mobile-dropdown-title"><span class="title">软件测试体系</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/qa/basics/" class="nav-link">
  测试基础
</a></li><li class="dropdown-item"><!----> <a href="/qa/automatic/" class="nav-link">
  自动测试
</a></li><li class="dropdown-item"><!----> <a href="/qa/performance/" class="nav-link">
  性能测试
</a></li><li class="dropdown-item"><!----> <a href="/qa/special/" class="nav-link">
  专项测试
</a></li><li class="dropdown-item"><!----> <a href="/qa/security/" class="nav-link">
  安全测试
</a></li><li class="dropdown-item"><!----> <a href="/qa/tool/" class="nav-link">
  测试工具
</a></li><li class="dropdown-item"><!----> <a href="/qa/framework/" class="nav-link">
  测试框架
</a></li><li class="dropdown-item"><!----> <a href="/qa/view/" class="nav-link">
  测试思考
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="计算机基础" class="dropdown-title"><span class="title">计算机基础</span> <span class="arrow down"></span></button> <button type="button" aria-label="计算机基础" class="mobile-dropdown-title"><span class="title">计算机基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/basic/network/" class="nav-link">
  计算机网络
</a></li><li class="dropdown-item"><!----> <a href="/basic/os/" class="nav-link">
  操作系统
</a></li><li class="dropdown-item"><!----> <a href="/basic/linux/" class="nav-link">
  Linux
</a></li><li class="dropdown-item"><!----> <a href="/basic/algorithms/" class="nav-link">
  数据结构与算法
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Language Menu" class="dropdown-title"><span class="title">前端游乐场</span> <span class="arrow down"></span></button> <button type="button" aria-label="Language Menu" class="mobile-dropdown-title"><span class="title">前端游乐场</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/frontend/vue/" class="nav-link">
  VUE
</a></li><li class="dropdown-item"><!----> <a href="/frontend/css/" class="nav-link">
  CSS
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="后端训练场" class="dropdown-title"><span class="title">后端训练场</span> <span class="arrow down"></span></button> <button type="button" aria-label="后端训练场" class="mobile-dropdown-title"><span class="title">后端训练场</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          编程语言
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/backend/python/" class="nav-link">
  Python
</a></li><li class="dropdown-subitem"><a href="/backend/java/" class="nav-link">
  Java
</a></li></ul></li><li class="dropdown-item"><h4>
          WEB框架
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/backend/django/" class="nav-link">
  Django
</a></li><li class="dropdown-subitem"><a href="/backend/drf/" class="nav-link">
  Django REST Framework
</a></li></ul></li><li class="dropdown-item"><h4>
          中间件
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/backend/celery/" class="nav-link">
  Celery
</a></li></ul></li><li class="dropdown-item"><h4>
          数据库
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/backend/mysql/" class="nav-link">
  Mysql
</a></li><li class="dropdown-subitem"><a href="/backend/redis/" class="nav-link">
  Redis
</a></li><li class="dropdown-subitem"><a href="/backend/mongodb/" class="nav-link">
  Mongodb
</a></li><li class="dropdown-subitem"><a href="/backend/elasticsearch/" class="nav-link">
  Elasticsearch
</a></li></ul></li><li class="dropdown-item"><h4>
          部署
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/backend/uwsgi/" class="nav-link">
  Uwsgi
</a></li><li class="dropdown-subitem"><a href="/backend/gunicorn/" class="nav-link">
  Gunicorn
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="DevOps" class="dropdown-title"><span class="title">DevOps</span> <span class="arrow down"></span></button> <button type="button" aria-label="DevOps" class="mobile-dropdown-title"><span class="title">DevOps</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/devops/docker/" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  Docker
</a></li><li class="dropdown-item"><!----> <a href="/devops/git/" class="nav-link">
  Git
</a></li><li class="dropdown-item"><!----> <a href="/devops/notes/" class="nav-link">
  DevOps笔记
</a></li><li class="dropdown-item"><!----> <a href="/devops/efficiency/" class="nav-link">
  研发效能
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="软能力" class="dropdown-title"><span class="title">软能力</span> <span class="arrow down"></span></button> <button type="button" aria-label="软能力" class="mobile-dropdown-title"><span class="title">软能力</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/softskills/mind/" class="nav-link">
  思考模型
</a></li><li class="dropdown-item"><!----> <a href="/softskills/communication/" class="nav-link">
  沟通能力
</a></li></ul></div></div><div class="nav-item"><a href="/opensource/" class="nav-link">
  开源前哨
</a></div><div class="nav-item"><a href="/memo/" class="nav-link">
  备忘录
</a></div><div class="nav-item"><a href="/interview/" class="nav-link">
  面试指南
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>目录</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/devops/docker/" aria-current="page" class="active sidebar-link">Docker基础知识点</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/devops/docker/#容器简介" class="sidebar-link">容器简介</a></li><li class="sidebar-sub-header"><a href="/devops/docker/#什么是-docker" class="sidebar-link">什么是 Docker？</a></li><li class="sidebar-sub-header"><a href="/devops/docker/#安装docker" class="sidebar-link">安装Docker</a></li><li class="sidebar-sub-header"><a href="/devops/docker/#docker镜像相关操作" class="sidebar-link">docker镜像相关操作</a></li><li class="sidebar-sub-header"><a href="/devops/docker/#容器的日常管理" class="sidebar-link">容器的日常管理</a></li><li class="sidebar-sub-header"><a href="/devops/docker/#docker-数据卷的管理" class="sidebar-link">Docker 数据卷的管理</a></li><li class="sidebar-sub-header"><a href="/devops/docker/#dockerfile自动构建docker镜像" class="sidebar-link">Dockerfile自动构建docker镜像</a></li><li class="sidebar-sub-header"><a href="/devops/docker/#docker中的镜像分层" class="sidebar-link">Docker中的镜像分层</a></li><li class="sidebar-sub-header"><a href="/devops/docker/#使用docker运行zabbix-server" class="sidebar-link">使用docker运行zabbix-server</a></li><li class="sidebar-sub-header"><a href="/devops/docker/#docker-仓库-registry" class="sidebar-link">docker 仓库（registry）</a></li><li class="sidebar-sub-header"><a href="/devops/docker/#docker-compose编排工具" class="sidebar-link">docker-compose编排工具</a></li><li class="sidebar-sub-header"><a href="/devops/docker/#重启docker服务-容器全部退出的解决办法" class="sidebar-link">重启docker服务，容器全部退出的解决办法</a></li><li class="sidebar-sub-header"><a href="/devops/docker/#docker网络类型" class="sidebar-link">Docker网络类型</a></li><li class="sidebar-sub-header"><a href="/devops/docker/#docker企业级镜像仓库harbor" class="sidebar-link">docker企业级镜像仓库harbor</a></li><li class="sidebar-sub-header"><a href="/devops/docker/#使用容器的建议" class="sidebar-link">使用容器的建议</a></li><li class="sidebar-sub-header"><a href="/devops/docker/#关于docker容器的监控" class="sidebar-link">关于Docker容器的监控</a></li></ul></li><li><a href="/devops/docker/k8s基础.html" class="sidebar-link">k8s基础</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><p></p><div class="table-of-contents"><ul><li><a href="#容器简介">容器简介</a></li><li><a href="#什么是-docker">什么是 Docker？</a></li><li><a href="#安装docker">安装Docker</a></li><li><a href="#docker镜像相关操作">docker镜像相关操作</a></li><li><a href="#容器的日常管理">容器的日常管理</a></li><li><a href="#docker-数据卷的管理">Docker 数据卷的管理</a></li><li><a href="#dockerfile自动构建docker镜像">Dockerfile自动构建docker镜像</a></li><li><a href="#docker中的镜像分层">Docker中的镜像分层</a></li><li><a href="#使用docker运行zabbix-server">使用docker运行zabbix-server</a></li><li><a href="#docker-仓库-registry">docker 仓库（registry）</a></li><li><a href="#docker-compose编排工具">docker-compose编排工具</a></li><li><a href="#重启docker服务-容器全部退出的解决办法">重启docker服务，容器全部退出的解决办法</a></li><li><a href="#docker网络类型">Docker网络类型</a></li><li><a href="#docker企业级镜像仓库harbor">docker企业级镜像仓库harbor</a></li><li><a href="#使用容器的建议">使用容器的建议</a></li><li><a href="#关于docker容器的监控">关于Docker容器的监控</a></li></ul></div><p></p> <h2 id="容器简介"><a href="#容器简介" class="header-anchor">#</a> 容器简介</h2> <ol><li>什么是 Linux 容器
<ul><li>Linux容器是与系统其他部分隔离开的一系列进程，从另一个镜像运行，并由该镜像提供支持进程所需的全部文件。容器提供的镜像包含了应用的所有依赖项，因而在从开发到测试再到生产的整个过程中，它都具有可移植性和一致性。</li> <li>更加详细地来说，请您假定您在开发一个应用。您使用的是一台笔记本电脑，而且您的开发环境具有特定的配置。其他开发人员身处的环境配置可能稍有不同。您正在开发的应用依赖于您当前的配置，还要依赖于某些特定文件。与此同时，您的企业还拥有标准化的测试和生产环境，且具有自身的配置和一系列支持文件。您希望尽可能多在本地模拟这些环境，而不产生重新创建服务器环境的开销。</li> <li>因此，您要如何确保应用能够在这些环境中运行和通过质量检测，并且在部署过程中不出现令人头疼的问题，也无需重新编写代码和进行故障修复？答案就是使用容器。容器可以确保您的应用拥有必需的配置和文件，使得这些应用能够在从开发到测试、再到生产的整个流程中顺利运行，而不出现任何不良问题。这样可以避免危机，做到皆大欢喜。</li> <li>虽然这只是简化的示例，但在需要很高的可移植性、可配置性和隔离的情况下，我们可以利用 Linux 容器通过很多方式解决难题。无论基础架构是在企业内部还是在云端，或者混合使用两者，容器都能满足您的需求。</li></ul></li> <li>容器不就是虚拟化吗
<ul><li>是，但也不竟然。我们用一种简单方式来思考一下：</li> <li>虚拟化使得许多操作系统可同时在单个系统上运行。</li> <li>容器则可共享同一个操作系统内核，将应用进程与系统其他部分隔离开。</li> <li>图-普通虚拟化技术和Docker的对比</li> <li>这意味着什么？首先，让多个操作系统在单个虚拟机监控程序上运行以实现虚拟化，并不能达成和使用容器同等的轻量级效果。事实上，在仅拥有容量有限的有限资源时，您需要能够可以进行密集部署的轻量级应用。Linux 容器可从单个操作系统运行，在所有容器中共享该操作系统，因此应用和服务能够保持轻量级，并行快速运行。</li></ul></li> <li>容器发展简史
<ul><li>我们现在称为容器技术的概念最初出现在 2000 年，当时称为 FreeBSD jail，这种技术可将 FreeBSD 系统分区为多个子系统（也称为 Jail）。Jail 是作为安全环境而开发的，系统管理员可与企业内部或外部的多个用户共享这些 Jail。</li> <li>Jail 的目的是让进程在经过修改的 chroot 环境中创建，而不会脱离和影响整个系统 — 在 chroot 环境中，对文件系统、网络和用户的访问都实现了虚拟化。尽管 Jail 在实施方面存在局限性，但最终人们找到了脱离这种隔离环境的方法。</li> <li>但这个概念非常有吸引力。</li> <li>2001 年，通过 Jacques Gélinas 的 VServer 项目，隔离环境的实施进入了 Linux 领域。正如 Gélinas 所说，这项工作的目的是“在高度独立且安全的单一环境中运行多个通用 Linux 服务器 [sic]。” 在完成了这项针对 Linux 中多个受控制用户空间的基础性工作后，Linux 容器开始逐渐成形并最终发展成了现在的模样。</li></ul></li></ol> <h2 id="什么是-docker"><a href="#什么是-docker" class="header-anchor">#</a> 什么是 Docker？</h2> <ul><li>“Docker” 一词指代多种事物，包括开源社区项目、开源项目使用的工具、主导支持此类项目的公司 Docker Inc. 以及该公司官方支持的工具。技术产品和公司使用同一名称，的确让人有点困惑。</li> <li>IT 软件中所说的 “Docker” ，是指容器化技术，用于支持创建和使用 Linux 容器。</li> <li>开源 Docker 社区致力于改进这类技术，并免费提供给所有用户，使之获益。</li> <li>Docker Inc. 公司凭借 Docker 社区产品起家，它主要负责提升社区版本的安全性，并将改进后的版本与更广泛的技术社区分享。此外，它还专门对这些技术产品进行完善和安全固化，以服务于企业客户。</li> <li>借助 Docker ，您可将容器当做重量轻、模块化的虚拟机使用。同时，您还将获得高度的灵活性，从而实现对容器的高效创建、部署及复制，并能将其从一个环境顺利迁移至另一个环境。</li></ul> <ol><li>Docker 如何工作？
<ul><li>Docker 技术使用 Linux 内核和内核功能（例如 Cgroups 和 namespaces）来分隔进程，以便各进程相互独立运行。这种独立性正是采用容器的目的所在；它可以独立运行多种进程、多个应用程序，更加充分地发挥基础设施的作用，同时保持各个独立系统的安全性。</li> <li>容器工具（包括 Docker）可提供基于镜像的部署模式。这使得它能够轻松跨多种环境，与其依赖程序共享应用或服务组。Docker 还可在这一容器环境中自动部署应用程序（或者合并多种流程，以构建单个应用程序）。</li> <li>此外，由于这些工具基于 Linux 容器构建，使得 Docker 既易于使用，又别具一格 —— 它可为用户提供前所未有的高度应用程访问权限、快速部署以及版本控制和分发能力。</li></ul></li> <li>Docker 技术是否与传统的 Linux 容器相同？
<ul><li>否。Docker 技术最初是基于 LXC 技术构建（大多数人都会将这一技术与“传统的” Linux 容器联系在一起），但后来它逐渐摆脱了对这种技术的依赖。</li> <li>就轻量级虚拟化这一功能来看，LXC 非常有用，但它无法提供出色的开发人员或用户体验。除了运行容器之外，Docker 技术还具备其他多项功能，包括简化用于构建容器、传输镜像以及控制镜像版本的流程。</li> <li>传统的 Linux 容器使用 init 系统来管理多种进程。这意味着，所有应用程序都作为一个整体运行。与此相反，Docker 技术鼓励应用程序各自独立运行其进程，并提供相应工具以实现这一功能。这种精细化运作模式自有其优势。</li></ul></li> <li>docker的目标
<ul><li>docker的主要目标是&quot;Build,Ship and Run any App,Angwhere&quot;,构建，运输，处处运行</li> <li>构建：做一个docker镜像</li> <li>运输：docker pull</li> <li>运行：启动一个容器</li> <li>每一个容器，他都有自己的文件系统rootfs.</li></ul></li></ol> <h2 id="安装docker"><a href="#安装docker" class="header-anchor">#</a> 安装Docker</h2> <div class="language- line-numbers-mode"><pre class="language-text"><code># 需要两台节点进行安装
[root@docker01 ~]# cat /etc/redhat-release 
CentOS Linux release 7.2.1511 (Core) 
[root@docker01 ~]# uname  -r 
3.10.0-327.el7.x86_64
[root@docker01 ~]# hostname -I
10.0.0.100172.16.1.100
[root@docker02 ~]# hostname -I
10.0.0.101172.16.1.101
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><ul><li>在两个节点上都进行操作</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>wget -O /etc/yum.repos.d/docker-ce.repo https://mirrors.ustc.edu.cn/docker-ce/linux/centos/docker-ce.repo
sed -i 's#download.docker.com#mirrors.ustc.edu.cn/docker-ce#g' /etc/yum.repos.d/docker-ce.repo
yum install docker-ce -y
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ul><li>修改在docker01配置：</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code># 修改启动文件，监听远程端口
vim /usr/lib/systemd/system/docker.service
ExecStart\=/usr/bin/dockerd -H unix:///var/run/docker.sock -H tcp://10.0.0.100:2375 
systemctl daemon\-reload
systemctl enable docker.service 
systemctl restart docker.service 
# ps -ef检查进行，是否启动
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><ul><li>在docker02测试</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>[root@docker02 ~]# docker -H 10.0.0.100 info
Containers: 0
 Running: 0
 Paused: 0
 Stopped: 0
Images: 0
Server Version: 17.12.0-ce
Storage Driver: devicemapper
···
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><ol><li>Docker基础命令操作
<ul><li>查看docker相关信息</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>[root@docker01 ~]#  docker version  
Client:
 Version:    17.12.0-ce
 API version:    1.35
 Go version:    go1.9.2
 Git commit:    c97c6d6
 Built:    Wed Dec 2720:10:142017
 OS/Arch:    linux/amd64
Server:
 Engine:
  Version:    17.12.0-ce
  API version:    1.35 (minimum version 1.12)
  Go version:    go1.9.2
  Git commit:    c97c6d6
  Built:    Wed Dec 2720:12:462017
  OS/Arch:    linux/amd64
  Experimental:    false
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><ul><li>配置docker镜像加速</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>vi /etc/docker/daemon.json
{ &quot;registry-mirrors&quot;: [&quot;https://registry.docker-cn.com&quot;]
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></li> <li>启动第一个容器<div class="language- line-numbers-mode"><pre class="language-text"><code>[root@docker01 ~]# docker run -d -p 80:80 nginx
Unable to find image 'nginx:latest' locally
latest: Pulling from library/nginx
e7bb522d92ff: Pull complete 
6edc05228666: Pull complete 
cd866a17e81f: Pull complete 
Digest: sha256:285b49d42c703fdf257d1e2422765c4ba9d3e37768d6ea83d7fe2043dad6e63d
Status: Downloaded newer image for nginx:latest
8d8f81da12b5c10af6ba1a5d07f4abc041cb95b01f3d632c3d638922800b0b4d 
# 容器启动后，在浏览器进行访问测试
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div></li> <li>Docker镜像生命周期
<ul><li>backlog!</li></ul></li></ol> <h2 id="docker镜像相关操作"><a href="#docker镜像相关操作" class="header-anchor">#</a> docker镜像相关操作</h2> <ol><li>搜索官方仓库镜像
<ul><li>docker search centos</li></ul></li> <li>获取镜像
<ul><li>docker pull centos</li> <li>查看当前主机镜像列表</li> <li>docker image list</li> <li>拉第三方镜像方法</li> <li>docker pull index.tenxcloud.com/tenxcloud/httpd</li></ul></li> <li>导出镜像
<ul><li>docker image save centos &gt; docker-centos.tar.gz</li></ul></li> <li>删除镜像
<ul><li>docker image rm centos:latest</li></ul></li> <li>导入镜像
<ul><li>docker image load -i docker-centos.tar.gz</li></ul></li> <li>查看镜像的详细信息
<ul><li>docker image inspect centos</li></ul></li></ol> <h2 id="容器的日常管理"><a href="#容器的日常管理" class="header-anchor">#</a> 容器的日常管理</h2> <ol><li>容器的起/停
<ul><li>最简单的运行一个容器</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>docker run nginx
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li>创建容器，两步走（不常用）</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>docker create centos:latest  /bin/bash
docker start stupefied_nobel
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ul><li>快速启动容器方法</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>docker run  centos:latest  /usr/bin/sleep 20
#容器内的第一个进程必须一直处于运行的状态，否则这个容器，就会处于退出状态！
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ul><li>查看正在运行的容器</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>docker container ls
docker ps 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ul><li>查看你容器详细信息/ip</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>docker container  inspect  容器名称/id
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li>查看你所有容器（包括未运行的)</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>docker ps -a
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li>停止容器</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>docker stop 容器名称/id 
docker container  kill  容器名称/id
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li> <li>进入容器方法
<ul><li>启动时进去方法</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>docker run -it #参数：-it 可交互终端
docker run -it nginx:latest  /bin/bash
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ul><li>退出/离开容器</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>ctrl+p &amp; ctrl+q
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li>启动后进入容器的方法</li> <li>启动一个docker</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code> docker run -it centos:latest
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language- line-numbers-mode"><pre class="language-text"><code>ps -ef 
UID       PID       PPID  C STIME TTY          TIME CMD
root     10015:47   pts/000:00:00 /bin/bash
root     131015:47  pts/000:00:00 ps -ef
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ul><li>attach进入容器，使用pts/0 ，会让所用通过此方法进如放入用户看到同样的操作。</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>docker attach 1bf0f43c4d2f
[root@1bf0f43c4d2f /]# ps -ef 
UID         PID   PPID  C STIME TTY          TIME CMD
root          10015:47 pts/000:00:00 /bin/bash
root         141015:49 pts/000:00:00 ps -ef
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><ul><li>自命名启动一个容器 --name</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>111
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li>exec 进入容器方法（推荐使用）</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>docker exec -it clsn1  /bin/bash
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li>删除所有容器<div class="language- line-numbers-mode"><pre class="language-text"><code>docker rm -f  `docker ps -a -q`
# -f 强制删除
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li> <li>启动时进行端口映射<div class="language- line-numbers-mode"><pre class="language-text"><code>-p参数端口映射
docker run -d -p 8888:80  nginx:latest 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ul><li>不同指定映射方法参数说明</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>-p hostPort:containerPort    端口映射  -p 8080:80
-p ip:hostPort:containerPort 配置监听地址 -p 10.0.0.100:8080:80
-p ip::containerPort        随机分配端口 -p 10.0.0.100::80
-p hostPort:containerPort:udp 指定协议 -p 8080:80:tcp
-p 81:80 –p 443:443    指定多个
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><ul><li>随机映射</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>docker run -P （大P）# 需要镜像支持
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li></ol> <h2 id="docker-数据卷的管理"><a href="#docker-数据卷的管理" class="header-anchor">#</a> Docker 数据卷的管理</h2> <ol><li>挂载时创建卷
<ul><li>挂载卷</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>docker run -d -p 80:80 -v /data:/usr/share/nginx/html nginx:latest
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li>容器内站点目录: /usr/share/nginx/html</li> <li>在宿主机写入数据，查看</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>echo &quot;http://www.nmtui.com&quot; &gt;/data/index.html
curl 10.0.0.100
http://www.nmtui.com
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ul><li>设置共享卷，使用同一个卷启动一个新的容器</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>docker run -d -p 8080:80 -v /data:/usr/share/nginx/html nginx:latest
curl 10.0.0.100:8080
http://www.nmtui.com
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ul><li>查看卷列表</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>docker volume ls
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li>创建卷后挂载
<ul><li>创建一个卷</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>docker volume create
docker volume ls 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ul><li>指定卷名</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>111
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li>查看卷路径</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>docker volume inspect clsn 
[
	{
		&quot;CreatedAt&quot;: &quot;2018-02-01T00:39:25+08:00&quot;,
		&quot;Driver&quot;: &quot;local&quot;,
		&quot;Labels&quot;: {},
		&quot;Mountpoint&quot;: &quot;/var/lib/docker/volumes/clsn/_data&quot;,
		&quot;Name&quot;: &quot;clsn&quot;,
		&quot;Options&quot;: {},
		&quot;Scope&quot;: &quot;local&quot;
	}
]
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><ul><li>使用卷创建</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>docker run -d -p 9000:80 -v clsn:/usr/share/nginx/html nginx:latest 
# 宿主机测试
echo 'blog.nmtui.com' &gt;/var/lib/docker/volumes/clsn/_data/index.html
curl 10.0.0.100:9000
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ul><li>设置卷</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>docker run  -d  -P  --volumes-from 079786c1e297 nginx:latest
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li>手动将容器保存为镜像
<ul><li>本次是基于docker官方centos 6.8 镜像创建</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>docker pull  centos:6.8
docker run -it -p 1022:22 centos:6.8  /bin/bash
# 在容器种安装sshd服务，并修改系统密码
yum install  openssh-server -y 
echo &quot;root:123456&quot; |chpasswd
/etc/init.d/sshd start
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><ul><li>将容器提交为镜像
docker commit brave_mcclintock  centos6-ssh</li> <li>使用新的镜像启动容器
docker run -d  -p 1122:22  centos6-ssh:latest  /usr/sbin/sshd -D</li> <li>在容器安装httpd服务</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>yum install httpd -y
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li>编写启动脚本脚本</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>cat init.sh 
	#!/bin/bash 
	/etc/init.d/httpd start 
	/usr/sbin/sshd -D
chmod +x init.sh 
# 注意执行权限
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><ul><li>再次提交为新的镜像</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>docker commit  5b8161fda2a9 centos6-httpd
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li>启动镜像，做好端口映射。并在浏览器中测试访问</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>docker run -d -p 1222:22 -p 80:80  centos6-httpd /init.sh 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li></ol> <h2 id="dockerfile自动构建docker镜像"><a href="#dockerfile自动构建docker镜像" class="header-anchor">#</a> Dockerfile自动构建docker镜像</h2> <ul><li>官方构建dockerffile文件参考:https://github.com/CentOS/CentOS-Dockerfiles</li></ul> <ol><li>Dockerfile指令集
<ul><li>dockerfile主要组成部分：
<ul><li>基础镜像信息 FROM centos:6.8</li> <li>制作镜像操作指令RUN yum insatll openssh-server -y</li> <li>容器启动时执行指令 CMD [&quot;/bin/bash&quot;]</li></ul></li> <li>dockerfile常用指令：
<ul><li>FROM 这个镜像的妈妈是谁？（指定基础镜像）</li> <li>MAINTAINER 告诉别人，谁负责养它？（指定维护者信息，可以没有）</li> <li>RUN 你想让它干啥（在命令前面加上RUN即可）</li> <li>ADD 给它点创业资金（COPY文件，会自动解压）</li> <li>WORKDIR 我是cd,今天刚化了妆（设置当前工作目录）</li> <li>VOLUME 给它一个存放行李的地方（设置卷，挂载主机目录）</li> <li>EXPOSE 它要打开的门是啥（指定对外的端口）</li> <li>CMD 奔跑吧，兄弟！（指定容器启动后的要干的事情）</li></ul></li> <li>dockerfile其他指令：
<ul><li>COPY 复制文件</li> <li>ENV  环境变量</li> <li>ENTRYPOINT  容器启动后执行的命令</li></ul></li></ul></li> <li>创建一个Dockerfile<div class="language- line-numbers-mode"><pre class="language-text"><code># 创建目录
[root@docker01 base]# cd /opt/base
# 创建Dcokerfile文件，注意大小写
[root@docker01 base]# vim Dockerfile
FROM centos:6.8
RUN yum install openssh-server -y 
RUN echo &quot;root:123456&quot; |chpasswd
RUN /etc/init.d/sshd start 
CMD [&quot;/usr/sbin/sshd&quot;,&quot;-D&quot;]
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><ul><li>构建docker镜像</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>docker image build  -t centos6.8-ssh . 
-t 为镜像标签打标签  . 表示当前路径
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ul><li>使用自构建的镜像启动</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>docker run  -d -p 2022:22 centos6.8-ssh-b 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li>使用Dcokerfile安装kodexplorer
<ul><li>Dockerfile文件内容</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>FROM centos:6.8
RUN yum install wget unzip php php-gd php-mbstring -y &amp;&amp; yum clean all
# 设置工作目录，之后的操作都在这个目录中
WORKDIR /var/www/html/
RUN wget -c http://static.kodcloud.com/update/download/kodexplorer4.25.zip
RUN unzip kodexplorer4.25.zip &amp;&amp; rm -f kodexplorer4.25.zip
RUN chown -R apache.apache .
CMD [&quot;/usr/sbin/apachectl&quot;,&quot;-D&quot;,&quot;FOREGROUND&quot;]
更多的Dockerfile可以参考官方方法。
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div></li></ol> <h2 id="docker中的镜像分层"><a href="#docker中的镜像分层" class="header-anchor">#</a> Docker中的镜像分层</h2> <ul><li>参考文档：http://www.maiziedu.com/wiki/cloud/dockerimage</li> <li>Docker 支持通过扩展现有镜像，创建新的镜像。实际上，Docker Hub 中 99% 的镜像都是通过在 base 镜像中安装和配置需要的软件构建出来的。</li> <li>新镜像是从 base 镜像一层一层叠加生成的。每安装一个软件，就在现有镜像的基础上增加一层。</li></ul> <ol><li>Docker 镜像为什么分层
<ul><li>镜像分层最大的一个好处就是共享资源。</li> <li>比如说有多个镜像都从相同的 base 镜像构建而来，那么 Docker Host 只需在磁盘上保存一份 base 镜像；同时内存中也只需加载一份 base 镜像，就可以为所有容器服务了。而且镜像的每一层都可以被共享。</li> <li>如果多个容器共享一份基础镜像，当某个容器修改了基础镜像的内容，比如 /etc 下的文件，这时其他容器的 /etc 是不会被修改的，修改只会被限制在单个容器内。这就是容器 Copy-on-Write 特性。</li></ul></li> <li>可写的容器层
<ul><li>当容器启动时，一个新的可写层被加载到镜像的顶部。这一层通常被称作“容器层”，“容器层”之下的都叫“镜像层”。</li> <li>所有对容器的改动 - 无论添加、删除、还是修改文件都只会发生在容器层中。只有容器层是可写的，容器层下面的所有镜像层都是只读的。</li></ul></li> <li>容器层的细节说明
<ul><li>镜像层数量可能会很多，所有镜像层会联合在一起组成一个统一的文件系统。如果不同层中有一个相同路径的文件，比如 /a，上层的 /a 会覆盖下层的 /a，也就是说用户只能访问到上层中的文件 /a。在容器层中，用户看到的是一个叠加之后的文件系统。</li> <li>文件操作说明
<ul><li>添加文件：在容器中创建文件时，新文件被添加到容器层中。</li> <li>读取文件：在容器中读取某个文件时，Docker 会从上往下依次在各镜像层中查找此文件。一旦找到，立即将其复制到容器层，然后打开并读入内存。</li> <li>修改文件：在容器中修改已存在的文件时，Docker 会从上往下依次在各镜像层中查找此文件。一旦找到，立即将其复制到容器层，然后修改之。</li> <li>删除文件：在容器中删除文件时，Docker 也是从上往下依次在镜像层中查找此文件。找到后，会在容器层中记录下此删除操作。（只是记录删除操作）</li> <li>只有当需要修改时才复制一份数据，这种特性被称作 Copy-on-Write。可见，容器层保存的是镜像变化的部分，不会对镜像本身进行任何修改。</li> <li>这样就解释了我们前面提出的问题：容器层记录对镜像的修改，所有镜像层都是只读的，不会被容器修改，所以镜像可以被多个容器共享。</li></ul></li></ul></li></ol> <h2 id="使用docker运行zabbix-server"><a href="#使用docker运行zabbix-server" class="header-anchor">#</a> 使用docker运行zabbix-server</h2> <ol><li>容器间的互联
<ul><li>在运行zabbix之前务必要了解容器间互联的方法</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code># 创建一个nginx容器
docker run -d -p 80:80 nginx
# 创建容器，做link，并进入容器中
docker run -it --link quirky_brown:web01 centos-ssh /bin/bash
# 在容器中访问nginx容器可以ping通
ping web01
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><ul><li>命令执行过程</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code># 启动apache容器
[root@docker01 ~]# docker run -d httpd:2.4  
3f1f7fc554720424327286bd2b04aeab1b084a3fb011a785b0deab6a34e56955
^[[A[root@docker01 docker ps -a
CONTAINER ID        IMAGE               COMMAND              CREATED             STATUS              PORTS               NAMES
3f1f7fc55472        httpd:2.4&quot;httpd-foreground&quot;6 seconds ago       Up 5 seconds        80/tcp              determined_clarke
# 拉取一个busybox 镜像
[root@docker01 ~]# docker pull busybox 
# 启动容器
[root@docker01 ~]# docker run -it  --link determined_clarke:web busybox:latest   /bin/sh 
/ # 
# 使用新的容器访问最初的web容器
/ # ping web 
PING web (172.17.0.2): 56 data bytes
64 bytes from 172.17.0.2: seq=0 ttl=64 time=0.058 ms
^C
--- web ping statistics ---
1 packets transmitted, 1 packets received, 0% packet loss
round-trip min/avg/max = 0.058/0.058/0.058 ms
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div></li> <li>启动zabbix容器
<ul><li>启动一个mysql的容器</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>docker run --name mysql-server -t \
	  -e MYSQL_DATABASE=&quot;zabbix&quot; \
	  -e MYSQL_USER=&quot;zabbix&quot; \
	  -e MYSQL_PASSWORD=&quot;zabbix_pwd&quot; \
	  -e MYSQL_ROOT_PASSWORD=&quot;root_pwd&quot; \
	  -d mysql:5.7 \
	  --character-set-server=utf8 --collation-server=utf8_bin
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><ul><li>启动java-gateway容器监控java服务</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>docker run --name zabbix-java-gateway -t \
      -d zabbix/zabbix-java-gateway:latest
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ul><li>启动zabbix-mysql容器使用link连接mysql与java-gateway。</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>docker run --name zabbix-server-mysql -t \
      -e DB_SERVER_HOST=&quot;mysql-server&quot; \
      -e MYSQL_DATABASE=&quot;zabbix&quot; \
      -e MYSQL_USER=&quot;zabbix&quot; \
      -e MYSQL_PASSWORD=&quot;zabbix_pwd&quot; \
      -e MYSQL_ROOT_PASSWORD=&quot;root_pwd&quot; \
      -e ZBX_JAVAGATEWAY=&quot;zabbix-java-gateway&quot; \
      --link mysql-server:mysql \
      --link zabbix-java-gateway:zabbix-java-gateway \
      -p 10051:10051 \
      -d zabbix/zabbix-server-mysql:latest
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><ul><li>启动zabbix web显示，使用link连接zabbix-mysql与mysql。</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>docker run --name zabbix-web-nginx-mysql -t \
      -e DB_SERVER_HOST=&quot;mysql-server&quot; \
      -e MYSQL_DATABASE=&quot;zabbix&quot; \
      -e MYSQL_USER=&quot;zabbix&quot; \
      -e MYSQL_PASSWORD=&quot;zabbix_pwd&quot; \
      -e MYSQL_ROOT_PASSWORD=&quot;root_pwd&quot; \
      --link mysql-server:mysql \
      --link zabbix-server-mysql:zabbix-server \
      -p 80:80 \
      -d zabbix/zabbix-web-nginx-mysql:latest
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div></li> <li>关于zabbix API
<ul><li>关于zabbix API可以参考官方文档：https://www.zabbix.com/documentation/3.4/zh/manual/api</li> <li>获取token方法</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code># 获取token
[root@docker02 ~]# curl -s -X POST -H 'Content-Type:application/json' -d '
{
&quot;jsonrpc&quot;: &quot;2.0&quot;,
&quot;method&quot;: &quot;user.login&quot;,
&quot;params&quot;: {
&quot;user&quot;: &quot;Admin&quot;,
&quot;password&quot;: &quot;zabbix&quot;
},
&quot;id&quot;: 1
}' http://10.0.0.100/api_jsonrpc.php
{&quot;jsonrpc&quot;:&quot;2.0&quot;,&quot;result&quot;:&quot;d3be707f9e866ec5d0d1c242292cbebd&quot;,&quot;id&quot;:1}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div></li></ol> <h2 id="docker-仓库-registry"><a href="#docker-仓库-registry" class="header-anchor">#</a> docker 仓库（registry）</h2> <ol><li>创建一个普通仓库
<ul><li>新建仓库</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>docker run -d -p 5000:5000 --restart=always --name registry -v /opt/myregistry:/var/lib/registry  registry
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li>修改配置文件，使之支持http</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>cat  /etc/docker/daemon.json 
{
  &quot;registry-mirrors&quot;: [&quot;https://registry.docker-cn.com&quot;],
  &quot;insecure-registries&quot;: [&quot;10.0.0.100:5000&quot;]
}
重启docker让修改生效
systemctl restart  docker.service
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><ul><li>修改镜像标签</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>docker tag  busybox:latest  10.0.0.100:5000/clsn/busybox:1.0
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li>将新打标签的镜像上传镜像到仓库</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>docker push   10.0.0.100:5000/clsn/busybox
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li>带basic认证的仓库
<ul><li>安装加密工具</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>yum install httpd-tools  -y
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li>设置认证密码</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>mkdir /opt/registry-var/auth/ -p
htpasswd \-Bbn clsn 123456  &gt; /opt/registry-var/auth/htpasswd
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ul><li>启动容器，在启动时传入认证参数</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>docker run -d -p 5000:5000 -v /opt/registry-var/auth/:/auth/ -e &quot;REGISTRY_AUTH=htpasswd&quot; -e &quot;REGISTRY_AUTH_HTPASSWD_REALM=Registry Realm&quot; -e REGISTRY_AUTH_HTPASSWD_PATH=/auth/htpasswd registry
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li>使用验证用户测试</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code># 登陆用户
[root@docker01 ~]# docker login 10.0.0.100:5000 
Username: clsn  
Password: 123456
Login Succeeded
# 推送镜像到仓库
[root@docker01 ~]# docker push 10.0.0.100:5000/clsn/busybox 
The push refers to repository [10.0.0.100:5000/clsn/busybox]
4febd3792a1f: Pushed 
1.0: digest: sha256:4cee1979ba0bf7db9fc5d28fb7b798ca69ae95a47c5fecf46327720df4ff352d size: 527
#认证文件的保存位置
[root@docker01 ~]# cat .docker/config.json 
{
	&quot;auths&quot;: {
		&quot;10.0.0.100:5000&quot;: {
			&quot;auth&quot;: &quot;Y2xzbjoxMjM0NTY=&quot;
		},
		&quot;https://index.docker.io/v1/&quot;: {
			&quot;auth&quot;: &quot;Y2xzbjpIenNAMTk5Ng==&quot;
		}
	},
	&quot;HttpHeaders&quot;: {
		&quot;User-Agent&quot;: &quot;Docker-Client/17.12.0-ce (linux)&quot;
	}
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div></li></ol> <h2 id="docker-compose编排工具"><a href="#docker-compose编排工具" class="header-anchor">#</a> docker-compose编排工具</h2> <ol><li>安装docker-compose
<ul><li>安装docker-compose</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code># 下载pip软件
yum install -y python2-pip
# 下载 docker-compose
pip install docker-compose
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ul><li>国内开启pip 下载加速：http://mirrors.aliyun.com/help/pypi</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>mkdir ~/.pip/
cat &gt; ~/.pip/pip.conf &lt;&lt;'EOF'
[global]
index-url = https://mirrors.aliyun.com/pypi/simple/
[install]
trusted-host=mirrors.aliyun.com
EOF
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div></li> <li>编排启动镜像
<ul><li>创建文件目录</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>mkdir /opt/my_wordpress/
cd /opt/my_wordpress/
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ul><li>编写编排文件</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>[root@docker01 my_wordpress]# vim docker-compose.yml
version: '3'
services:
   db:
     image: mysql:5.7
     volumes:
       - /data/db_data:/var/lib/mysql
     restart: always
     environment:
       MYSQL_ROOT_PASSWORD: somewordpress
       MYSQL_DATABASE: wordpress
       MYSQL_USER: wordpress
       MYSQL_PASSWORD: wordpress
   wordpress:
     depends_on:
       - db
     image: wordpress:latest
     volumes:
       - /data/web_data:/var/www/html
     ports: 
       - &quot;8000:80&quot;
     restart: always
     environment:
       WORDPRESS_DB_HOST: db:3306
       WORDPRESS_DB_USER: wordpress
       WORDPRESS_DB_PASSWORD: wordpress
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><ul><li>启动</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>docker-compose up
#启动方法：docker-compose up
#后台启动方法：docker-compose up -d
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ul><li>浏览器上访问http://10.0.0.100:8000</li></ul></li> <li>haproxy代理后端docker容器
<ul><li>修改编排脚本<div class="language- line-numbers-mode"><pre class="language-text"><code>cat docker-compose.yml
version: '3'
services:
   db:
	 image: mysql:5.7
	 volumes:
	   - /data/db_data:/var/lib/mysql
	 restart: always
	 environment:
	   MYSQL_ROOT_PASSWORD: somewordpress
	   MYSQL_DATABASE: wordpress
	   MYSQL_USER: wordpress
	   MYSQL_PASSWORD: wordpress
   wordpress:
	 depends_on:
	   - db
	 image: wordpress:latest
	 volumes:
	   - /data/web_data:/var/www/html
	 ports: 
	   - &quot;80&quot;
	 restart: always
	 environment:
	   WORDPRESS_DB_HOST: db:3306
	   WORDPRESS_DB_USER: wordpress
	   WORDPRESS_DB_PASSWORD: wordpress
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div></li> <li>同时启动两台wordpress<div class="language- line-numbers-mode"><pre class="language-text"><code>docker-compose scale wordpress=2
WARNING: The scale command is deprecated. Use the up command with the --scale flag instead.
Starting mywordpress_wordpress_1 ... done
Creating mywordpress_wordpress_2 ... done
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></li> <li>安装haproxy<div class="language- line-numbers-mode"><pre class="language-text"><code>yum install haproxy -y
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li>修改haproxy配置文件
<ul><li>关于配置文件的详细说明，参考：https://www.cnblogs.com/MacoLee/p/5853413.html</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>[root@docker01 ~]#cp /etc/haproxy/haproxy.cfg{,.bak}
[root@docker01 ~]# vim /etc/haproxy/haproxy.cfg
global
    log127.0.0.1 local2
    chroot      /var/lib/haproxy
    pidfile     /var/run/haproxy.pid
    maxconn     4000
    user        haproxy
    group       haproxy
    daemon
    stats socket /var/lib/haproxy/stats level admin  #支持命令行控制
defaults
    mode                    http
    log                     global
    option                  httplog
    option                  dontlognull
    option http-server-close
    option forwardfor       except 127.0.0.0/8
    option                  redispatch
    retries                 3
    timeout http-request    10s
    timeout queue1m
    timeout connect         10s
    timeout client          1m
    timeout server          1m
    timeout http-keep-alive 10s
    timeout check           10s
    maxconn                 3000
listen stats
    mode http
    bind 0.0.0.0:8888
    stats enable
    stats uri     /haproxy-status 
    stats auth    admin:123456
frontend frontend_www_example_com
    bind 10.0.0.100:8000
    mode http
    option httplog
    log global
    default_backend backend_www_example_com
backend backend_www_example_com
    option forwardfor header X-REAL-IP
    option httpchk HEAD / HTTP/1.0
    balance roundrobin
    server web-node1  10.0.0.100:32768 check inter 2000 rise 30 fall 15
    server web-node2  10.0.0.100:32769 check inter 2000 rise 30 fall 15
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br></div></div></li> <li>启动haproxy<div class="language- line-numbers-mode"><pre class="language-text"><code>systemctl start haproxy
systemctl enable haproxy
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li> <li>使用浏览器访问hapeoxy监听的8000端口可以看到负载的情况</li> <li>使用浏览器访问 http://10.0.0.100:8888/haproxy-status</li></ul></li> <li>安装socat 直接操作socket控制haproxy
<ul><li>安装软件</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>yum install socat.x86\_64 -y
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li>查看帮助</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>echo &quot;help&quot;|socat stdio /var/lib/haproxy/stats
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li>下线后端节点</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>echo &quot;disable server backend_www_example_com/web-node2&quot;|socat stdio /var/lib/haproxy/stats
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li>上线后端节点</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>echo &quot;enable server backend_www_example_com/web-node3&quot;|socat stdio /var/lib/haproxy/stats
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li>编写php测试页，放到/data/web_data下，在浏览器中访问可以查看当前的节点</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>vim check.php
&lt;html&gt;
    &lt;head&gt;
        &lt;title&gt;PHP测试&lt;/title&gt;
    &lt;/head&gt;
    &lt;body&gt;
        &lt;?php  echo '&lt;p&gt;Hello World &lt;/p&gt;'; ?&gt;
        &lt;?php  echo &quot;访问的服务器地址是:&quot;.&quot;&lt;fontcolor=red&gt;&quot;.$_SERVER['SERVER_ADDR'].&quot;&lt;/font&gt;&quot;.&quot;&lt;br&gt;&quot;;
        echo&quot;访问的服务器域名是:&quot;.&quot;&lt;fontcolor=red&gt;&quot;.$_SERVER['SERVER_NAME'].&quot;&lt;/font&gt;&quot;.&quot;&lt;br&gt;&quot;;
        ?&gt;
    &lt;/body&gt;
&lt;/html&gt;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div></li></ol> <h2 id="重启docker服务-容器全部退出的解决办法"><a href="#重启docker服务-容器全部退出的解决办法" class="header-anchor">#</a> 重启docker服务，容器全部退出的解决办法</h2> <ol><li>在启动是指定自动重启<div class="language- line-numbers-mode"><pre class="language-text"><code>docker run  --restart=always
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li>修改docker默认配置文件<div class="language- line-numbers-mode"><pre class="language-text"><code># 添加上下面这行
&quot;live-restore&quot;: true
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ul><li>docker server配置文件/etc/docker/daemon.json参考</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>[root@docker02 ~]# cat  /etc/docker/daemon.json 
{
  &quot;registry-mirrors&quot;: [&quot;https://registry.docker-cn.com&quot;],
  &quot;graph&quot;: &quot;/opt/mydocker&quot;, # 修改数据的存放目录到/opt/mydocker/，原/var/lib/docker/
  &quot;insecure-registries&quot;: [&quot;10.0.0.100:5000&quot;],
  &quot;live-restore&quot;: true
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><ul><li>重启生效，只对在此之后启动的容器生效</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>systemctl restart  docker.service
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li></ol> <h2 id="docker网络类型"><a href="#docker网络类型" class="header-anchor">#</a> Docker网络类型</h2> <ol><li><p>docker的网络类型</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>|None|不为容器配置任何网络功能，没有网络 --net=none|
|Container|与另一个运行中的容器共享Network Namespace，--net=container:containerID|
|Host|与主机共享Network Namespace，--net=host|
|Bridge|Docker设计的NAT网络模型（默认类型）|
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ul><li>Bridge默认docker网络隔离基于网络命名空间，在物理机上创建docker容器时会为每一个docker容器分配网络命名空间，并且把容器IP桥接到物理机的虚拟网桥上。</li></ul></li> <li><p>不为容器配置网络功能</p> <ul><li>此模式下创建容器是不会为容器配置任何网络参数的，如：容器网卡、IP、通信路由等，全部需要自己去配置。</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>docker run  -it --network none busybox:latest  /bin/sh
/ # ip a
1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue 
	link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
	inet 127.0.0.1/8 scope host lo
	   valid_lft forever preferred_lft forever
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div></li> <li><p>与其他容器共享网络配置(Container）</p> <ul><li>此模式和host模式很类似，只是此模式创建容器共享的是其他容器的IP和端口而不是物理机，此模式容器自身是不会配置网络和端口，创建此模式容器进去后，你会发现里边的IP是你所指定的那个容器IP并且端口也是共享的，而且其它还是互相隔离的，如进程等。</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>docker run  -it --network container:mywordpress_db_1  busybox:latest  /bin/sh
/ # ip a
1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue 
	link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
	inet 127.0.0.1/8 scope host lo
	   valid_lft forever preferred_lft forever
105: eth0@if106: &lt;BROADCAST,MULTICAST,UP,LOWER_UP,M-DOWN&gt; mtu 1500 qdisc noqueue 
	link/ether 02:42:ac:12:00:03 brd ff:ff:ff:ff:ff:ff
	inet 172.18.0.3/16 brd 172.18.255.255 scope global eth0
	   valid_lft forever preferred_lft forever
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div></li> <li><p>使用宿主机网络</p> <ul><li>此模式创建的容器没有自己独立的网络命名空间，是和物理机共享一个Network Namespace，并且共享物理机的所有端口与IP，并且这个模式认为是不安全的。</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>docker run  -it --network host  busybox:latest  /bin/sh
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p>查看网络列表</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>docker network list
NETWORK ID          NAME                  DRIVER              SCOPE
b15e8a720d3b        bridge                bridge              local
345d65b4c2a0        host                  host                local
bc5e2a32bb55        mywordpress_default   bridge              local
ebf76eea91bb        none                  null                local
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div></li> <li><p>用PIPEWORK为docker容器配置独立IP</p> <ul><li><p>参考文档：http://blog.csdn.net/design321/article/details/48264825</p></li> <li><p>官方网站：https://github.com/jpetazzo/pipework</p></li> <li><p>宿主环境：centos7.2</p></li> <li><p>安装pipework</p></li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>wget https://github.com/jpetazzo/pipework/archive/master.zip
unzip master.zip 
cp pipework-master/pipework  /usr/local/bin/
chmod +x /usr/local/bin/pipework
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ul><li>配置桥接网卡</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>安装桥接工具
yum install bridge-utils.x86\_64 -y
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ul><li>修改网卡配置，实现桥接</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code># 修改eth0配置，让br0实现桥接
[root@docker01 ~]# cat /etc/sysconfig/network-scripts/ifcfg-eth0 
TYPE=Ethernet
BOOTPROTO=static
NAME=eth0
DEVICE=eth0
ONBOOT=yes
BRIDGE=br0
[root@docker01 ~]# cat /etc/sysconfig/network-scripts/ifcfg-br0 
TYPE=Bridge
BOOTPROTO=static
NAME=br0
DEVICE=br0
ONBOOT=yes
IPADDR=10.0.0.100
NETMASK=255.255.255.0
GATEWAY=10.0.0.254
DNS1=223.5.5.5
# 重启网络
[root@docker01 ~]# /etc/init.d/network restart
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><ul><li>运行一个容器镜像测试：</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>pipework br0 \$\(docker run -d -it -p 6880:80 --name  httpd\_pw httpd\) 10.0.0.220/24\@10.0.0.254
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li>在其他主机上测试端口及连通性</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>[root@docker01 ~]# curl 10.0.0.220
&lt;html&gt;&lt;body&gt;&lt;h1&gt;It works!&lt;/h1&gt;&lt;/body&gt;&lt;/html&gt;
[root@docker01 ~]# ping 10.0.0.220 -c 1
PING 10.0.0.220 (10.0.0.220) 56(84) bytes of data.
64 bytes from 10.0.0.220: icmp_seq=1 ttl=64 time=0.043 ms
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><ul><li>再运行一个容器，设置网路类型为none：</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>pipework br0 $(docker run -d -it --net=none --name test httpd:2.4) 10.0.0.221/24@10.0.0.254
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li>进行访问测试</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>[root@docker01 ~]# curl 10.0.0.221
&lt;html&gt;&lt;body&gt;&lt;h1&gt;It works!&lt;/h1&gt;&lt;/body&gt;&lt;/html&gt;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ul><li>重启容器后需要再次指定：</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>pipework br0 testduliip  172.16.146.113/24\@172.16.146.1 pipework br0 testduliip01 172.16.146.112/24\@172.16.146.1
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li>Dcoker跨主机通信之overlay可以参考：</li> <li>http://www.cnblogs.com/CloudMan6/p/7270551.html</li></ul></li> <li><p>Docker跨主机通信之macvlan</p> <ul><li>创建网络</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>docker network  create --driver macvlan  --subnet 10.1.0.0/24 --gateway 10.1.0.254 -o parent=eth0  macvlan_1
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li>设置网卡为混杂模式</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>ip link set eth0 promisc on
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li>创建使用macvlan网络容器</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>docker run  -it --network macvlan_1  --ip=10.1.0.222 busybox /bin/sh
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li></ol> <h2 id="docker企业级镜像仓库harbor"><a href="#docker企业级镜像仓库harbor" class="header-anchor">#</a> docker企业级镜像仓库harbor</h2> <ul><li>容器管理<div class="language- line-numbers-mode"><pre class="language-text"><code>[root@docker01 harbor]# pwd
/opt/harbor
[root@docker01 harbor]# docker-compose stop
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></li></ul> <ol><li><p>安装docker、docker-compose</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>下载 harbor
cd /opt &amp;&amp; https://storage.googleapis.com/harbor-releases/harbor-offline-installer-v1.3.0.tgz
tar xf harbor-offline-installer-v1.3.0.tgz
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></li> <li><p>修改主机及web界面密码</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>[root@docker01 harbor]# vim harbor.cfg 
	···
	hostname = 10.0.0.100
	harbor_admin_password = Harbor12345
	···
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></li> <li><p>执行安装脚本</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>[root@docker01 harbor]# ./install.sh
浏览器访问 http://10.0.0.11
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li> <li><p>镜像推送到仓库的指定项目</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>[root@docker02 ~]# docker  tag centos:6.8  10.0.0.100/clsn/centos6.8:1.0
[root@docker02 ~]#  
[root@docker02 ~]# docker images 
REPOSITORY                  TAG                 IMAGE ID            CREATED             SIZE
busybox                     latest              5b0d59026729        8 days ago          1.15MB
10.0.0.100/clsn/centos6.81.06704d778b3ba        2 months ago        195MB
centos                      6.86704d778b3ba        2 months ago        195MB
[root@docker02 ~]# docker login 10.0.0.100
Username: admin
Password: 
Login Succeeded
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div></li> <li><p>推送镜像</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>[root@docker02 ~]# docker push 10.0.0.100/clsn/centos6.8
The push refers to repository [10.0.0.100/clsn/centos6.8]
e00c9229b481: Pushing  13.53MB/194.5MB
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></li> <li><p>在web界面里查看</p></li></ol> <h2 id="使用容器的建议"><a href="#使用容器的建议" class="header-anchor">#</a> 使用容器的建议</h2> <ol><li>不要以拆分方式进行应用程序发布</li> <li>不要创建大型镜像</li> <li>不要在单个容器中运行多个进程</li> <li>不要再镜像内保存凭证，不要依赖IP地址</li> <li>以非root用户运行进程</li> <li>不要使用“最新”标签</li> <li>不要利用运行中的容器创建镜像</li> <li>不要使用单层镜像</li> <li>不要将数据存放在容器内</li></ol> <h2 id="关于docker容器的监控"><a href="#关于docker容器的监控" class="header-anchor">#</a> 关于Docker容器的监控</h2> <ol><li>容器的基本信息</li> <li>包括容器的数量、ID、名称、镜像、启动命令、端口等信息</li> <li>容器的运行状态</li> <li>统计各状态的容器的数量，包括运行中、暂停、停止及异常退出</li> <li>容器的用量信息</li> <li>统计容器的CPU使用率、内存使用量、块设备I/O使用量、网络使用情况等资源的使用情况</li></ol> <p>参考：
<a href="https://mp.weixin.qq.com/s/vhLZ_KUa5kdMYDhURQtGPw" target="_blank" rel="noopener noreferrer"><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><!----> <span class="next"><a href="/devops/docker/k8s基础.html">
        k8s基础
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.dd60fddf.js" defer></script><script src="/assets/js/2.1d799614.js" defer></script><script src="/assets/js/79.194bc603.js" defer></script>
  </body>
</html>
